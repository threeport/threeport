// generated by 'threeport-sdk gen' - do not edit

package cmd

import (
	"encoding/json"
	"errors"
	"fmt"
	ghodss_yaml "github.com/ghodss/yaml"
	cobra "github.com/spf13/cobra"
	api_v0 "github.com/threeport/threeport/pkg/api/v0"
	cli "github.com/threeport/threeport/pkg/cli/v0"
	client_v0 "github.com/threeport/threeport/pkg/client/v0"
	config_v0 "github.com/threeport/threeport/pkg/config/v0"
	encryption "github.com/threeport/threeport/pkg/encryption/v0"
	util "github.com/threeport/threeport/pkg/util/v0"
	yaml "gopkg.in/yaml.v2"
	"os"
)

///////////////////////////////////////////////////////////////////////////////
// ObservabilityStackDefinition
///////////////////////////////////////////////////////////////////////////////

var getObservabilityStackDefinitionVersion string

// GetObservabilityStackDefinitionsCmd represents the observability-stack-definition command
var GetObservabilityStackDefinitionsCmd = &cobra.Command{
	Example: "  tptctl get observability-stack-definitions",
	Long:    "Get observability stack definitions from the system.",
	PreRun:  CommandPreRunFunc,
	Run: func(cmd *cobra.Command, args []string) {
		apiClient, _, apiEndpoint, requestedControlPlane := GetClientContext(cmd)

		switch getObservabilityStackDefinitionVersion {
		case "v0":
			// get observability stack definitions
			observabilityStackDefinitions, err := client_v0.GetObservabilityStackDefinitions(apiClient, apiEndpoint)
			if err != nil {
				cli.Error("failed to retrieve observability stack definitions", err)
				os.Exit(1)
			}

			// write the output
			if len(*observabilityStackDefinitions) == 0 {
				cli.Info(fmt.Sprintf(
					"No observability stack definitions currently managed by %s threeport control plane",
					requestedControlPlane,
				))
				os.Exit(0)
			}
			if err := outputGetv0ObservabilityStackDefinitionsCmd(
				observabilityStackDefinitions,
				apiClient,
				apiEndpoint,
			); err != nil {
				cli.Error("failed to produce output", err)
				os.Exit(0)
			}
		default:
			cli.Error("", errors.New("unrecognized object version"))
			os.Exit(1)
		}
	},
	Short:        "Get observability stack definitions from the system",
	SilenceUsage: true,
	Use:          "observability-stack-definitions",
}

func init() {
	GetCmd.AddCommand(GetObservabilityStackDefinitionsCmd)

	GetObservabilityStackDefinitionsCmd.Flags().StringVarP(
		&cliArgs.ControlPlaneName,
		"control-plane-name", "i", "", "Optional. Name of control plane. Will default to current control plane if not provided.",
	)
	GetObservabilityStackDefinitionsCmd.Flags().StringVarP(
		&getObservabilityStackDefinitionVersion,
		"version", "v", "v0", "Version of observability stack definitions object to retrieve. One of: [v0]",
	)
}

var (
	createObservabilityStackDefinitionConfigPath string
	createObservabilityStackDefinitionVersion    string
)

// CreateObservabilityStackDefinitionCmd represents the observability-stack-definition command
var CreateObservabilityStackDefinitionCmd = &cobra.Command{
	Example: "  tptctl create observability-stack-definition --config path/to/config.yaml",
	Long:    "Create a new observability stack definition.",
	PreRun:  CommandPreRunFunc,
	Run: func(cmd *cobra.Command, args []string) {
		apiClient, _, apiEndpoint, _ := GetClientContext(cmd)

		// read observability stack definition config
		configContent, err := os.ReadFile(createObservabilityStackDefinitionConfigPath)
		if err != nil {
			cli.Error("failed to read config file", err)
			os.Exit(1)
		}
		// create observability stack definition based on version
		switch createObservabilityStackDefinitionVersion {
		case "v0":
			var observabilityStackDefinitionConfig config_v0.ObservabilityStackDefinitionConfig
			if err := yaml.UnmarshalStrict(configContent, &observabilityStackDefinitionConfig); err != nil {
				cli.Error("failed to unmarshal config file yaml content", err)
				os.Exit(1)
			}

			// create observability stack definition
			observabilityStackDefinition := observabilityStackDefinitionConfig.ObservabilityStackDefinition
			observabilityStackDefinition.ObservabilityConfigPath = &createObservabilityStackDefinitionConfigPath
			createdObservabilityStackDefinition, err := observabilityStackDefinition.Create(apiClient, apiEndpoint)
			if err != nil {
				cli.Error("failed to create observability stack definition", err)
				os.Exit(1)
			}

			cli.Complete(fmt.Sprintf("observability stack definition %s created", *createdObservabilityStackDefinition.Name))
		default:
			cli.Error("", errors.New("unrecognized object version"))
			os.Exit(1)
		}
	},
	Short:        "Create a new observability stack definition",
	SilenceUsage: true,
	Use:          "observability-stack-definition",
}

func init() {
	CreateCmd.AddCommand(CreateObservabilityStackDefinitionCmd)

	CreateObservabilityStackDefinitionCmd.Flags().StringVarP(
		&createObservabilityStackDefinitionConfigPath,
		"config", "c", "", "Path to file with observability stack definition config.",
	)
	CreateObservabilityStackDefinitionCmd.MarkFlagRequired("config")
	CreateObservabilityStackDefinitionCmd.Flags().StringVarP(
		&cliArgs.ControlPlaneName,
		"control-plane-name", "i", "", "Optional. Name of control plane. Will default to current control plane if not provided.",
	)
	CreateObservabilityStackDefinitionCmd.Flags().StringVarP(
		&createObservabilityStackDefinitionVersion,
		"version", "v", "v0", "Version of observability stack definitions object to create. One of: [v0]",
	)
}

var (
	deleteObservabilityStackDefinitionConfigPath string
	deleteObservabilityStackDefinitionName       string
	deleteObservabilityStackDefinitionVersion    string
)

// DeleteObservabilityStackDefinitionCmd represents the observability-stack-definition command
var DeleteObservabilityStackDefinitionCmd = &cobra.Command{
	Example: "  # delete based on config file\n  tptctl delete observability-stack-definition --config path/to/config.yaml\n\n  # delete based on name\n  tptctl delete observability-stack-definition --name some-observability-stack-definition",
	Long:    "Delete an existing observability stack definition.",
	PreRun:  CommandPreRunFunc,
	Run: func(cmd *cobra.Command, args []string) {
		apiClient, _, apiEndpoint, _ := GetClientContext(cmd)

		// flag validation
		if err := cli.ValidateConfigNameFlags(
			deleteObservabilityStackDefinitionConfigPath,
			deleteObservabilityStackDefinitionName,
			"observability stack definition",
		); err != nil {
			cli.Error("flag validation failed", err)
			os.Exit(1)
		}

		// delete observability stack definition based on version
		switch deleteObservabilityStackDefinitionVersion {
		case "v0":
			var observabilityStackDefinitionConfig config_v0.ObservabilityStackDefinitionConfig
			if deleteObservabilityStackDefinitionConfigPath != "" {
				// load observability stack definition config
				configContent, err := os.ReadFile(deleteObservabilityStackDefinitionConfigPath)
				if err != nil {
					cli.Error("failed to read config file", err)
					os.Exit(1)
				}
				if err := yaml.UnmarshalStrict(configContent, &observabilityStackDefinitionConfig); err != nil {
					cli.Error("failed to unmarshal config file yaml content", err)
					os.Exit(1)
				}
			} else {
				observabilityStackDefinitionConfig = config_v0.ObservabilityStackDefinitionConfig{
					ObservabilityStackDefinition: config_v0.ObservabilityStackDefinitionValues{
						Name: &deleteObservabilityStackDefinitionName,
					},
				}
			}

			// delete observability stack definition
			observabilityStackDefinition := observabilityStackDefinitionConfig.ObservabilityStackDefinition
			observabilityStackDefinition.ObservabilityConfigPath = &deleteObservabilityStackDefinitionConfigPath
			deletedObservabilityStackDefinition, err := observabilityStackDefinition.Delete(apiClient, apiEndpoint)
			if err != nil {
				cli.Error("failed to delete observability stack definition", err)
				os.Exit(1)
			}

			cli.Complete(fmt.Sprintf("observability stack definition %s deleted", *deletedObservabilityStackDefinition.Name))
		default:
			cli.Error("", errors.New("unrecognized object version"))
			os.Exit(1)
		}
	},
	Short:        "Delete an existing observability stack definition",
	SilenceUsage: true,
	Use:          "observability-stack-definition",
}

func init() {
	DeleteCmd.AddCommand(DeleteObservabilityStackDefinitionCmd)

	DeleteObservabilityStackDefinitionCmd.Flags().StringVarP(
		&deleteObservabilityStackDefinitionConfigPath,
		"config", "c", "", "Path to file with observability stack definition config.",
	)
	DeleteObservabilityStackDefinitionCmd.Flags().StringVarP(
		&deleteObservabilityStackDefinitionName,
		"name", "n", "", "Name of observability stack definition.",
	)
	DeleteObservabilityStackDefinitionCmd.Flags().StringVarP(
		&cliArgs.ControlPlaneName,
		"control-plane-name", "i", "", "Optional. Name of control plane. Will default to current control plane if not provided.",
	)
	DeleteObservabilityStackDefinitionCmd.Flags().StringVarP(
		&deleteObservabilityStackDefinitionVersion,
		"version", "v", "v0", "Version of observability stack definitions object to delete. One of: [v0]",
	)
}

var (
	describeObservabilityStackDefinitionConfigPath string
	describeObservabilityStackDefinitionName       string
	describeObservabilityStackDefinitionField      string
	describeObservabilityStackDefinitionOutput     string
	describeObservabilityStackDefinitionVersion    string
)

// DescribeObservabilityStackDefinitionCmd representes the observability-stack-definition command
var DescribeObservabilityStackDefinitionCmd = &cobra.Command{
	Example: "  # Get the plain output description for a observability stack definition\n  tptctl describe observability-stack-definition -n some-observability-stack-definition\n\n  # Get JSON output for a observability stack definition\n  tptctl describe observability-stack-definition -n some-observability-stack-definition -o json\n\n  # Get the value of the Name field for a observability stack definition\n  tptctl describe observability-stack-definition -n some-observability-stack-definition -f Name ",
	Long:    "Describe a observability stack definition.  This command can give you a plain output description, output all fields in JSON or YAML format, or provide the value of any specific field.\n\nNote: any values that are encrypted in the database will be redacted unless the field is specifically requested with the --field flag.",
	PreRun:  CommandPreRunFunc,
	Run: func(cmd *cobra.Command, args []string) {
		apiClient, _, apiEndpoint, _ := GetClientContext(cmd)

		// flag validation
		if err := cli.ValidateConfigNameFlags(
			describeObservabilityStackDefinitionConfigPath,
			describeObservabilityStackDefinitionName,
			"observability stack definition",
		); err != nil {
			cli.Error("flag validation failed", err)
			os.Exit(1)
		}

		if err := cli.ValidateDescribeOutputFlag(
			describeObservabilityStackDefinitionOutput,
			"observability stack definition",
		); err != nil {
			cli.Error("flag validation failed", err)
			os.Exit(1)
		}

		// get observability stack definition
		var observabilityStackDefinition interface{}
		switch describeObservabilityStackDefinitionVersion {
		case "v0":
			// load observability stack definition config by name or config file
			var observabilityStackDefinitionConfig config_v0.ObservabilityStackDefinitionConfig
			if describeObservabilityStackDefinitionConfigPath != "" {
				configContent, err := os.ReadFile(describeObservabilityStackDefinitionConfigPath)
				if err != nil {
					cli.Error("failed to read config file", err)
					os.Exit(1)
				}
				if err := yaml.UnmarshalStrict(configContent, &observabilityStackDefinitionConfig); err != nil {
					cli.Error("failed to unmarshal config file yaml content", err)
					os.Exit(1)
				}
			} else {
				observabilityStackDefinitionConfig = config_v0.ObservabilityStackDefinitionConfig{
					ObservabilityStackDefinition: config_v0.ObservabilityStackDefinitionValues{
						Name: &describeObservabilityStackDefinitionName,
					},
				}
			}

			// get observability stack definition object by name
			obj, err := client_v0.GetObservabilityStackDefinitionByName(
				apiClient,
				apiEndpoint,
				*observabilityStackDefinitionConfig.ObservabilityStackDefinition.Name,
			)
			if err != nil {
				cli.Error("failed to retrieve observability stack definition details", err)
				os.Exit(1)
			}
			observabilityStackDefinition = obj

			// return plain output if requested
			if describeObservabilityStackDefinitionOutput == "plain" {
				if err := outputDescribev0ObservabilityStackDefinitionCmd(
					observabilityStackDefinition.(*api_v0.ObservabilityStackDefinition),
					&observabilityStackDefinitionConfig,
					apiClient,
					apiEndpoint,
				); err != nil {
					cli.Error("failed to describe observability stack definition", err)
					os.Exit(1)
				}
			}
		default:
			cli.Error("", errors.New("unrecognized object version"))
			os.Exit(1)
		}

		// return field value if specified
		if describeObservabilityStackDefinitionField != "" {
			fieldVal, err := util.GetObjectFieldValue(
				observabilityStackDefinition,
				describeObservabilityStackDefinitionField,
			)
			if err != nil {
				cli.Error("failed to get field value from observability stack definition", err)
				os.Exit(1)
			}

			// decrypt value as needed
			encrypted, err := encryption.IsEncryptedField(observabilityStackDefinition, describeObservabilityStackDefinitionField)
			if err != nil {
				cli.Error("", err)
			}
			if encrypted {
				// get encryption key from threeport config
				threeportConfig, requestedControlPlane, err := config_v0.GetThreeportConfig(cliArgs.ControlPlaneName)
				if err != nil {
					cli.Error("failed to get threeport config: %w", err)
					os.Exit(1)
				}
				encryptionKey, err := threeportConfig.GetThreeportEncryptionKey(requestedControlPlane)
				if err != nil {
					cli.Error("failed to get encryption key from threeport config: %w", err)
					os.Exit(1)
				}

				// decrypt value for output
				decryptedVal, err := encryption.Decrypt(encryptionKey, fieldVal.String())
				if err != nil {
					cli.Error("failed to decrypt value: %w", err)
				}
				fmt.Println(decryptedVal)
				os.Exit(0)
			} else {
				fmt.Println(fieldVal.Interface())
				os.Exit(0)
			}
		}

		// produce json or yaml output if requested
		switch describeObservabilityStackDefinitionOutput {
		case "json":
			// redact encrypted values
			redactedObservabilityStackDefinition := encryption.RedactEncryptedValues(observabilityStackDefinition)

			// marshal to JSON then print
			observabilityStackDefinitionJson, err := json.MarshalIndent(redactedObservabilityStackDefinition, "", "  ")
			if err != nil {
				cli.Error("failed to marshal observability stack definition into JSON", err)
				os.Exit(1)
			}

			fmt.Println(string(observabilityStackDefinitionJson))
		case "yaml":
			// redact encrypted values
			redactedObservabilityStackDefinition := encryption.RedactEncryptedValues(observabilityStackDefinition)

			// marshal to JSON then convert to YAML - this results in field
			// names with correct capitalization vs marshalling directly to YAML
			observabilityStackDefinitionJson, err := json.MarshalIndent(redactedObservabilityStackDefinition, "", "  ")
			if err != nil {
				cli.Error("failed to marshal observability stack definition into JSON", err)
				os.Exit(1)
			}
			observabilityStackDefinitionYaml, err := ghodss_yaml.JSONToYAML(observabilityStackDefinitionJson)
			if err != nil {
				cli.Error("failed to convert observability stack definition JSON to YAML", err)
				os.Exit(1)
			}

			fmt.Println(string(observabilityStackDefinitionYaml))
		}
	},
	Short:        "Describe a observability stack definition",
	SilenceUsage: true,
	Use:          "observability-stack-definition",
}

func init() {
	DescribeCmd.AddCommand(DescribeObservabilityStackDefinitionCmd)

	DescribeObservabilityStackDefinitionCmd.Flags().StringVarP(
		&describeObservabilityStackDefinitionConfigPath,
		"config", "c", "", "Path to file with observability stack definition config.",
	)
	DescribeObservabilityStackDefinitionCmd.Flags().StringVarP(
		&describeObservabilityStackDefinitionName,
		"name", "n", "", "Name of observability stack definition.",
	)
	DescribeObservabilityStackDefinitionCmd.Flags().StringVarP(
		&describeObservabilityStackDefinitionOutput,
		"output", "o", "plain", "Output format for object description. One of 'plain','json','yaml'.  Will be ignored if the --field flag is also used.  Plain output produces select details about the object.  JSON and YAML output formats include all direct attributes of the object",
	)
	DescribeObservabilityStackDefinitionCmd.Flags().StringVarP(
		&describeObservabilityStackDefinitionField,
		"field", "f", "", "Object field to get value for. If used, --output flag will be ignored.  *Only* the value of the desired field will be returned.  Will not return information on related objects, only direct attributes of the object itself.",
	)
	DescribeObservabilityStackDefinitionCmd.Flags().StringVarP(
		&cliArgs.ControlPlaneName,
		"control-plane-name", "i", "", "Optional. Name of control plane. Will default to current control plane if not provided.",
	)
	DescribeObservabilityStackDefinitionCmd.Flags().StringVarP(
		&describeObservabilityStackDefinitionVersion,
		"version", "v", "v0", "Version of observability stack definitions object to describe. One of: [v0]",
	)
}

///////////////////////////////////////////////////////////////////////////////
// ObservabilityStack
///////////////////////////////////////////////////////////////////////////////

// GetObservabilityStacksCmd represents the observability-stack command
var GetObservabilityStacksCmd = &cobra.Command{
	Example: "  tptctl get observability-stacks",
	Long:    "Get observability stacks from the system.\n\nA observability stack is a simple abstraction of observability stack definitions and observability stack instances.\nThis command displays all instances and the definitions used to configure them.",
	PreRun:  CommandPreRunFunc,
	Run: func(cmd *cobra.Command, args []string) {
		apiClient, _, apiEndpoint, requestedControlPlane := GetClientContext(cmd)

		// get observability stacks
		v0observabilityStackInstances, err := client_v0.GetObservabilityStackInstances(apiClient, apiEndpoint)
		if err != nil {
			cli.Error("failed to retrieve observability stack instances", err)
			os.Exit(1)
		}

		// write the output
		if len(*v0observabilityStackInstances) == 0 {
			cli.Info(fmt.Sprintf(
				"No observability stack instances currently managed by %s threeport control plane",
				requestedControlPlane,
			))
			os.Exit(0)
		}
		if err := outputGetObservabilityStacksCmd(
			v0observabilityStackInstances,
			apiClient,
			apiEndpoint,
		); err != nil {
			cli.Error("failed to produce output: %s", err)
			os.Exit(0)
		}
	},
	Short:        "Get observability stacks from the system",
	SilenceUsage: true,
	Use:          "observability-stacks",
}

func init() {
	GetCmd.AddCommand(GetObservabilityStacksCmd)

	GetObservabilityStacksCmd.Flags().StringVarP(
		&cliArgs.ControlPlaneName,
		"control-plane-name", "i", "", "Optional. Name of control plane. Will default to current control plane if not provided.",
	)
}

var (
	createObservabilityStackConfigPath string
	createObservabilityStackVersion    string
)

// CreateObservabilityStackCmd represents the observability-stack command
var CreateObservabilityStackCmd = &cobra.Command{
	Example: "  tptctl create observability-stack --config path/to/config.yaml",
	Long:    "Create a new observability stack. This command creates a new observability stack definition and observability stack instance based on the observability stack config.",
	PreRun:  CommandPreRunFunc,
	Run: func(cmd *cobra.Command, args []string) {
		apiClient, _, apiEndpoint, _ := GetClientContext(cmd)

		// read observability stack config
		configContent, err := os.ReadFile(createObservabilityStackConfigPath)
		if err != nil {
			cli.Error("failed to read config file", err)
			os.Exit(1)
		}

		// create observability stack based on version
		switch createObservabilityStackVersion {
		case "v0":
			var observabilityStackConfig config_v0.ObservabilityStackConfig
			if err := yaml.UnmarshalStrict(configContent, &observabilityStackConfig); err != nil {
				cli.Error("failed to unmarshal config file yaml content", err)
				os.Exit(1)
			}

			// create observability stack
			observabilityStack := observabilityStackConfig.ObservabilityStack
			observabilityStack.ObservabilityConfigPath = &createObservabilityStackConfigPath
			createdObservabilityStackDefinition, createdObservabilityStackInstance, err := observabilityStack.Create(
				apiClient,
				apiEndpoint,
			)
			if err != nil {
				cli.Error("failed to create observability stack", err)
				os.Exit(1)
			}

			cli.Info(fmt.Sprintf("observability stack definition %s created", *createdObservabilityStackDefinition.Name))
			cli.Info(fmt.Sprintf("observability stack instance %s created", *createdObservabilityStackInstance.Name))
			cli.Complete(fmt.Sprintf("observability stack %s created", *observabilityStackConfig.ObservabilityStack.Name))
		default:
			cli.Error("", errors.New("unrecognized object version"))
			os.Exit(1)
		}
	},
	Short:        "Create a new observability stack",
	SilenceUsage: true,
	Use:          "observability-stack",
}

func init() {
	CreateCmd.AddCommand(CreateObservabilityStackCmd)

	CreateObservabilityStackCmd.Flags().StringVarP(
		&createObservabilityStackConfigPath,
		"config", "c", "", "Path to file with observability stack config.",
	)
	CreateObservabilityStackCmd.MarkFlagRequired("config")
	CreateObservabilityStackCmd.Flags().StringVarP(
		&cliArgs.ControlPlaneName,
		"control-plane-name", "i", "", "Optional. Name of control plane. Will default to current control plane if not provided.",
	)
	CreateObservabilityStackCmd.Flags().StringVarP(
		&createObservabilityStackVersion,
		"version", "v", "v0", "Version of observability stacks object to create. One of: [v0]",
	)
}

var (
	deleteObservabilityStackConfigPath string
	deleteObservabilityStackName       string
	deleteObservabilityStackVersion    string
)

// DeleteObservabilityStackCmd represents the observability-stack command
var DeleteObservabilityStackCmd = &cobra.Command{
	Example: "  # delete based on config file\n  tptctl delete observability-stack --config path/to/config.yaml\n\n  # delete based on name\n  tptctl delete observability-stack --name some-observability-stack",
	Long:    "Delete an existing observability stack. This command deletes an existing observability stack definition and observability stack instance based on the observability stack config.",
	PreRun:  CommandPreRunFunc,
	Run: func(cmd *cobra.Command, args []string) {
		apiClient, _, apiEndpoint, _ := GetClientContext(cmd)

		// flag validation
		if deleteObservabilityStackConfigPath == "" {
			cli.Error("flag validation failed", errors.New("config file path is required"))
		}

		// read observability stack config
		configContent, err := os.ReadFile(deleteObservabilityStackConfigPath)
		if err != nil {
			cli.Error("failed to read config file", err)
			os.Exit(1)
		}

		// delete observability stack based on version
		switch deleteObservabilityStackVersion {
		case "v0":
			var observabilityStackConfig config_v0.ObservabilityStackConfig
			if err := yaml.UnmarshalStrict(configContent, &observabilityStackConfig); err != nil {
				cli.Error("failed to unmarshal config file yaml content", err)
				os.Exit(1)
			}

			// delete observability stack
			observabilityStack := observabilityStackConfig.ObservabilityStack
			observabilityStack.ObservabilityConfigPath = &deleteObservabilityStackConfigPath
			_, _, err = observabilityStack.Delete(apiClient, apiEndpoint)
			if err != nil {
				cli.Error("failed to delete observability stack", err)
				os.Exit(1)
			}

			cli.Info(fmt.Sprintf("observability stack definition %s deleted", *observabilityStack.Name))
			cli.Info(fmt.Sprintf("observability stack instance %s deleted", *observabilityStack.Name))
			cli.Complete(fmt.Sprintf("observability stack %s deleted", *observabilityStackConfig.ObservabilityStack.Name))
		default:
			cli.Error("", errors.New("unrecognized object version"))
			os.Exit(1)
		}
	},
	Short:        "Delete an existing observability stack",
	SilenceUsage: true,
	Use:          "observability-stack",
}

func init() {
	DeleteCmd.AddCommand(DeleteObservabilityStackCmd)

	DeleteObservabilityStackCmd.Flags().StringVarP(
		&deleteObservabilityStackConfigPath,
		"config", "c", "", "Path to file with observability stack config.",
	)
	DeleteObservabilityStackCmd.Flags().StringVarP(
		&cliArgs.ControlPlaneName,
		"control-plane-name", "i", "", "Optional. Name of control plane. Will default to current control plane if not provided.",
	)
	DeleteObservabilityStackCmd.Flags().StringVarP(
		&deleteObservabilityStackVersion,
		"version", "v", "v0", "Version of observability stacks object to delete. One of: [v0]",
	)
}

///////////////////////////////////////////////////////////////////////////////
// ObservabilityStackInstance
///////////////////////////////////////////////////////////////////////////////

var getObservabilityStackInstanceVersion string

// GetObservabilityStackInstancesCmd represents the observability-stack-instance command
var GetObservabilityStackInstancesCmd = &cobra.Command{
	Example: "  tptctl get observability-stack-instances",
	Long:    "Get observability stack instances from the system.",
	PreRun:  CommandPreRunFunc,
	Run: func(cmd *cobra.Command, args []string) {
		apiClient, _, apiEndpoint, requestedControlPlane := GetClientContext(cmd)

		switch getObservabilityStackInstanceVersion {
		case "v0":
			// get observability stack instances
			observabilityStackInstances, err := client_v0.GetObservabilityStackInstances(apiClient, apiEndpoint)
			if err != nil {
				cli.Error("failed to retrieve observability stack instances", err)
				os.Exit(1)
			}

			// write the output
			if len(*observabilityStackInstances) == 0 {
				cli.Info(fmt.Sprintf(
					"No observability stack instances currently managed by %s threeport control plane",
					requestedControlPlane,
				))
				os.Exit(0)
			}
			if err := outputGetv0ObservabilityStackInstancesCmd(
				observabilityStackInstances,
				apiClient,
				apiEndpoint,
			); err != nil {
				cli.Error("failed to produce output", err)
				os.Exit(0)
			}
		default:
			cli.Error("", errors.New("unrecognized object version"))
			os.Exit(1)
		}
	},
	Short:        "Get observability stack instances from the system",
	SilenceUsage: true,
	Use:          "observability-stack-instances",
}

func init() {
	GetCmd.AddCommand(GetObservabilityStackInstancesCmd)

	GetObservabilityStackInstancesCmd.Flags().StringVarP(
		&cliArgs.ControlPlaneName,
		"control-plane-name", "i", "", "Optional. Name of control plane. Will default to current control plane if not provided.",
	)
	GetObservabilityStackInstancesCmd.Flags().StringVarP(
		&getObservabilityStackInstanceVersion,
		"version", "v", "v0", "Version of observability stack instances object to retrieve. One of: [v0]",
	)
}

var (
	createObservabilityStackInstanceConfigPath string
	createObservabilityStackInstanceVersion    string
)

// CreateObservabilityStackInstanceCmd represents the observability-stack-instance command
var CreateObservabilityStackInstanceCmd = &cobra.Command{
	Example: "  tptctl create observability-stack-instance --config path/to/config.yaml",
	Long:    "Create a new observability stack instance.",
	PreRun:  CommandPreRunFunc,
	Run: func(cmd *cobra.Command, args []string) {
		apiClient, _, apiEndpoint, _ := GetClientContext(cmd)

		// read observability stack instance config
		configContent, err := os.ReadFile(createObservabilityStackInstanceConfigPath)
		if err != nil {
			cli.Error("failed to read config file", err)
			os.Exit(1)
		}
		// create observability stack instance based on version
		switch createObservabilityStackInstanceVersion {
		case "v0":
			var observabilityStackInstanceConfig config_v0.ObservabilityStackInstanceConfig
			if err := yaml.UnmarshalStrict(configContent, &observabilityStackInstanceConfig); err != nil {
				cli.Error("failed to unmarshal config file yaml content", err)
				os.Exit(1)
			}

			// create observability stack instance
			observabilityStackInstance := observabilityStackInstanceConfig.ObservabilityStackInstance
			observabilityStackInstance.ObservabilityConfigPath = &createObservabilityStackInstanceConfigPath
			createdObservabilityStackInstance, err := observabilityStackInstance.Create(apiClient, apiEndpoint)
			if err != nil {
				cli.Error("failed to create observability stack instance", err)
				os.Exit(1)
			}

			cli.Complete(fmt.Sprintf("observability stack instance %s created", *createdObservabilityStackInstance.Name))
		default:
			cli.Error("", errors.New("unrecognized object version"))
			os.Exit(1)
		}
	},
	Short:        "Create a new observability stack instance",
	SilenceUsage: true,
	Use:          "observability-stack-instance",
}

func init() {
	CreateCmd.AddCommand(CreateObservabilityStackInstanceCmd)

	CreateObservabilityStackInstanceCmd.Flags().StringVarP(
		&createObservabilityStackInstanceConfigPath,
		"config", "c", "", "Path to file with observability stack instance config.",
	)
	CreateObservabilityStackInstanceCmd.MarkFlagRequired("config")
	CreateObservabilityStackInstanceCmd.Flags().StringVarP(
		&cliArgs.ControlPlaneName,
		"control-plane-name", "i", "", "Optional. Name of control plane. Will default to current control plane if not provided.",
	)
	CreateObservabilityStackInstanceCmd.Flags().StringVarP(
		&createObservabilityStackInstanceVersion,
		"version", "v", "v0", "Version of observability stack instances object to create. One of: [v0]",
	)
}

var (
	deleteObservabilityStackInstanceConfigPath string
	deleteObservabilityStackInstanceName       string
	deleteObservabilityStackInstanceVersion    string
)

// DeleteObservabilityStackInstanceCmd represents the observability-stack-instance command
var DeleteObservabilityStackInstanceCmd = &cobra.Command{
	Example: "  # delete based on config file\n  tptctl delete observability-stack-instance --config path/to/config.yaml\n\n  # delete based on name\n  tptctl delete observability-stack-instance --name some-observability-stack-instance",
	Long:    "Delete an existing observability stack instance.",
	PreRun:  CommandPreRunFunc,
	Run: func(cmd *cobra.Command, args []string) {
		apiClient, _, apiEndpoint, _ := GetClientContext(cmd)

		// flag validation
		if err := cli.ValidateConfigNameFlags(
			deleteObservabilityStackInstanceConfigPath,
			deleteObservabilityStackInstanceName,
			"observability stack instance",
		); err != nil {
			cli.Error("flag validation failed", err)
			os.Exit(1)
		}

		// delete observability stack instance based on version
		switch deleteObservabilityStackInstanceVersion {
		case "v0":
			var observabilityStackInstanceConfig config_v0.ObservabilityStackInstanceConfig
			if deleteObservabilityStackInstanceConfigPath != "" {
				// load observability stack instance config
				configContent, err := os.ReadFile(deleteObservabilityStackInstanceConfigPath)
				if err != nil {
					cli.Error("failed to read config file", err)
					os.Exit(1)
				}
				if err := yaml.UnmarshalStrict(configContent, &observabilityStackInstanceConfig); err != nil {
					cli.Error("failed to unmarshal config file yaml content", err)
					os.Exit(1)
				}
			} else {
				observabilityStackInstanceConfig = config_v0.ObservabilityStackInstanceConfig{
					ObservabilityStackInstance: config_v0.ObservabilityStackInstanceValues{
						Name: &deleteObservabilityStackInstanceName,
					},
				}
			}

			// delete observability stack instance
			observabilityStackInstance := observabilityStackInstanceConfig.ObservabilityStackInstance
			observabilityStackInstance.ObservabilityConfigPath = &deleteObservabilityStackInstanceConfigPath
			deletedObservabilityStackInstance, err := observabilityStackInstance.Delete(apiClient, apiEndpoint)
			if err != nil {
				cli.Error("failed to delete observability stack instance", err)
				os.Exit(1)
			}

			cli.Complete(fmt.Sprintf("observability stack instance %s deleted", *deletedObservabilityStackInstance.Name))
		default:
			cli.Error("", errors.New("unrecognized object version"))
			os.Exit(1)
		}
	},
	Short:        "Delete an existing observability stack instance",
	SilenceUsage: true,
	Use:          "observability-stack-instance",
}

func init() {
	DeleteCmd.AddCommand(DeleteObservabilityStackInstanceCmd)

	DeleteObservabilityStackInstanceCmd.Flags().StringVarP(
		&deleteObservabilityStackInstanceConfigPath,
		"config", "c", "", "Path to file with observability stack instance config.",
	)
	DeleteObservabilityStackInstanceCmd.Flags().StringVarP(
		&deleteObservabilityStackInstanceName,
		"name", "n", "", "Name of observability stack instance.",
	)
	DeleteObservabilityStackInstanceCmd.Flags().StringVarP(
		&cliArgs.ControlPlaneName,
		"control-plane-name", "i", "", "Optional. Name of control plane. Will default to current control plane if not provided.",
	)
	DeleteObservabilityStackInstanceCmd.Flags().StringVarP(
		&deleteObservabilityStackInstanceVersion,
		"version", "v", "v0", "Version of observability stack instances object to delete. One of: [v0]",
	)
}

var (
	describeObservabilityStackInstanceConfigPath string
	describeObservabilityStackInstanceName       string
	describeObservabilityStackInstanceField      string
	describeObservabilityStackInstanceOutput     string
	describeObservabilityStackInstanceVersion    string
)

// DescribeObservabilityStackInstanceCmd representes the observability-stack-instance command
var DescribeObservabilityStackInstanceCmd = &cobra.Command{
	Example: "  # Get the plain output description for a observability stack instance\n  tptctl describe observability-stack-instance -n some-observability-stack-instance\n\n  # Get JSON output for a observability stack instance\n  tptctl describe observability-stack-instance -n some-observability-stack-instance -o json\n\n  # Get the value of the Name field for a observability stack instance\n  tptctl describe observability-stack-instance -n some-observability-stack-instance -f Name ",
	Long:    "Describe a observability stack instance.  This command can give you a plain output description, output all fields in JSON or YAML format, or provide the value of any specific field.\n\nNote: any values that are encrypted in the database will be redacted unless the field is specifically requested with the --field flag.",
	PreRun:  CommandPreRunFunc,
	Run: func(cmd *cobra.Command, args []string) {
		apiClient, _, apiEndpoint, _ := GetClientContext(cmd)

		// flag validation
		if err := cli.ValidateConfigNameFlags(
			describeObservabilityStackInstanceConfigPath,
			describeObservabilityStackInstanceName,
			"observability stack instance",
		); err != nil {
			cli.Error("flag validation failed", err)
			os.Exit(1)
		}

		if err := cli.ValidateDescribeOutputFlag(
			describeObservabilityStackInstanceOutput,
			"observability stack instance",
		); err != nil {
			cli.Error("flag validation failed", err)
			os.Exit(1)
		}

		// get observability stack instance
		var observabilityStackInstance interface{}
		switch describeObservabilityStackInstanceVersion {
		case "v0":
			// load observability stack instance config by name or config file
			var observabilityStackInstanceConfig config_v0.ObservabilityStackInstanceConfig
			if describeObservabilityStackInstanceConfigPath != "" {
				configContent, err := os.ReadFile(describeObservabilityStackInstanceConfigPath)
				if err != nil {
					cli.Error("failed to read config file", err)
					os.Exit(1)
				}
				if err := yaml.UnmarshalStrict(configContent, &observabilityStackInstanceConfig); err != nil {
					cli.Error("failed to unmarshal config file yaml content", err)
					os.Exit(1)
				}
			} else {
				observabilityStackInstanceConfig = config_v0.ObservabilityStackInstanceConfig{
					ObservabilityStackInstance: config_v0.ObservabilityStackInstanceValues{
						Name: &describeObservabilityStackInstanceName,
					},
				}
			}

			// get observability stack instance object by name
			obj, err := client_v0.GetObservabilityStackInstanceByName(
				apiClient,
				apiEndpoint,
				*observabilityStackInstanceConfig.ObservabilityStackInstance.Name,
			)
			if err != nil {
				cli.Error("failed to retrieve observability stack instance details", err)
				os.Exit(1)
			}
			observabilityStackInstance = obj

			// return plain output if requested
			if describeObservabilityStackInstanceOutput == "plain" {
				if err := outputDescribev0ObservabilityStackInstanceCmd(
					observabilityStackInstance.(*api_v0.ObservabilityStackInstance),
					&observabilityStackInstanceConfig,
					apiClient,
					apiEndpoint,
				); err != nil {
					cli.Error("failed to describe observability stack instance", err)
					os.Exit(1)
				}
			}
		default:
			cli.Error("", errors.New("unrecognized object version"))
			os.Exit(1)
		}

		// return field value if specified
		if describeObservabilityStackInstanceField != "" {
			fieldVal, err := util.GetObjectFieldValue(
				observabilityStackInstance,
				describeObservabilityStackInstanceField,
			)
			if err != nil {
				cli.Error("failed to get field value from observability stack instance", err)
				os.Exit(1)
			}

			// decrypt value as needed
			encrypted, err := encryption.IsEncryptedField(observabilityStackInstance, describeObservabilityStackInstanceField)
			if err != nil {
				cli.Error("", err)
			}
			if encrypted {
				// get encryption key from threeport config
				threeportConfig, requestedControlPlane, err := config_v0.GetThreeportConfig(cliArgs.ControlPlaneName)
				if err != nil {
					cli.Error("failed to get threeport config: %w", err)
					os.Exit(1)
				}
				encryptionKey, err := threeportConfig.GetThreeportEncryptionKey(requestedControlPlane)
				if err != nil {
					cli.Error("failed to get encryption key from threeport config: %w", err)
					os.Exit(1)
				}

				// decrypt value for output
				decryptedVal, err := encryption.Decrypt(encryptionKey, fieldVal.String())
				if err != nil {
					cli.Error("failed to decrypt value: %w", err)
				}
				fmt.Println(decryptedVal)
				os.Exit(0)
			} else {
				fmt.Println(fieldVal.Interface())
				os.Exit(0)
			}
		}

		// produce json or yaml output if requested
		switch describeObservabilityStackInstanceOutput {
		case "json":
			// redact encrypted values
			redactedObservabilityStackInstance := encryption.RedactEncryptedValues(observabilityStackInstance)

			// marshal to JSON then print
			observabilityStackInstanceJson, err := json.MarshalIndent(redactedObservabilityStackInstance, "", "  ")
			if err != nil {
				cli.Error("failed to marshal observability stack instance into JSON", err)
				os.Exit(1)
			}

			fmt.Println(string(observabilityStackInstanceJson))
		case "yaml":
			// redact encrypted values
			redactedObservabilityStackInstance := encryption.RedactEncryptedValues(observabilityStackInstance)

			// marshal to JSON then convert to YAML - this results in field
			// names with correct capitalization vs marshalling directly to YAML
			observabilityStackInstanceJson, err := json.MarshalIndent(redactedObservabilityStackInstance, "", "  ")
			if err != nil {
				cli.Error("failed to marshal observability stack instance into JSON", err)
				os.Exit(1)
			}
			observabilityStackInstanceYaml, err := ghodss_yaml.JSONToYAML(observabilityStackInstanceJson)
			if err != nil {
				cli.Error("failed to convert observability stack instance JSON to YAML", err)
				os.Exit(1)
			}

			fmt.Println(string(observabilityStackInstanceYaml))
		}
	},
	Short:        "Describe a observability stack instance",
	SilenceUsage: true,
	Use:          "observability-stack-instance",
}

func init() {
	DescribeCmd.AddCommand(DescribeObservabilityStackInstanceCmd)

	DescribeObservabilityStackInstanceCmd.Flags().StringVarP(
		&describeObservabilityStackInstanceConfigPath,
		"config", "c", "", "Path to file with observability stack instance config.",
	)
	DescribeObservabilityStackInstanceCmd.Flags().StringVarP(
		&describeObservabilityStackInstanceName,
		"name", "n", "", "Name of observability stack instance.",
	)
	DescribeObservabilityStackInstanceCmd.Flags().StringVarP(
		&describeObservabilityStackInstanceOutput,
		"output", "o", "plain", "Output format for object description. One of 'plain','json','yaml'.  Will be ignored if the --field flag is also used.  Plain output produces select details about the object.  JSON and YAML output formats include all direct attributes of the object",
	)
	DescribeObservabilityStackInstanceCmd.Flags().StringVarP(
		&describeObservabilityStackInstanceField,
		"field", "f", "", "Object field to get value for. If used, --output flag will be ignored.  *Only* the value of the desired field will be returned.  Will not return information on related objects, only direct attributes of the object itself.",
	)
	DescribeObservabilityStackInstanceCmd.Flags().StringVarP(
		&cliArgs.ControlPlaneName,
		"control-plane-name", "i", "", "Optional. Name of control plane. Will default to current control plane if not provided.",
	)
	DescribeObservabilityStackInstanceCmd.Flags().StringVarP(
		&describeObservabilityStackInstanceVersion,
		"version", "v", "v0", "Version of observability stack instances object to describe. One of: [v0]",
	)
}
