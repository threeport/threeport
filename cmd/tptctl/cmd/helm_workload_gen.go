// generated by 'threeport-sdk gen' - do not edit

package cmd

import (
	"encoding/json"
	"errors"
	"fmt"
	ghodss_yaml "github.com/ghodss/yaml"
	cobra "github.com/spf13/cobra"
	api_v0 "github.com/threeport/threeport/pkg/api/v0"
	cli "github.com/threeport/threeport/pkg/cli/v0"
	client_v0 "github.com/threeport/threeport/pkg/client/v0"
	config_v0 "github.com/threeport/threeport/pkg/config/v0"
	encryption "github.com/threeport/threeport/pkg/encryption/v0"
	util "github.com/threeport/threeport/pkg/util/v0"
	yaml "gopkg.in/yaml.v2"
	"os"
)

///////////////////////////////////////////////////////////////////////////////
// HelmWorkloadDefinition
///////////////////////////////////////////////////////////////////////////////

var getHelmWorkloadDefinitionVersion string

// GetHelmWorkloadDefinitionsCmd represents the helm-workload-definition command
var GetHelmWorkloadDefinitionsCmd = &cobra.Command{
	Example: "  tptctl get helm-workload-definitions",
	Long:    "Get helm workload definitions from the system.",
	PreRun:  CommandPreRunFunc,
	Run: func(cmd *cobra.Command, args []string) {
		apiClient, _, apiEndpoint, requestedControlPlane := GetClientContext(cmd)

		switch getHelmWorkloadDefinitionVersion {
		case "v0":
			// get helm workload definitions
			helmWorkloadDefinitions, err := client_v0.GetHelmWorkloadDefinitions(apiClient, apiEndpoint)
			if err != nil {
				cli.Error("failed to retrieve helm workload definitions", err)
				os.Exit(1)
			}

			// write the output
			if len(*helmWorkloadDefinitions) == 0 {
				cli.Info(fmt.Sprintf(
					"No helm workload definitions currently managed by %s threeport control plane",
					requestedControlPlane,
				))
				os.Exit(0)
			}
			if err := outputGetv0HelmWorkloadDefinitionsCmd(
				helmWorkloadDefinitions,
				apiClient,
				apiEndpoint,
			); err != nil {
				cli.Error("failed to produce output", err)
				os.Exit(0)
			}
		default:
			cli.Error("", errors.New("unrecognized object version"))
			os.Exit(1)
		}
	},
	Short:        "Get helm workload definitions from the system",
	SilenceUsage: true,
	Use:          "helm-workload-definitions",
}

func init() {
	GetCmd.AddCommand(GetHelmWorkloadDefinitionsCmd)

	GetHelmWorkloadDefinitionsCmd.Flags().StringVarP(
		&cliArgs.ControlPlaneName,
		"control-plane-name", "i", "", "Optional. Name of control plane. Will default to current control plane if not provided.",
	)
	GetHelmWorkloadDefinitionsCmd.Flags().StringVarP(
		&getHelmWorkloadDefinitionVersion,
		"version", "v", "v0", "Version of helm workload definitions object to retrieve. One of: [v0]",
	)
}

var (
	createHelmWorkloadDefinitionConfigPath string
	createHelmWorkloadDefinitionVersion    string
)

// CreateHelmWorkloadDefinitionCmd represents the helm-workload-definition command
var CreateHelmWorkloadDefinitionCmd = &cobra.Command{
	Example: "  tptctl create helm-workload-definition --config path/to/config.yaml",
	Long:    "Create a new helm workload definition.",
	PreRun:  CommandPreRunFunc,
	Run: func(cmd *cobra.Command, args []string) {
		apiClient, _, apiEndpoint, _ := GetClientContext(cmd)

		// read helm workload definition config
		configContent, err := os.ReadFile(createHelmWorkloadDefinitionConfigPath)
		if err != nil {
			cli.Error("failed to read config file", err)
			os.Exit(1)
		}
		// create helm workload definition based on version
		switch createHelmWorkloadDefinitionVersion {
		case "v0":
			var helmWorkloadDefinitionConfig config_v0.HelmWorkloadDefinitionConfig
			if err := yaml.UnmarshalStrict(configContent, &helmWorkloadDefinitionConfig); err != nil {
				cli.Error("failed to unmarshal config file yaml content", err)
				os.Exit(1)
			}

			// create helm workload definition
			helmWorkloadDefinition := helmWorkloadDefinitionConfig.HelmWorkloadDefinition
			helmWorkloadDefinition.HelmWorkloadConfigPath = &createHelmWorkloadDefinitionConfigPath
			createdHelmWorkloadDefinition, err := helmWorkloadDefinition.Create(apiClient, apiEndpoint)
			if err != nil {
				cli.Error("failed to create helm workload definition", err)
				os.Exit(1)
			}

			cli.Complete(fmt.Sprintf("helm workload definition %s created", *createdHelmWorkloadDefinition.Name))
		default:
			cli.Error("", errors.New("unrecognized object version"))
			os.Exit(1)
		}
	},
	Short:        "Create a new helm workload definition",
	SilenceUsage: true,
	Use:          "helm-workload-definition",
}

func init() {
	CreateCmd.AddCommand(CreateHelmWorkloadDefinitionCmd)

	CreateHelmWorkloadDefinitionCmd.Flags().StringVarP(
		&createHelmWorkloadDefinitionConfigPath,
		"config", "c", "", "Path to file with helm workload definition config.",
	)
	CreateHelmWorkloadDefinitionCmd.MarkFlagRequired("config")
	CreateHelmWorkloadDefinitionCmd.Flags().StringVarP(
		&cliArgs.ControlPlaneName,
		"control-plane-name", "i", "", "Optional. Name of control plane. Will default to current control plane if not provided.",
	)
	CreateHelmWorkloadDefinitionCmd.Flags().StringVarP(
		&createHelmWorkloadDefinitionVersion,
		"version", "v", "v0", "Version of helm workload definitions object to create. One of: [v0]",
	)
}

var (
	deleteHelmWorkloadDefinitionConfigPath string
	deleteHelmWorkloadDefinitionName       string
	deleteHelmWorkloadDefinitionVersion    string
)

// DeleteHelmWorkloadDefinitionCmd represents the helm-workload-definition command
var DeleteHelmWorkloadDefinitionCmd = &cobra.Command{
	Example: "  # delete based on config file\n  tptctl delete helm-workload-definition --config path/to/config.yaml\n\n  # delete based on name\n  tptctl delete helm-workload-definition --name some-helm-workload-definition",
	Long:    "Delete an existing helm workload definition.",
	PreRun:  CommandPreRunFunc,
	Run: func(cmd *cobra.Command, args []string) {
		apiClient, _, apiEndpoint, _ := GetClientContext(cmd)

		// flag validation
		if err := cli.ValidateConfigNameFlags(
			deleteHelmWorkloadDefinitionConfigPath,
			deleteHelmWorkloadDefinitionName,
			"helm workload definition",
		); err != nil {
			cli.Error("flag validation failed", err)
			os.Exit(1)
		}

		// delete helm workload definition based on version
		switch deleteHelmWorkloadDefinitionVersion {
		case "v0":
			var helmWorkloadDefinitionConfig config_v0.HelmWorkloadDefinitionConfig
			if deleteHelmWorkloadDefinitionConfigPath != "" {
				// load helm workload definition config
				configContent, err := os.ReadFile(deleteHelmWorkloadDefinitionConfigPath)
				if err != nil {
					cli.Error("failed to read config file", err)
					os.Exit(1)
				}
				if err := yaml.UnmarshalStrict(configContent, &helmWorkloadDefinitionConfig); err != nil {
					cli.Error("failed to unmarshal config file yaml content", err)
					os.Exit(1)
				}
			} else {
				helmWorkloadDefinitionConfig = config_v0.HelmWorkloadDefinitionConfig{
					HelmWorkloadDefinition: config_v0.HelmWorkloadDefinitionValues{
						Name: &deleteHelmWorkloadDefinitionName,
					},
				}
			}

			// delete helm workload definition
			helmWorkloadDefinition := helmWorkloadDefinitionConfig.HelmWorkloadDefinition
			helmWorkloadDefinition.HelmWorkloadConfigPath = &deleteHelmWorkloadDefinitionConfigPath
			deletedHelmWorkloadDefinition, err := helmWorkloadDefinition.Delete(apiClient, apiEndpoint)
			if err != nil {
				cli.Error("failed to delete helm workload definition", err)
				os.Exit(1)
			}

			cli.Complete(fmt.Sprintf("helm workload definition %s deleted", *deletedHelmWorkloadDefinition.Name))
		default:
			cli.Error("", errors.New("unrecognized object version"))
			os.Exit(1)
		}
	},
	Short:        "Delete an existing helm workload definition",
	SilenceUsage: true,
	Use:          "helm-workload-definition",
}

func init() {
	DeleteCmd.AddCommand(DeleteHelmWorkloadDefinitionCmd)

	DeleteHelmWorkloadDefinitionCmd.Flags().StringVarP(
		&deleteHelmWorkloadDefinitionConfigPath,
		"config", "c", "", "Path to file with helm workload definition config.",
	)
	DeleteHelmWorkloadDefinitionCmd.Flags().StringVarP(
		&deleteHelmWorkloadDefinitionName,
		"name", "n", "", "Name of helm workload definition.",
	)
	DeleteHelmWorkloadDefinitionCmd.Flags().StringVarP(
		&cliArgs.ControlPlaneName,
		"control-plane-name", "i", "", "Optional. Name of control plane. Will default to current control plane if not provided.",
	)
	DeleteHelmWorkloadDefinitionCmd.Flags().StringVarP(
		&deleteHelmWorkloadDefinitionVersion,
		"version", "v", "v0", "Version of helm workload definitions object to delete. One of: [v0]",
	)
}

var (
	describeHelmWorkloadDefinitionConfigPath string
	describeHelmWorkloadDefinitionName       string
	describeHelmWorkloadDefinitionField      string
	describeHelmWorkloadDefinitionOutput     string
	describeHelmWorkloadDefinitionVersion    string
)

// DescribeHelmWorkloadDefinitionCmd representes the helm-workload-definition command
var DescribeHelmWorkloadDefinitionCmd = &cobra.Command{
	Example: "  # Get the plain output description for a helm workload definition\n  tptctl describe helm-workload-definition -n some-helm-workload-definition\n\n  # Get JSON output for a helm workload definition\n  tptctl describe helm-workload-definition -n some-helm-workload-definition -o json\n\n  # Get the value of the Name field for a helm workload definition\n  tptctl describe helm-workload-definition -n some-helm-workload-definition -f Name ",
	Long:    "Describe a helm workload definition.  This command can give you a plain output description, output all fields in JSON or YAML format, or provide the value of any specific field.\n\nNote: any values that are encrypted in the database will be redacted unless the field is specifically requested with the --field flag.",
	PreRun:  CommandPreRunFunc,
	Run: func(cmd *cobra.Command, args []string) {
		apiClient, _, apiEndpoint, _ := GetClientContext(cmd)

		// flag validation
		if err := cli.ValidateConfigNameFlags(
			describeHelmWorkloadDefinitionConfigPath,
			describeHelmWorkloadDefinitionName,
			"helm workload definition",
		); err != nil {
			cli.Error("flag validation failed", err)
			os.Exit(1)
		}

		if err := cli.ValidateDescribeOutputFlag(
			describeHelmWorkloadDefinitionOutput,
			"helm workload definition",
		); err != nil {
			cli.Error("flag validation failed", err)
			os.Exit(1)
		}

		// get helm workload definition
		var helmWorkloadDefinition interface{}
		switch describeHelmWorkloadDefinitionVersion {
		case "v0":
			// load helm workload definition config by name or config file
			var helmWorkloadDefinitionConfig config_v0.HelmWorkloadDefinitionConfig
			if describeHelmWorkloadDefinitionConfigPath != "" {
				configContent, err := os.ReadFile(describeHelmWorkloadDefinitionConfigPath)
				if err != nil {
					cli.Error("failed to read config file", err)
					os.Exit(1)
				}
				if err := yaml.UnmarshalStrict(configContent, &helmWorkloadDefinitionConfig); err != nil {
					cli.Error("failed to unmarshal config file yaml content", err)
					os.Exit(1)
				}
			} else {
				helmWorkloadDefinitionConfig = config_v0.HelmWorkloadDefinitionConfig{
					HelmWorkloadDefinition: config_v0.HelmWorkloadDefinitionValues{
						Name: &describeHelmWorkloadDefinitionName,
					},
				}
			}

			// get helm workload definition object by name
			obj, err := client_v0.GetHelmWorkloadDefinitionByName(
				apiClient,
				apiEndpoint,
				*helmWorkloadDefinitionConfig.HelmWorkloadDefinition.Name,
			)
			if err != nil {
				cli.Error("failed to retrieve helm workload definition details", err)
				os.Exit(1)
			}
			helmWorkloadDefinition = obj

			// return plain output if requested
			if describeHelmWorkloadDefinitionOutput == "plain" {
				if err := outputDescribev0HelmWorkloadDefinitionCmd(
					helmWorkloadDefinition.(*api_v0.HelmWorkloadDefinition),
					&helmWorkloadDefinitionConfig,
					apiClient,
					apiEndpoint,
				); err != nil {
					cli.Error("failed to describe helm workload definition", err)
					os.Exit(1)
				}
			}
		default:
			cli.Error("", errors.New("unrecognized object version"))
			os.Exit(1)
		}

		// return field value if specified
		if describeHelmWorkloadDefinitionField != "" {
			fieldVal, err := util.GetObjectFieldValue(
				helmWorkloadDefinition,
				describeHelmWorkloadDefinitionField,
			)
			if err != nil {
				cli.Error("failed to get field value from helm workload definition", err)
				os.Exit(1)
			}

			// decrypt value as needed
			encrypted, err := encryption.IsEncryptedField(helmWorkloadDefinition, describeHelmWorkloadDefinitionField)
			if err != nil {
				cli.Error("", err)
			}
			if encrypted {
				// get encryption key from threeport config
				threeportConfig, requestedControlPlane, err := config_v0.GetThreeportConfig(cliArgs.ControlPlaneName)
				if err != nil {
					cli.Error("failed to get threeport config: %w", err)
					os.Exit(1)
				}
				encryptionKey, err := threeportConfig.GetThreeportEncryptionKey(requestedControlPlane)
				if err != nil {
					cli.Error("failed to get encryption key from threeport config: %w", err)
					os.Exit(1)
				}

				// decrypt value for output
				decryptedVal, err := encryption.Decrypt(encryptionKey, fieldVal.String())
				if err != nil {
					cli.Error("failed to decrypt value: %w", err)
				}
				fmt.Println(decryptedVal)
				os.Exit(0)
			} else {
				fmt.Println(fieldVal.Interface())
				os.Exit(0)
			}
		}

		// produce json or yaml output if requested
		switch describeHelmWorkloadDefinitionOutput {
		case "json":
			// redact encrypted values
			redactedHelmWorkloadDefinition := encryption.RedactEncryptedValues(helmWorkloadDefinition)

			// marshal to JSON then print
			helmWorkloadDefinitionJson, err := json.MarshalIndent(redactedHelmWorkloadDefinition, "", "  ")
			if err != nil {
				cli.Error("failed to marshal helm workload definition into JSON", err)
				os.Exit(1)
			}

			fmt.Println(string(helmWorkloadDefinitionJson))
		case "yaml":
			// redact encrypted values
			redactedHelmWorkloadDefinition := encryption.RedactEncryptedValues(helmWorkloadDefinition)

			// marshal to JSON then convert to YAML - this results in field
			// names with correct capitalization vs marshalling directly to YAML
			helmWorkloadDefinitionJson, err := json.MarshalIndent(redactedHelmWorkloadDefinition, "", "  ")
			if err != nil {
				cli.Error("failed to marshal helm workload definition into JSON", err)
				os.Exit(1)
			}
			helmWorkloadDefinitionYaml, err := ghodss_yaml.JSONToYAML(helmWorkloadDefinitionJson)
			if err != nil {
				cli.Error("failed to convert helm workload definition JSON to YAML", err)
				os.Exit(1)
			}

			fmt.Println(string(helmWorkloadDefinitionYaml))
		}
	},
	Short:        "Describe a helm workload definition",
	SilenceUsage: true,
	Use:          "helm-workload-definition",
}

func init() {
	DescribeCmd.AddCommand(DescribeHelmWorkloadDefinitionCmd)

	DescribeHelmWorkloadDefinitionCmd.Flags().StringVarP(
		&describeHelmWorkloadDefinitionConfigPath,
		"config", "c", "", "Path to file with helm workload definition config.",
	)
	DescribeHelmWorkloadDefinitionCmd.Flags().StringVarP(
		&describeHelmWorkloadDefinitionName,
		"name", "n", "", "Name of helm workload definition.",
	)
	DescribeHelmWorkloadDefinitionCmd.Flags().StringVarP(
		&describeHelmWorkloadDefinitionOutput,
		"output", "o", "plain", "Output format for object description. One of 'plain','json','yaml'.  Will be ignored if the --field flag is also used.  Plain output produces select details about the object.  JSON and YAML output formats include all direct attributes of the object",
	)
	DescribeHelmWorkloadDefinitionCmd.Flags().StringVarP(
		&describeHelmWorkloadDefinitionField,
		"field", "f", "", "Object field to get value for. If used, --output flag will be ignored.  *Only* the value of the desired field will be returned.  Will not return information on related objects, only direct attributes of the object itself.",
	)
	DescribeHelmWorkloadDefinitionCmd.Flags().StringVarP(
		&cliArgs.ControlPlaneName,
		"control-plane-name", "i", "", "Optional. Name of control plane. Will default to current control plane if not provided.",
	)
	DescribeHelmWorkloadDefinitionCmd.Flags().StringVarP(
		&describeHelmWorkloadDefinitionVersion,
		"version", "v", "v0", "Version of helm workload definitions object to describe. One of: [v0]",
	)
}

///////////////////////////////////////////////////////////////////////////////
// HelmWorkload
///////////////////////////////////////////////////////////////////////////////

// GetHelmWorkloadsCmd represents the helm-workload command
var GetHelmWorkloadsCmd = &cobra.Command{
	Example: "  tptctl get helm-workloads",
	Long:    "Get helm workloads from the system.\n\nA helm workload is a simple abstraction of helm workload definitions and helm workload instances.\nThis command displays all instances and the definitions used to configure them.",
	PreRun:  CommandPreRunFunc,
	Run: func(cmd *cobra.Command, args []string) {
		apiClient, _, apiEndpoint, requestedControlPlane := GetClientContext(cmd)

		// get helm workloads
		v0helmWorkloadInstances, err := client_v0.GetHelmWorkloadInstances(apiClient, apiEndpoint)
		if err != nil {
			cli.Error("failed to retrieve helm workload instances", err)
			os.Exit(1)
		}

		// write the output
		if len(*v0helmWorkloadInstances) == 0 {
			cli.Info(fmt.Sprintf(
				"No helm workload instances currently managed by %s threeport control plane",
				requestedControlPlane,
			))
			os.Exit(0)
		}
		if err := outputGetHelmWorkloadsCmd(
			v0helmWorkloadInstances,
			apiClient,
			apiEndpoint,
		); err != nil {
			cli.Error("failed to produce output: %s", err)
			os.Exit(0)
		}
	},
	Short:        "Get helm workloads from the system",
	SilenceUsage: true,
	Use:          "helm-workloads",
}

func init() {
	GetCmd.AddCommand(GetHelmWorkloadsCmd)

	GetHelmWorkloadsCmd.Flags().StringVarP(
		&cliArgs.ControlPlaneName,
		"control-plane-name", "i", "", "Optional. Name of control plane. Will default to current control plane if not provided.",
	)
}

var (
	createHelmWorkloadConfigPath string
	createHelmWorkloadVersion    string
)

// CreateHelmWorkloadCmd represents the helm-workload command
var CreateHelmWorkloadCmd = &cobra.Command{
	Example: "  tptctl create helm-workload --config path/to/config.yaml",
	Long:    "Create a new helm workload. This command creates a new helm workload definition and helm workload instance based on the helm workload config.",
	PreRun:  CommandPreRunFunc,
	Run: func(cmd *cobra.Command, args []string) {
		apiClient, _, apiEndpoint, _ := GetClientContext(cmd)

		// read helm workload config
		configContent, err := os.ReadFile(createHelmWorkloadConfigPath)
		if err != nil {
			cli.Error("failed to read config file", err)
			os.Exit(1)
		}

		// create helm workload based on version
		switch createHelmWorkloadVersion {
		case "v0":
			var helmWorkloadConfig config_v0.HelmWorkloadConfig
			if err := yaml.UnmarshalStrict(configContent, &helmWorkloadConfig); err != nil {
				cli.Error("failed to unmarshal config file yaml content", err)
				os.Exit(1)
			}

			// create helm workload
			helmWorkload := helmWorkloadConfig.HelmWorkload
			helmWorkload.HelmWorkloadConfigPath = &createHelmWorkloadConfigPath
			createdHelmWorkloadDefinition, createdHelmWorkloadInstance, err := helmWorkload.Create(
				apiClient,
				apiEndpoint,
			)
			if err != nil {
				cli.Error("failed to create helm workload", err)
				os.Exit(1)
			}

			cli.Info(fmt.Sprintf("helm workload definition %s created", *createdHelmWorkloadDefinition.Name))
			cli.Info(fmt.Sprintf("helm workload instance %s created", *createdHelmWorkloadInstance.Name))
			cli.Complete(fmt.Sprintf("helm workload %s created", *helmWorkloadConfig.HelmWorkload.Name))
		default:
			cli.Error("", errors.New("unrecognized object version"))
			os.Exit(1)
		}
	},
	Short:        "Create a new helm workload",
	SilenceUsage: true,
	Use:          "helm-workload",
}

func init() {
	CreateCmd.AddCommand(CreateHelmWorkloadCmd)

	CreateHelmWorkloadCmd.Flags().StringVarP(
		&createHelmWorkloadConfigPath,
		"config", "c", "", "Path to file with helm workload config.",
	)
	CreateHelmWorkloadCmd.MarkFlagRequired("config")
	CreateHelmWorkloadCmd.Flags().StringVarP(
		&cliArgs.ControlPlaneName,
		"control-plane-name", "i", "", "Optional. Name of control plane. Will default to current control plane if not provided.",
	)
	CreateHelmWorkloadCmd.Flags().StringVarP(
		&createHelmWorkloadVersion,
		"version", "v", "v0", "Version of helm workloads object to create. One of: [v0]",
	)
}

var (
	deleteHelmWorkloadConfigPath string
	deleteHelmWorkloadName       string
	deleteHelmWorkloadVersion    string
)

// DeleteHelmWorkloadCmd represents the helm-workload command
var DeleteHelmWorkloadCmd = &cobra.Command{
	Example: "  # delete based on config file\n  tptctl delete helm-workload --config path/to/config.yaml\n\n  # delete based on name\n  tptctl delete helm-workload --name some-helm-workload",
	Long:    "Delete an existing helm workload. This command deletes an existing helm workload definition and helm workload instance based on the helm workload config.",
	PreRun:  CommandPreRunFunc,
	Run: func(cmd *cobra.Command, args []string) {
		apiClient, _, apiEndpoint, _ := GetClientContext(cmd)

		// flag validation
		if deleteHelmWorkloadConfigPath == "" {
			cli.Error("flag validation failed", errors.New("config file path is required"))
		}

		// read helm workload config
		configContent, err := os.ReadFile(deleteHelmWorkloadConfigPath)
		if err != nil {
			cli.Error("failed to read config file", err)
			os.Exit(1)
		}

		// delete helm workload based on version
		switch deleteHelmWorkloadVersion {
		case "v0":
			var helmWorkloadConfig config_v0.HelmWorkloadConfig
			if err := yaml.UnmarshalStrict(configContent, &helmWorkloadConfig); err != nil {
				cli.Error("failed to unmarshal config file yaml content", err)
				os.Exit(1)
			}

			// delete helm workload
			helmWorkload := helmWorkloadConfig.HelmWorkload
			helmWorkload.HelmWorkloadConfigPath = &deleteHelmWorkloadConfigPath
			_, _, err = helmWorkload.Delete(apiClient, apiEndpoint)
			if err != nil {
				cli.Error("failed to delete helm workload", err)
				os.Exit(1)
			}

			cli.Info(fmt.Sprintf("helm workload definition %s deleted", *helmWorkload.Name))
			cli.Info(fmt.Sprintf("helm workload instance %s deleted", *helmWorkload.Name))
			cli.Complete(fmt.Sprintf("helm workload %s deleted", *helmWorkloadConfig.HelmWorkload.Name))
		default:
			cli.Error("", errors.New("unrecognized object version"))
			os.Exit(1)
		}
	},
	Short:        "Delete an existing helm workload",
	SilenceUsage: true,
	Use:          "helm-workload",
}

func init() {
	DeleteCmd.AddCommand(DeleteHelmWorkloadCmd)

	DeleteHelmWorkloadCmd.Flags().StringVarP(
		&deleteHelmWorkloadConfigPath,
		"config", "c", "", "Path to file with helm workload config.",
	)
	DeleteHelmWorkloadCmd.Flags().StringVarP(
		&cliArgs.ControlPlaneName,
		"control-plane-name", "i", "", "Optional. Name of control plane. Will default to current control plane if not provided.",
	)
	DeleteHelmWorkloadCmd.Flags().StringVarP(
		&deleteHelmWorkloadVersion,
		"version", "v", "v0", "Version of helm workloads object to delete. One of: [v0]",
	)
}

///////////////////////////////////////////////////////////////////////////////
// HelmWorkloadInstance
///////////////////////////////////////////////////////////////////////////////

var getHelmWorkloadInstanceVersion string

// GetHelmWorkloadInstancesCmd represents the helm-workload-instance command
var GetHelmWorkloadInstancesCmd = &cobra.Command{
	Example: "  tptctl get helm-workload-instances",
	Long:    "Get helm workload instances from the system.",
	PreRun:  CommandPreRunFunc,
	Run: func(cmd *cobra.Command, args []string) {
		apiClient, _, apiEndpoint, requestedControlPlane := GetClientContext(cmd)

		switch getHelmWorkloadInstanceVersion {
		case "v0":
			// get helm workload instances
			helmWorkloadInstances, err := client_v0.GetHelmWorkloadInstances(apiClient, apiEndpoint)
			if err != nil {
				cli.Error("failed to retrieve helm workload instances", err)
				os.Exit(1)
			}

			// write the output
			if len(*helmWorkloadInstances) == 0 {
				cli.Info(fmt.Sprintf(
					"No helm workload instances currently managed by %s threeport control plane",
					requestedControlPlane,
				))
				os.Exit(0)
			}
			if err := outputGetv0HelmWorkloadInstancesCmd(
				helmWorkloadInstances,
				apiClient,
				apiEndpoint,
			); err != nil {
				cli.Error("failed to produce output", err)
				os.Exit(0)
			}
		default:
			cli.Error("", errors.New("unrecognized object version"))
			os.Exit(1)
		}
	},
	Short:        "Get helm workload instances from the system",
	SilenceUsage: true,
	Use:          "helm-workload-instances",
}

func init() {
	GetCmd.AddCommand(GetHelmWorkloadInstancesCmd)

	GetHelmWorkloadInstancesCmd.Flags().StringVarP(
		&cliArgs.ControlPlaneName,
		"control-plane-name", "i", "", "Optional. Name of control plane. Will default to current control plane if not provided.",
	)
	GetHelmWorkloadInstancesCmd.Flags().StringVarP(
		&getHelmWorkloadInstanceVersion,
		"version", "v", "v0", "Version of helm workload instances object to retrieve. One of: [v0]",
	)
}

var (
	createHelmWorkloadInstanceConfigPath string
	createHelmWorkloadInstanceVersion    string
)

// CreateHelmWorkloadInstanceCmd represents the helm-workload-instance command
var CreateHelmWorkloadInstanceCmd = &cobra.Command{
	Example: "  tptctl create helm-workload-instance --config path/to/config.yaml",
	Long:    "Create a new helm workload instance.",
	PreRun:  CommandPreRunFunc,
	Run: func(cmd *cobra.Command, args []string) {
		apiClient, _, apiEndpoint, _ := GetClientContext(cmd)

		// read helm workload instance config
		configContent, err := os.ReadFile(createHelmWorkloadInstanceConfigPath)
		if err != nil {
			cli.Error("failed to read config file", err)
			os.Exit(1)
		}
		// create helm workload instance based on version
		switch createHelmWorkloadInstanceVersion {
		case "v0":
			var helmWorkloadInstanceConfig config_v0.HelmWorkloadInstanceConfig
			if err := yaml.UnmarshalStrict(configContent, &helmWorkloadInstanceConfig); err != nil {
				cli.Error("failed to unmarshal config file yaml content", err)
				os.Exit(1)
			}

			// create helm workload instance
			helmWorkloadInstance := helmWorkloadInstanceConfig.HelmWorkloadInstance
			helmWorkloadInstance.HelmWorkloadConfigPath = &createHelmWorkloadInstanceConfigPath
			createdHelmWorkloadInstance, err := helmWorkloadInstance.Create(apiClient, apiEndpoint)
			if err != nil {
				cli.Error("failed to create helm workload instance", err)
				os.Exit(1)
			}

			cli.Complete(fmt.Sprintf("helm workload instance %s created", *createdHelmWorkloadInstance.Name))
		default:
			cli.Error("", errors.New("unrecognized object version"))
			os.Exit(1)
		}
	},
	Short:        "Create a new helm workload instance",
	SilenceUsage: true,
	Use:          "helm-workload-instance",
}

func init() {
	CreateCmd.AddCommand(CreateHelmWorkloadInstanceCmd)

	CreateHelmWorkloadInstanceCmd.Flags().StringVarP(
		&createHelmWorkloadInstanceConfigPath,
		"config", "c", "", "Path to file with helm workload instance config.",
	)
	CreateHelmWorkloadInstanceCmd.MarkFlagRequired("config")
	CreateHelmWorkloadInstanceCmd.Flags().StringVarP(
		&cliArgs.ControlPlaneName,
		"control-plane-name", "i", "", "Optional. Name of control plane. Will default to current control plane if not provided.",
	)
	CreateHelmWorkloadInstanceCmd.Flags().StringVarP(
		&createHelmWorkloadInstanceVersion,
		"version", "v", "v0", "Version of helm workload instances object to create. One of: [v0]",
	)
}

var (
	deleteHelmWorkloadInstanceConfigPath string
	deleteHelmWorkloadInstanceName       string
	deleteHelmWorkloadInstanceVersion    string
)

// DeleteHelmWorkloadInstanceCmd represents the helm-workload-instance command
var DeleteHelmWorkloadInstanceCmd = &cobra.Command{
	Example: "  # delete based on config file\n  tptctl delete helm-workload-instance --config path/to/config.yaml\n\n  # delete based on name\n  tptctl delete helm-workload-instance --name some-helm-workload-instance",
	Long:    "Delete an existing helm workload instance.",
	PreRun:  CommandPreRunFunc,
	Run: func(cmd *cobra.Command, args []string) {
		apiClient, _, apiEndpoint, _ := GetClientContext(cmd)

		// flag validation
		if err := cli.ValidateConfigNameFlags(
			deleteHelmWorkloadInstanceConfigPath,
			deleteHelmWorkloadInstanceName,
			"helm workload instance",
		); err != nil {
			cli.Error("flag validation failed", err)
			os.Exit(1)
		}

		// delete helm workload instance based on version
		switch deleteHelmWorkloadInstanceVersion {
		case "v0":
			var helmWorkloadInstanceConfig config_v0.HelmWorkloadInstanceConfig
			if deleteHelmWorkloadInstanceConfigPath != "" {
				// load helm workload instance config
				configContent, err := os.ReadFile(deleteHelmWorkloadInstanceConfigPath)
				if err != nil {
					cli.Error("failed to read config file", err)
					os.Exit(1)
				}
				if err := yaml.UnmarshalStrict(configContent, &helmWorkloadInstanceConfig); err != nil {
					cli.Error("failed to unmarshal config file yaml content", err)
					os.Exit(1)
				}
			} else {
				helmWorkloadInstanceConfig = config_v0.HelmWorkloadInstanceConfig{
					HelmWorkloadInstance: config_v0.HelmWorkloadInstanceValues{
						Name: &deleteHelmWorkloadInstanceName,
					},
				}
			}

			// delete helm workload instance
			helmWorkloadInstance := helmWorkloadInstanceConfig.HelmWorkloadInstance
			helmWorkloadInstance.HelmWorkloadConfigPath = &deleteHelmWorkloadInstanceConfigPath
			deletedHelmWorkloadInstance, err := helmWorkloadInstance.Delete(apiClient, apiEndpoint)
			if err != nil {
				cli.Error("failed to delete helm workload instance", err)
				os.Exit(1)
			}

			cli.Complete(fmt.Sprintf("helm workload instance %s deleted", *deletedHelmWorkloadInstance.Name))
		default:
			cli.Error("", errors.New("unrecognized object version"))
			os.Exit(1)
		}
	},
	Short:        "Delete an existing helm workload instance",
	SilenceUsage: true,
	Use:          "helm-workload-instance",
}

func init() {
	DeleteCmd.AddCommand(DeleteHelmWorkloadInstanceCmd)

	DeleteHelmWorkloadInstanceCmd.Flags().StringVarP(
		&deleteHelmWorkloadInstanceConfigPath,
		"config", "c", "", "Path to file with helm workload instance config.",
	)
	DeleteHelmWorkloadInstanceCmd.Flags().StringVarP(
		&deleteHelmWorkloadInstanceName,
		"name", "n", "", "Name of helm workload instance.",
	)
	DeleteHelmWorkloadInstanceCmd.Flags().StringVarP(
		&cliArgs.ControlPlaneName,
		"control-plane-name", "i", "", "Optional. Name of control plane. Will default to current control plane if not provided.",
	)
	DeleteHelmWorkloadInstanceCmd.Flags().StringVarP(
		&deleteHelmWorkloadInstanceVersion,
		"version", "v", "v0", "Version of helm workload instances object to delete. One of: [v0]",
	)
}

var (
	describeHelmWorkloadInstanceConfigPath string
	describeHelmWorkloadInstanceName       string
	describeHelmWorkloadInstanceField      string
	describeHelmWorkloadInstanceOutput     string
	describeHelmWorkloadInstanceVersion    string
)

// DescribeHelmWorkloadInstanceCmd representes the helm-workload-instance command
var DescribeHelmWorkloadInstanceCmd = &cobra.Command{
	Example: "  # Get the plain output description for a helm workload instance\n  tptctl describe helm-workload-instance -n some-helm-workload-instance\n\n  # Get JSON output for a helm workload instance\n  tptctl describe helm-workload-instance -n some-helm-workload-instance -o json\n\n  # Get the value of the Name field for a helm workload instance\n  tptctl describe helm-workload-instance -n some-helm-workload-instance -f Name ",
	Long:    "Describe a helm workload instance.  This command can give you a plain output description, output all fields in JSON or YAML format, or provide the value of any specific field.\n\nNote: any values that are encrypted in the database will be redacted unless the field is specifically requested with the --field flag.",
	PreRun:  CommandPreRunFunc,
	Run: func(cmd *cobra.Command, args []string) {
		apiClient, _, apiEndpoint, _ := GetClientContext(cmd)

		// flag validation
		if err := cli.ValidateConfigNameFlags(
			describeHelmWorkloadInstanceConfigPath,
			describeHelmWorkloadInstanceName,
			"helm workload instance",
		); err != nil {
			cli.Error("flag validation failed", err)
			os.Exit(1)
		}

		if err := cli.ValidateDescribeOutputFlag(
			describeHelmWorkloadInstanceOutput,
			"helm workload instance",
		); err != nil {
			cli.Error("flag validation failed", err)
			os.Exit(1)
		}

		// get helm workload instance
		var helmWorkloadInstance interface{}
		switch describeHelmWorkloadInstanceVersion {
		case "v0":
			// load helm workload instance config by name or config file
			var helmWorkloadInstanceConfig config_v0.HelmWorkloadInstanceConfig
			if describeHelmWorkloadInstanceConfigPath != "" {
				configContent, err := os.ReadFile(describeHelmWorkloadInstanceConfigPath)
				if err != nil {
					cli.Error("failed to read config file", err)
					os.Exit(1)
				}
				if err := yaml.UnmarshalStrict(configContent, &helmWorkloadInstanceConfig); err != nil {
					cli.Error("failed to unmarshal config file yaml content", err)
					os.Exit(1)
				}
			} else {
				helmWorkloadInstanceConfig = config_v0.HelmWorkloadInstanceConfig{
					HelmWorkloadInstance: config_v0.HelmWorkloadInstanceValues{
						Name: &describeHelmWorkloadInstanceName,
					},
				}
			}

			// get helm workload instance object by name
			obj, err := client_v0.GetHelmWorkloadInstanceByName(
				apiClient,
				apiEndpoint,
				*helmWorkloadInstanceConfig.HelmWorkloadInstance.Name,
			)
			if err != nil {
				cli.Error("failed to retrieve helm workload instance details", err)
				os.Exit(1)
			}
			helmWorkloadInstance = obj

			// return plain output if requested
			if describeHelmWorkloadInstanceOutput == "plain" {
				if err := outputDescribev0HelmWorkloadInstanceCmd(
					helmWorkloadInstance.(*api_v0.HelmWorkloadInstance),
					&helmWorkloadInstanceConfig,
					apiClient,
					apiEndpoint,
				); err != nil {
					cli.Error("failed to describe helm workload instance", err)
					os.Exit(1)
				}
			}
		default:
			cli.Error("", errors.New("unrecognized object version"))
			os.Exit(1)
		}

		// return field value if specified
		if describeHelmWorkloadInstanceField != "" {
			fieldVal, err := util.GetObjectFieldValue(
				helmWorkloadInstance,
				describeHelmWorkloadInstanceField,
			)
			if err != nil {
				cli.Error("failed to get field value from helm workload instance", err)
				os.Exit(1)
			}

			// decrypt value as needed
			encrypted, err := encryption.IsEncryptedField(helmWorkloadInstance, describeHelmWorkloadInstanceField)
			if err != nil {
				cli.Error("", err)
			}
			if encrypted {
				// get encryption key from threeport config
				threeportConfig, requestedControlPlane, err := config_v0.GetThreeportConfig(cliArgs.ControlPlaneName)
				if err != nil {
					cli.Error("failed to get threeport config: %w", err)
					os.Exit(1)
				}
				encryptionKey, err := threeportConfig.GetThreeportEncryptionKey(requestedControlPlane)
				if err != nil {
					cli.Error("failed to get encryption key from threeport config: %w", err)
					os.Exit(1)
				}

				// decrypt value for output
				decryptedVal, err := encryption.Decrypt(encryptionKey, fieldVal.String())
				if err != nil {
					cli.Error("failed to decrypt value: %w", err)
				}
				fmt.Println(decryptedVal)
				os.Exit(0)
			} else {
				fmt.Println(fieldVal.Interface())
				os.Exit(0)
			}
		}

		// produce json or yaml output if requested
		switch describeHelmWorkloadInstanceOutput {
		case "json":
			// redact encrypted values
			redactedHelmWorkloadInstance := encryption.RedactEncryptedValues(helmWorkloadInstance)

			// marshal to JSON then print
			helmWorkloadInstanceJson, err := json.MarshalIndent(redactedHelmWorkloadInstance, "", "  ")
			if err != nil {
				cli.Error("failed to marshal helm workload instance into JSON", err)
				os.Exit(1)
			}

			fmt.Println(string(helmWorkloadInstanceJson))
		case "yaml":
			// redact encrypted values
			redactedHelmWorkloadInstance := encryption.RedactEncryptedValues(helmWorkloadInstance)

			// marshal to JSON then convert to YAML - this results in field
			// names with correct capitalization vs marshalling directly to YAML
			helmWorkloadInstanceJson, err := json.MarshalIndent(redactedHelmWorkloadInstance, "", "  ")
			if err != nil {
				cli.Error("failed to marshal helm workload instance into JSON", err)
				os.Exit(1)
			}
			helmWorkloadInstanceYaml, err := ghodss_yaml.JSONToYAML(helmWorkloadInstanceJson)
			if err != nil {
				cli.Error("failed to convert helm workload instance JSON to YAML", err)
				os.Exit(1)
			}

			fmt.Println(string(helmWorkloadInstanceYaml))
		}
	},
	Short:        "Describe a helm workload instance",
	SilenceUsage: true,
	Use:          "helm-workload-instance",
}

func init() {
	DescribeCmd.AddCommand(DescribeHelmWorkloadInstanceCmd)

	DescribeHelmWorkloadInstanceCmd.Flags().StringVarP(
		&describeHelmWorkloadInstanceConfigPath,
		"config", "c", "", "Path to file with helm workload instance config.",
	)
	DescribeHelmWorkloadInstanceCmd.Flags().StringVarP(
		&describeHelmWorkloadInstanceName,
		"name", "n", "", "Name of helm workload instance.",
	)
	DescribeHelmWorkloadInstanceCmd.Flags().StringVarP(
		&describeHelmWorkloadInstanceOutput,
		"output", "o", "plain", "Output format for object description. One of 'plain','json','yaml'.  Will be ignored if the --field flag is also used.  Plain output produces select details about the object.  JSON and YAML output formats include all direct attributes of the object",
	)
	DescribeHelmWorkloadInstanceCmd.Flags().StringVarP(
		&describeHelmWorkloadInstanceField,
		"field", "f", "", "Object field to get value for. If used, --output flag will be ignored.  *Only* the value of the desired field will be returned.  Will not return information on related objects, only direct attributes of the object itself.",
	)
	DescribeHelmWorkloadInstanceCmd.Flags().StringVarP(
		&cliArgs.ControlPlaneName,
		"control-plane-name", "i", "", "Optional. Name of control plane. Will default to current control plane if not provided.",
	)
	DescribeHelmWorkloadInstanceCmd.Flags().StringVarP(
		&describeHelmWorkloadInstanceVersion,
		"version", "v", "v0", "Version of helm workload instances object to describe. One of: [v0]",
	)
}
