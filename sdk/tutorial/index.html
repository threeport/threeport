
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for Threeport application orchestrator">
      
      
        <meta name="author" content="Threeport developers">
      
      
      
        <link rel="prev" href="../install/">
      
      
        <link rel="next" href="../../architecture/threeport-core/">
      
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>SDK Tutorial - Threeport</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#threeport-sdk-tutorial" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Threeport" class="md-header__button md-logo" aria-label="Threeport" data-md-component="logo">
      
  <img src="../../img/threeport-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Threeport
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              SDK Tutorial
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="teal"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/threeport/threeport" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    threeport/threeport
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Threeport" class="md-nav__button md-logo" aria-label="Threeport" data-md-component="logo">
      
  <img src="../../img/threeport-logo.png" alt="logo">

    </a>
    Threeport
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/threeport/threeport" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    threeport/threeport
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Intro
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contact/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contact
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Concepts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/application-orchestration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Application Orchestration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/orchestration-abstractions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Orchestration Abstractions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/dependencies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dependencies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/use-cases/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Use Cases
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/comparisons/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Comparisons
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/definitions-instances/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Definitions & Instances
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/extensions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Custom Modules
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Install
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Install
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../install/install-tptctl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Threeport CLI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../install/install-threeport-local/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Local Threeport
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../install/install-threeport-aws/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Remote Threeport
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Threeport Objects
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Threeport Objects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1" >
        
          
          <label class="md-nav__link" for="__nav_7_1" id="__nav_7_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Kubernetes Runtimes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes Runtimes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes-runtime/kubernetes-intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes-runtime/remote-kubernetes-runtime/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Remote Kubernetes Runtime
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Workloads
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            Workloads
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workloads/workload-intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workloads/deploy-workload-local/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Local Workload
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workloads/deploy-workload-aws/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Remote Workload
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workloads/namespaces/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Namespace Management
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Helm Workloads
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            Helm Workloads
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../helm-workloads/helm-intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../helm-workloads/deploy-helm-local/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Local Helm Workload
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    AWS
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            AWS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-iam/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IAM Permissions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/basic-aws-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic AWS Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/advanced-aws-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Advanced AWS Setup
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_5" >
        
          
          <label class="md-nav__link" for="__nav_7_5" id="__nav_7_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Terraform
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_5">
            <span class="md-nav__icon md-icon"></span>
            Terraform
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../terraform/terraform-intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../terraform/rds-database/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS RDS Database
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6" >
        
          
          <label class="md-nav__link" for="__nav_7_6" id="__nav_7_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Gateways
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_6">
            <span class="md-nav__icon md-icon"></span>
            Gateways
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateways/gateway-intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_7" >
        
          
          <label class="md-nav__link" for="__nav_7_7" id="__nav_7_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Secrets
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_7">
            <span class="md-nav__icon md-icon"></span>
            Secrets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../secrets/secrets-intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_8" >
        
          
          <label class="md-nav__link" for="__nav_7_8" id="__nav_7_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Observability
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_8">
            <span class="md-nav__icon md-icon"></span>
            Observability
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../observability/observability-intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../observability/deploy-observability-local/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Local Observability
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_9" >
        
          
          <label class="md-nav__link" for="__nav_7_9" id="__nav_7_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Control Planes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_9">
            <span class="md-nav__icon md-icon"></span>
            Control Planes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../control-planes/control-plane-intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    SDK
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            SDK
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sdk-intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SDK Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SDK Install
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    SDK Tutorial
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    SDK Tutorial
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initialize-project" class="md-nav__link">
    <span class="md-ellipsis">
      Initialize Project
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-sdk-config" class="md-nav__link">
    <span class="md-ellipsis">
      Create SDK Config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#define-api" class="md-nav__link">
    <span class="md-ellipsis">
      Define API
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generate-source-code" class="md-nav__link">
    <span class="md-ellipsis">
      Generate Source Code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-controller-business-logic" class="md-nav__link">
    <span class="md-ellipsis">
      Add Controller Business Logic
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Add Controller Business Logic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updates-to-internalwordpressv0_wordpress_definitiongo" class="md-nav__link">
    <span class="md-ellipsis">
      Updates to internal/wordpress/v0_wordpress_definition.go
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updates-to-internalwordpressv0_wordpress_instancego" class="md-nav__link">
    <span class="md-ellipsis">
      Updates to internal/wordpress/v0_wordpress_instance.go
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-internalwordpresswordpress_manifestgo" class="md-nav__link">
    <span class="md-ellipsis">
      Add internal/wordpress/wordpress_manifest.go
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-config-abstractions" class="md-nav__link">
    <span class="md-ellipsis">
      Add Config Abstractions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Add Config Abstractions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updates-to-pkgconfigv0wordpressgo" class="md-nav__link">
    <span class="md-ellipsis">
      Updates to pkg/config/v0/wordpress.go
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build" class="md-nav__link">
    <span class="md-ellipsis">
      Build
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threeport-control-plane" class="md-nav__link">
    <span class="md-ellipsis">
      Threeport Control Plane
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-wordpress-module" class="md-nav__link">
    <span class="md-ellipsis">
      Install WordPress Module
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-the-wordpress-module" class="md-nav__link">
    <span class="md-ellipsis">
      Use the WordPress Module
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verification" class="md-nav__link">
    <span class="md-ellipsis">
      Verification
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    <span class="md-ellipsis">
      Clean Up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/threeport-core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Threeport Core
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/control-plane/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Control Plane
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/threeport-controllers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Threeport Controllers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/kubernetes-federation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kubernetes Federation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initialize-project" class="md-nav__link">
    <span class="md-ellipsis">
      Initialize Project
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-sdk-config" class="md-nav__link">
    <span class="md-ellipsis">
      Create SDK Config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#define-api" class="md-nav__link">
    <span class="md-ellipsis">
      Define API
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generate-source-code" class="md-nav__link">
    <span class="md-ellipsis">
      Generate Source Code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-controller-business-logic" class="md-nav__link">
    <span class="md-ellipsis">
      Add Controller Business Logic
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Add Controller Business Logic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updates-to-internalwordpressv0_wordpress_definitiongo" class="md-nav__link">
    <span class="md-ellipsis">
      Updates to internal/wordpress/v0_wordpress_definition.go
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updates-to-internalwordpressv0_wordpress_instancego" class="md-nav__link">
    <span class="md-ellipsis">
      Updates to internal/wordpress/v0_wordpress_instance.go
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-internalwordpresswordpress_manifestgo" class="md-nav__link">
    <span class="md-ellipsis">
      Add internal/wordpress/wordpress_manifest.go
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-config-abstractions" class="md-nav__link">
    <span class="md-ellipsis">
      Add Config Abstractions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Add Config Abstractions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updates-to-pkgconfigv0wordpressgo" class="md-nav__link">
    <span class="md-ellipsis">
      Updates to pkg/config/v0/wordpress.go
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build" class="md-nav__link">
    <span class="md-ellipsis">
      Build
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threeport-control-plane" class="md-nav__link">
    <span class="md-ellipsis">
      Threeport Control Plane
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-wordpress-module" class="md-nav__link">
    <span class="md-ellipsis">
      Install WordPress Module
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-the-wordpress-module" class="md-nav__link">
    <span class="md-ellipsis">
      Use the WordPress Module
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verification" class="md-nav__link">
    <span class="md-ellipsis">
      Verification
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    <span class="md-ellipsis">
      Clean Up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="threeport-sdk-tutorial">Threeport SDK Tutorial<a class="headerlink" href="#threeport-sdk-tutorial" title="Permanent link">&para;</a></h1>
<p>The following tutorial walks through building a Threeport module for managing
WordPress deployments.</p>
<blockquote>
<p>Note: This tutorial provides instructions to build a new Golang project from
scratch.  If you'd like to skip to the end, the finished project can be viewed on
<a href="https://github.com/threeport/wordpress-threeport-module">GitHub</a>.</p>
</blockquote>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="../install/">Install threeport-sdk</a></li>
<li><a href="../../install/install-tptctl/">Install tptctl</a></li>
<li><a href="https://docs.docker.com/engine/install/">Install docker</a></li>
<li><a href="https://go.dev/doc/install">Install golang</a></li>
<li><a href="https://magefile.org/">Install mage</a></li>
</ul>
<h2 id="initialize-project">Initialize Project<a class="headerlink" href="#initialize-project" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code>mkdir<span class="w"> </span>wordpress-threeport-module
<span class="nb">cd</span><span class="w"> </span>wordpress-threeport-module
git<span class="w"> </span>init
go<span class="w"> </span>mod<span class="w"> </span>init<span class="w"> </span>wordpress-threeport-module
</code></pre></div></td></tr></table></div>
<h2 id="create-sdk-config">Create SDK Config<a class="headerlink" href="#create-sdk-config" title="Permanent link">&para;</a></h2>
<p>Create a new file at the root of the repo called <code>sdk-config.yaml</code> with the
following contents.  Replace the <code>ImageRepo</code> value for one that you have access
to.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">ModuleName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Wordpress</span>
<span class="nt">ApiNamespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example.com</span>
<span class="nt">ApiDocs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">Title</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WordPress Threeport API</span>
<span class="w">  </span><span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API server for the Threeport WordPress module.</span>
<span class="w">  </span><span class="nt">ContactName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">John Doe</span>
<span class="w">  </span><span class="nt">ContactEmail</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">john@example.com</span>
<span class="nt">ImageRepo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/myorg/myimage</span>
<span class="nt">ApiObjectGroups</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wordpress</span>
<span class="w">  </span><span class="nt">Objects</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WordpressDefinition</span>
<span class="w">      </span><span class="nt">Versions</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v0</span>
<span class="w">      </span><span class="nt">Reconcilable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">Tptctl</span><span class="p">:</span>
<span class="w">        </span><span class="nt">Enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WordpressInstance</span>
<span class="w">      </span><span class="nt">Versions</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v0</span>
<span class="w">      </span><span class="nt">Reconcilable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">Tptctl</span><span class="p">:</span>
<span class="w">        </span><span class="nt">Enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div></td></tr></table></div>
<h2 id="define-api">Define API<a class="headerlink" href="#define-api" title="Permanent link">&para;</a></h2>
<p>Use the Threeport SDK to create scaffolding for new API objects.  This will
create a source code file for each API object group defined in the SDK config.
In each source code file, an object that corresponds to a database table will be
scaffolded.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>threeport-sdk<span class="w"> </span>create<span class="w"> </span>--config<span class="w"> </span>sdk-config.yaml
</code></pre></div></td></tr></table></div>
<p>For the SDK config shown above, it will create the following.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// originally generated by &#39;threeport-sdk create&#39; for API object</span>
<span class="c1">// scaffolding but will not be re-generated - intended for modification</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">v0</span>

<span class="kn">import</span><span class="w"> </span><span class="nx">tpapi_v0</span><span class="w"> </span><span class="s">&quot;github.com/threeport/threeport/pkg/api/v0&quot;</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">WordpressDefinition</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">tpapi_v0</span><span class="p">.</span><span class="nx">Common</span><span class="w">         </span><span class="s">`mapstructure:&quot;,squash&quot; swaggerignore:&quot;true&quot;`</span>
<span class="w">    </span><span class="nx">tpapi_v0</span><span class="p">.</span><span class="nx">Reconciliation</span><span class="w"> </span><span class="s">`mapstructure:&quot;,squash&quot;`</span>
<span class="w">    </span><span class="nx">tpapi_v0</span><span class="p">.</span><span class="nx">Definition</span><span class="w">     </span><span class="s">`mapstructure:&quot;,squash&quot;`</span>
<span class="w">    </span><span class="nx">WordpressInstances</span><span class="w">      </span><span class="p">[]</span><span class="o">*</span><span class="nx">WordpressInstance</span><span class="w"> </span><span class="s">`json:&quot;WordpressInstances,omitempty&quot; validate:&quot;optional,association&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">WordpressInstance</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">tpapi_v0</span><span class="p">.</span><span class="nx">Common</span><span class="w">         </span><span class="s">`mapstructure:&quot;,squash&quot; swaggerignore:&quot;true&quot;`</span>
<span class="w">    </span><span class="nx">tpapi_v0</span><span class="p">.</span><span class="nx">Reconciliation</span><span class="w"> </span><span class="s">`mapstructure:&quot;,squash&quot;`</span>
<span class="w">    </span><span class="nx">tpapi_v0</span><span class="p">.</span><span class="nx">Instance</span><span class="w">       </span><span class="s">`mapstructure:&quot;,squash&quot;`</span>
<span class="w">    </span><span class="nx">WordpressDefinitionID</span><span class="w">   </span><span class="o">*</span><span class="kt">uint</span><span class="w"> </span><span class="s">`gorm:&quot;not null&quot; json:&quot;WordpressDefinitionID,omitempty&quot; query:&quot;wordpressdefinitionid&quot; validate:&quot;required&quot;`</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>This constitutes your Threeport module's data model. Add fields to these
objects for config information that will need to be persisted.</p>
<p>Add the following fields so that the file looks as follows when you are
finished.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// originally generated by &#39;threeport-sdk create&#39; for API object</span>
<span class="c1">// scaffolding but will not be re-generated - intended for modification</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">v0</span>

<span class="kn">import</span><span class="w"> </span><span class="nx">tpapi_v0</span><span class="w"> </span><span class="s">&quot;github.com/threeport/threeport/pkg/api/v0&quot;</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">WordpressDefinition</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">tpapi_v0</span><span class="p">.</span><span class="nx">Common</span><span class="w">         </span><span class="s">`mapstructure:&quot;,squash&quot; swaggerignore:&quot;true&quot;`</span>
<span class="w">    </span><span class="nx">tpapi_v0</span><span class="p">.</span><span class="nx">Reconciliation</span><span class="w"> </span><span class="s">`mapstructure:&quot;,squash&quot;`</span>
<span class="w">    </span><span class="nx">tpapi_v0</span><span class="p">.</span><span class="nx">Definition</span><span class="w">     </span><span class="s">`mapstructure:&quot;,squash&quot;`</span>

<span class="w">    </span><span class="c1">// The environment type used to determine config settings for a wordpress</span>
<span class="w">    </span><span class="c1">// definition.</span>
<span class="w">    </span><span class="nx">Environment</span><span class="w"> </span><span class="o">*</span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;Environment,omitempty&quot; query:&quot;environment&quot; gorm:&quot;default:dev&quot; validate:&quot;optional&quot;`</span>

<span class="w">    </span><span class="c1">// The number of pod replicas to deploy for the WordPress app</span>
<span class="w">    </span><span class="nx">Replicas</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span><span class="w"> </span><span class="s">`json:&quot;Replicas,omitempty&quot; query:&quot;replicas&quot; validate:&quot;optional&quot;`</span>

<span class="w">    </span><span class="c1">// If true, a cloud provider&#39;s managed database will be used for the</span>
<span class="w">    </span><span class="c1">// WordPress DB.  If false, a containerized database will be deployed to</span>
<span class="w">    </span><span class="c1">// Kubernetes.</span>
<span class="w">    </span><span class="nx">ManagedDatabase</span><span class="w"> </span><span class="o">*</span><span class="kt">bool</span><span class="w"> </span><span class="s">`json:&quot;ManagedDatabase,omitempty&quot; query:&quot;manageddatabase&quot; gorm:&quot;default:false&quot; validate:&quot;optional&quot;`</span>

<span class="w">    </span><span class="nx">WordpressInstances</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">WordpressInstance</span><span class="w"> </span><span class="s">`json:&quot;WordpressInstances,omitempty&quot; validate:&quot;optional,association&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">WordpressInstance</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">tpapi_v0</span><span class="p">.</span><span class="nx">Common</span><span class="w">         </span><span class="s">`mapstructure:&quot;,squash&quot; swaggerignore:&quot;true&quot;`</span>
<span class="w">    </span><span class="nx">tpapi_v0</span><span class="p">.</span><span class="nx">Reconciliation</span><span class="w"> </span><span class="s">`mapstructure:&quot;,squash&quot;`</span>
<span class="w">    </span><span class="nx">tpapi_v0</span><span class="p">.</span><span class="nx">Instance</span><span class="w">       </span><span class="s">`mapstructure:&quot;,squash&quot;`</span>

<span class="w">    </span><span class="c1">// When using a DomainName, the subdomain to use to reach the WordPress</span>
<span class="w">    </span><span class="c1">// instance.</span>
<span class="w">    </span><span class="nx">SubDomain</span><span class="w"> </span><span class="o">*</span><span class="kt">string</span><span class="w"> </span><span class="s">`jaon:&quot;SubDomain,omitempty&quot; query:&quot;subdomain&quot; validate:&quot;optional&quot;`</span>

<span class="w">    </span><span class="nx">WordpressDefinitionID</span><span class="w"> </span><span class="o">*</span><span class="kt">uint</span><span class="w"> </span><span class="s">`gorm:&quot;not null&quot; json:&quot;WordpressDefinitionID,omitempty&quot; query:&quot;wordpressdefinitionid&quot; validate:&quot;required&quot;`</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="generate-source-code">Generate Source Code<a class="headerlink" href="#generate-source-code" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>threeport-sdk<span class="w"> </span>gen<span class="w"> </span>--config<span class="w"> </span>sdk-config.yaml
</code></pre></div></td></tr></table></div>
<p>This will generate all the source code boilerplate and scaffolding needed for the
project.</p>
<h2 id="add-controller-business-logic">Add Controller Business Logic<a class="headerlink" href="#add-controller-business-logic" title="Permanent link">&para;</a></h2>
<p>The next step is to add the business logic for managing wordpress instances to
the scaffolding for the wordpress controller.</p>
<h3 id="updates-to-internalwordpressv0_wordpress_definitiongo">Updates to <code>internal/wordpress/v0_wordpress_definition.go</code><a class="headerlink" href="#updates-to-internalwordpressv0_wordpress_definitiongo" title="Permanent link">&para;</a></h3>
<p>The first file we will modify managed <code>WordpressDefinition</code> objects.  The file
is located at <code>internal/wordpress/v0_wordpress_definition.go</code>.  If you open that
file, you'll see functions to create, update and delete those objects.  These
functions run when the corresponding actions are executed through the Threeport
API.</p>
<p>Now, let's update that file to insert some business logic.  In the following
code snippet, is a new constant and the contents for the <code>v0WordpressDefinitionCreated</code>
function.  Update your code to reflect these changes.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">wordpressDbConnSecretName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;wordpress-db-conn&quot;</span>

<span class="c1">// v0WordpressDefinitionCreated performs reconciliation when a v0 WordpressDefinition</span>
<span class="c1">// has been created.</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">v0WordpressDefinitionCreated</span><span class="p">(</span>
<span class="w">    </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">controller</span><span class="p">.</span><span class="nx">Reconciler</span><span class="p">,</span>
<span class="w">    </span><span class="nx">wordpressDefinition</span><span class="w"> </span><span class="o">*</span><span class="nx">v0</span><span class="p">.</span><span class="nx">WordpressDefinition</span><span class="p">,</span>
<span class="w">    </span><span class="nx">log</span><span class="w"> </span><span class="o">*</span><span class="nx">logr</span><span class="p">.</span><span class="nx">Logger</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// set wordpress deployment replicas</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">wordpressReplicas</span><span class="w"> </span><span class="kt">int</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">Replicas</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">wordpressReplicas</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">*</span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">Replicas</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">wordpressReplicas</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">setWordpressReplicasByEnv</span><span class="p">(</span><span class="o">*</span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">Environment</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// set wordpress DB storage volume size</span>
<span class="w">    </span><span class="nx">wordpressDbStorageGb</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">setWordpressDbStorage</span><span class="p">(</span><span class="o">*</span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">Environment</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// generate YAML manifest for wordpress app</span>
<span class="w">    </span><span class="nx">yamlDoc</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">wordpressYaml</span><span class="p">(</span>
<span class="w">        </span><span class="o">*</span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">        </span><span class="nx">wordpressReplicas</span><span class="p">,</span>
<span class="w">        </span><span class="o">*</span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">Environment</span><span class="p">,</span>
<span class="w">        </span><span class="o">*</span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">ManagedDatabase</span><span class="p">,</span>
<span class="w">        </span><span class="nx">wordpressDbStorageGb</span><span class="p">,</span>
<span class="w">        </span><span class="nx">wordpressDbConnSecretName</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to generate wordpress YAML manifest: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// create wordpress workload definition if it doesn&#39;t already exist</span>
<span class="w">    </span><span class="nx">nameQuery</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;name=%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<span class="w">    </span><span class="nx">existingWorkloadDefinitions</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">GetWorkloadDefinitionsByQueryString</span><span class="p">(</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">        </span><span class="nx">nameQuery</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to check for workload definitions with name %s: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">createdWorkloadDefinition</span><span class="w"> </span><span class="o">*</span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">WorkloadDefinition</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="o">*</span><span class="nx">existingWorkloadDefinitions</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">workloadDefinition</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">WorkloadDefinition</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Definition</span><span class="p">:</span><span class="w"> </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">Definition</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nx">YAMLDocument</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">yamlDoc</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">createdWorkloadDef</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">CreateWorkloadDefinition</span><span class="p">(</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">            </span><span class="o">&amp;</span><span class="nx">workloadDefinition</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to create Threeport workload definition: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">createdWorkloadDefinition</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">createdWorkloadDef</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">createdWorkloadDefinition</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="p">(</span><span class="o">*</span><span class="nx">existingWorkloadDefinitions</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// establish attachment between wordpress definition and workload definition</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">EnsureAttachedObjectReferenceExists</span><span class="p">(</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">        </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">ObjectTypeWorkloadDefinition</span><span class="p">,</span>
<span class="w">        </span><span class="nx">createdWorkloadDefinition</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">        </span><span class="nx">v0</span><span class="p">.</span><span class="nx">ObjectTypeWordpressDefinition</span><span class="p">,</span>
<span class="w">        </span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">    </span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to attach wordpress definition to workload definition: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// create relational database definition if requested</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">*</span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">ManagedDatabase</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">storageGb</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">setWordpressDbStorage</span><span class="p">(</span><span class="o">*</span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">Environment</span><span class="p">)</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">backupDays</span><span class="w"> </span><span class="kt">int</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">machineSize</span><span class="w"> </span><span class="kt">string</span>
<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="o">*</span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">Environment</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;prod&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="nx">backupDays</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">30</span>
<span class="w">            </span><span class="nx">machineSize</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Large&quot;</span>
<span class="w">        </span><span class="k">default</span><span class="p">:</span>
<span class="w">            </span><span class="nx">backupDays</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">            </span><span class="nx">machineSize</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;XSmall&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// get AWS account ID</span>
<span class="w">        </span><span class="nx">awsAccountId</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">GetObjectIdByAttachedObject</span><span class="p">(</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">            </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">ObjectTypeAwsAccount</span><span class="p">,</span>
<span class="w">            </span><span class="nx">v0</span><span class="p">.</span><span class="nx">ObjectTypeWordpressDefinition</span><span class="p">,</span>
<span class="w">            </span><span class="o">*</span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to get attached AWS account ID: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// construct relational database definition</span>
<span class="w">        </span><span class="nx">awsRdsDefinition</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">AwsRelationalDatabaseDefinition</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Definition</span><span class="p">:</span><span class="w"> </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">Definition</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nx">Engine</span><span class="p">:</span><span class="w">             </span><span class="nx">util</span><span class="p">.</span><span class="nx">Ptr</span><span class="p">(</span><span class="s">&quot;mariadb&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="nx">EngineVersion</span><span class="p">:</span><span class="w">      </span><span class="nx">util</span><span class="p">.</span><span class="nx">Ptr</span><span class="p">(</span><span class="s">&quot;10.11&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="nx">DatabaseName</span><span class="p">:</span><span class="w">       </span><span class="nx">util</span><span class="p">.</span><span class="nx">Ptr</span><span class="p">(</span><span class="s">&quot;wordpress&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="nx">DatabasePort</span><span class="p">:</span><span class="w">       </span><span class="nx">util</span><span class="p">.</span><span class="nx">Ptr</span><span class="p">(</span><span class="mi">3306</span><span class="p">),</span>
<span class="w">            </span><span class="nx">BackupDays</span><span class="p">:</span><span class="w">         </span><span class="nx">util</span><span class="p">.</span><span class="nx">Ptr</span><span class="p">(</span><span class="nx">backupDays</span><span class="p">),</span>
<span class="w">            </span><span class="nx">StorageGb</span><span class="p">:</span><span class="w">          </span><span class="nx">util</span><span class="p">.</span><span class="nx">Ptr</span><span class="p">(</span><span class="nx">storageGb</span><span class="p">),</span>
<span class="w">            </span><span class="nx">MachineSize</span><span class="p">:</span><span class="w">        </span><span class="nx">util</span><span class="p">.</span><span class="nx">Ptr</span><span class="p">(</span><span class="nx">machineSize</span><span class="p">),</span>
<span class="w">            </span><span class="nx">WorkloadSecretName</span><span class="p">:</span><span class="w"> </span><span class="nx">util</span><span class="p">.</span><span class="nx">Ptr</span><span class="p">(</span><span class="nx">wordpressDbConnSecretName</span><span class="p">),</span>
<span class="w">            </span><span class="nx">AwsAccountID</span><span class="p">:</span><span class="w">       </span><span class="nx">awsAccountId</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// create releational database definition</span>
<span class="w">        </span><span class="nx">createdAwsRdsDefinition</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">CreateAwsRelationalDatabaseDefinition</span><span class="p">(</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">            </span><span class="o">&amp;</span><span class="nx">awsRdsDefinition</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to create AWS relational database definition: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// establish attachment between wordpress definition and relational</span>
<span class="w">        </span><span class="c1">// database definition</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">EnsureAttachedObjectReferenceExists</span><span class="p">(</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">            </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">ObjectTypeAwsRelationalDatabaseDefinition</span><span class="p">,</span>
<span class="w">            </span><span class="nx">createdAwsRdsDefinition</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">            </span><span class="nx">v0</span><span class="p">.</span><span class="nx">ObjectTypeWordpressDefinition</span><span class="p">,</span>
<span class="w">            </span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">        </span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to attach wordpress definition to AWS relational database definition: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Now, let's update the <code>v0WordpressDefinitionDeleted</code> function with the code shown
below.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// v0WordpressDefinitionDeleted performs reconciliation when a v0 WordpressDefinition</span>
<span class="c1">// has been deleted.</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">v0WordpressDefinitionDeleted</span><span class="p">(</span>
<span class="w">    </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">controller</span><span class="p">.</span><span class="nx">Reconciler</span><span class="p">,</span>
<span class="w">    </span><span class="nx">wordpressDefinition</span><span class="w"> </span><span class="o">*</span><span class="nx">v0</span><span class="p">.</span><span class="nx">WordpressDefinition</span><span class="p">,</span>
<span class="w">    </span><span class="nx">log</span><span class="w"> </span><span class="o">*</span><span class="nx">logr</span><span class="p">.</span><span class="nx">Logger</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// get attached workload definition</span>
<span class="w">    </span><span class="nx">workloadDefinitionId</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">GetObjectIdByAttachedObject</span><span class="p">(</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">        </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">ObjectTypeWorkloadDefinition</span><span class="p">,</span>
<span class="w">        </span><span class="nx">v0</span><span class="p">.</span><span class="nx">ObjectTypeWordpressDefinition</span><span class="p">,</span>
<span class="w">        </span><span class="o">*</span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to find attached workload definition: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// delete workload definition</span>
<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">DeleteWorkloadDefinition</span><span class="p">(</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">        </span><span class="o">*</span><span class="nx">workloadDefinitionId</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to delete workload definition: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// remove workload definition attachment</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">EnsureAttachedObjectReferenceRemoved</span><span class="p">(</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">        </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">ObjectTypeWorkloadDefinition</span><span class="p">,</span>
<span class="w">        </span><span class="nx">workloadDefinitionId</span><span class="p">,</span>
<span class="w">        </span><span class="nx">v0</span><span class="p">.</span><span class="nx">ObjectTypeWordpressDefinition</span><span class="p">,</span>
<span class="w">        </span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">    </span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to remove attachment to deleted workload definition: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// delete relational database definition if it exists</span>
<span class="w">    </span><span class="nx">awsRdsDefinitionIds</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">GetObjectIdsByAttachedObject</span><span class="p">(</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">        </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">ObjectTypeAwsRelationalDatabaseDefinition</span><span class="p">,</span>
<span class="w">        </span><span class="nx">v0</span><span class="p">.</span><span class="nx">ObjectTypeWordpressDefinition</span><span class="p">,</span>
<span class="w">        </span><span class="o">*</span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to get attached AWS relational database definition IDs: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">awsRdsDefinitionId</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">awsRdsDefinitionIds</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">DeleteGatewayInstance</span><span class="p">(</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">            </span><span class="o">*</span><span class="nx">awsRdsDefinitionId</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to delete AWS relational database definition with ID %d: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">awsRdsDefinitionId</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">EnsureAttachedObjectReferenceRemoved</span><span class="p">(</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">            </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">ObjectTypeGatewayDefinition</span><span class="p">,</span>
<span class="w">            </span><span class="nx">awsRdsDefinitionId</span><span class="p">,</span>
<span class="w">            </span><span class="nx">v0</span><span class="p">.</span><span class="nx">ObjectTypeWordpressDefinition</span><span class="p">,</span>
<span class="w">            </span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">        </span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to remove wordpress definition attachment to deleted AWS relational database definition: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Lastly, add these two functions at the end of that file.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// setWordpressReplicasByEnv sets default replicas for the Wordpress deployment</span>
<span class="c1">// based on the environment value.</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">setWordpressReplicasByEnv</span><span class="p">(</span><span class="nx">env</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">env</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;prod&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">5</span>
<span class="w">    </span><span class="k">default</span><span class="p">:</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// setWordpressDbStorage sets the database storage volume size.</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">setWordpressDbStorage</span><span class="p">(</span><span class="nx">env</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">env</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;prod&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">100</span>
<span class="w">    </span><span class="k">default</span><span class="p">:</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">20</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Ensure the following imports are included in this file.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>

<span class="w">    </span><span class="nx">logr</span><span class="w"> </span><span class="s">&quot;github.com/go-logr/logr&quot;</span>
<span class="w">    </span><span class="nx">tpapi</span><span class="w"> </span><span class="s">&quot;github.com/threeport/threeport/pkg/api/v0&quot;</span>
<span class="w">    </span><span class="nx">tpclient</span><span class="w"> </span><span class="s">&quot;github.com/threeport/threeport/pkg/client/v0&quot;</span>
<span class="w">    </span><span class="nx">controller</span><span class="w"> </span><span class="s">&quot;github.com/threeport/threeport/pkg/controller/v0&quot;</span>
<span class="w">    </span><span class="nx">util</span><span class="w"> </span><span class="s">&quot;github.com/threeport/threeport/pkg/util/v0&quot;</span>

<span class="w">    </span><span class="nx">v0</span><span class="w"> </span><span class="s">&quot;wordpress-threeport-module/pkg/api/v0&quot;</span>
<span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="updates-to-internalwordpressv0_wordpress_instancego">Updates to <code>internal/wordpress/v0_wordpress_instance.go</code><a class="headerlink" href="#updates-to-internalwordpressv0_wordpress_instancego" title="Permanent link">&para;</a></h3>
<p>Lastly, let's add the operations to mange <code>WordpressInstance</code> objects.  The
scaffolding for this is in <code>internal/wordpress/v0_wordpress_instance.go</code>.  If
you open that file, you'll see empty functions to create, update and delete
these objects.  Again, when actions are executed through the Threeport API,
these functions will be called to reconcile the desired operations.</p>
<p>Update the <code>v0WordpressInstanceCreated</code> function as shown below.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// v0WordpressInstanceCreated performs reconciliation when a v0 WordpressInstance</span>
<span class="c1">// has been created.</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">v0WordpressInstanceCreated</span><span class="p">(</span>
<span class="w">    </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">controller</span><span class="p">.</span><span class="nx">Reconciler</span><span class="p">,</span>
<span class="w">    </span><span class="nx">wordpressInstance</span><span class="w"> </span><span class="o">*</span><span class="nx">v0</span><span class="p">.</span><span class="nx">WordpressInstance</span><span class="p">,</span>
<span class="w">    </span><span class="nx">log</span><span class="w"> </span><span class="o">*</span><span class="nx">logr</span><span class="p">.</span><span class="nx">Logger</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// get attached Kubernetes runtime instance ID</span>
<span class="w">    </span><span class="nx">kubernetesRuntimeInstanceId</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">GetObjectIdByAttachedObject</span><span class="p">(</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">        </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">ObjectTypeKubernetesRuntimeInstance</span><span class="p">,</span>
<span class="w">        </span><span class="nx">v0</span><span class="p">.</span><span class="nx">ObjectTypeWordpressInstance</span><span class="p">,</span>
<span class="w">        </span><span class="o">*</span><span class="nx">wordpressInstance</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to get Kubernetes runtime instance by attachment: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// get workload definition attached to wordpress definition</span>
<span class="w">    </span><span class="nx">workloadDefinitionId</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">GetObjectIdByAttachedObject</span><span class="p">(</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">        </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">ObjectTypeWorkloadDefinition</span><span class="p">,</span>
<span class="w">        </span><span class="nx">v0</span><span class="p">.</span><span class="nx">ObjectTypeWordpressDefinition</span><span class="p">,</span>
<span class="w">        </span><span class="o">*</span><span class="nx">wordpressInstance</span><span class="p">.</span><span class="nx">WordpressDefinitionID</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to get workload definition by attachment: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// create workload instance if it doesn&#39;t already exist</span>
<span class="w">    </span><span class="nx">nameQuery</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;name=%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">wordpressInstance</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<span class="w">    </span><span class="nx">existingWorkloadInstances</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">GetWorkloadInstancesByQueryString</span><span class="p">(</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">        </span><span class="nx">nameQuery</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to check for workload instance with name %s: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">wordpressInstance</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">createdWorkloadInstance</span><span class="w"> </span><span class="o">*</span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">WorkloadInstance</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="o">*</span><span class="nx">existingWorkloadInstances</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">workloadInstance</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">WorkloadInstance</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Instance</span><span class="p">:</span><span class="w"> </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">Instance</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="nx">wordpressInstance</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nx">KubernetesRuntimeInstanceID</span><span class="p">:</span><span class="w"> </span><span class="nx">kubernetesRuntimeInstanceId</span><span class="p">,</span>
<span class="w">            </span><span class="nx">WorkloadDefinitionID</span><span class="p">:</span><span class="w">        </span><span class="nx">workloadDefinitionId</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">createdWorkloadInst</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">CreateWorkloadInstance</span><span class="p">(</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">            </span><span class="o">&amp;</span><span class="nx">workloadInstance</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to create workload instance: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">createdWorkloadInstance</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">createdWorkloadInst</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// establish attachment between wordpress instance and workload instance</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">EnsureAttachedObjectReferenceExists</span><span class="p">(</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">        </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">ObjectTypeWorkloadInstance</span><span class="p">,</span>
<span class="w">        </span><span class="nx">createdWorkloadInstance</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">        </span><span class="nx">v0</span><span class="p">.</span><span class="nx">ObjectTypeWordpressInstance</span><span class="p">,</span>
<span class="w">        </span><span class="nx">wordpressInstance</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">    </span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to attach wordpress instance to workload instance: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// get wordpress definition</span>
<span class="w">    </span><span class="nx">wordpressDefinition</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">GetWordpressDefinitionByID</span><span class="p">(</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">        </span><span class="o">*</span><span class="nx">wordpressInstance</span><span class="p">.</span><span class="nx">WordpressDefinitionID</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to get wordpress definition: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// get infra provider for kubernetes runtime - needed to determine storage</span>
<span class="w">    </span><span class="c1">// class for wordpress PVC</span>
<span class="w">    </span><span class="nx">infraProvider</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">GetInfraProviderByKubernetesRuntimeInstanceID</span><span class="p">(</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">        </span><span class="nx">kubernetesRuntimeInstanceId</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to determine infra provider for Kubernetes runtime: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// get the manifest for the PVC</span>
<span class="w">    </span><span class="nx">pvcManifest</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">getPvcManifest</span><span class="p">(</span>
<span class="w">        </span><span class="o">*</span><span class="nx">infraProvider</span><span class="p">,</span>
<span class="w">        </span><span class="o">*</span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">        </span><span class="o">*</span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">Environment</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to get Kubernetes manifest for persistent volume claim: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// create the workload resource instance for the PVC</span>
<span class="w">    </span><span class="nx">pvcWri</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">WorkloadResourceInstance</span><span class="p">{</span>
<span class="w">        </span><span class="nx">JSONDefinition</span><span class="p">:</span><span class="w">     </span><span class="nx">pvcManifest</span><span class="p">,</span>
<span class="w">        </span><span class="nx">WorkloadInstanceID</span><span class="p">:</span><span class="w"> </span><span class="nx">createdWorkloadInstance</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">CreateWorkloadResourceInstance</span><span class="p">(</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">        </span><span class="o">&amp;</span><span class="nx">pvcWri</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to create workload resource instance for persistent volume claim: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// trigger reconciliation to create the PVC</span>
<span class="w">    </span><span class="nx">unreconciledWorkloadInstance</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">WorkloadInstance</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Common</span><span class="p">:</span><span class="w"> </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">Common</span><span class="p">{</span>
<span class="w">            </span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="nx">createdWorkloadInstance</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">Reconciliation</span><span class="p">:</span><span class="w"> </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">Reconciliation</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Reconciled</span><span class="p">:</span><span class="w"> </span><span class="nx">util</span><span class="p">.</span><span class="nx">Ptr</span><span class="p">(</span><span class="kc">false</span><span class="p">),</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">UpdateWorkloadInstance</span><span class="p">(</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">        </span><span class="o">&amp;</span><span class="nx">unreconciledWorkloadInstance</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to update workload instance as unreconciled: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// create relational database instance if requested</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">*</span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">ManagedDatabase</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// get relational database definition ID</span>
<span class="w">        </span><span class="nx">awsRdsDefinitionId</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">GetObjectIdByAttachedObject</span><span class="p">(</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">            </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">ObjectTypeAwsRelationalDatabaseDefinition</span><span class="p">,</span>
<span class="w">            </span><span class="nx">v0</span><span class="p">.</span><span class="nx">ObjectTypeWordpressDefinition</span><span class="p">,</span>
<span class="w">            </span><span class="o">*</span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to get AWS relational database definition ID by attachment: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// construct relational database instance</span>
<span class="w">        </span><span class="nx">awsRdsInstance</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">AwsRelationalDatabaseInstance</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Instance</span><span class="p">:</span><span class="w"> </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">Instance</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="nx">wordpressInstance</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nx">AwsRelationalDatabaseDefinitionID</span><span class="p">:</span><span class="w"> </span><span class="nx">awsRdsDefinitionId</span><span class="p">,</span>
<span class="w">            </span><span class="nx">WorkloadInstanceID</span><span class="p">:</span><span class="w">                </span><span class="nx">createdWorkloadInstance</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// create relational database instance</span>
<span class="w">        </span><span class="nx">createdRdsInstance</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">CreateAwsRelationalDatabaseInstance</span><span class="p">(</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">            </span><span class="o">&amp;</span><span class="nx">awsRdsInstance</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to create AWS relational database instance: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// establish attachment between wordpress instance and relational</span>
<span class="w">        </span><span class="c1">// database instance</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">EnsureAttachedObjectReferenceExists</span><span class="p">(</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">            </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">ObjectTypeAwsRelationalDatabaseInstance</span><span class="p">,</span>
<span class="w">            </span><span class="nx">createdRdsInstance</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">            </span><span class="nx">v0</span><span class="p">.</span><span class="nx">ObjectTypeWordpressInstance</span><span class="p">,</span>
<span class="w">            </span><span class="nx">wordpressInstance</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">        </span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to attach wordpress instance to AWS relational database instance: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// create gateway and subdomain DNS record if requested</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">wordpressInstance</span><span class="p">.</span><span class="nx">SubDomain</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">*</span><span class="nx">wordpressInstance</span><span class="p">.</span><span class="nx">SubDomain</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// get attached domain name definition ID</span>
<span class="w">        </span><span class="nx">domainNameDefinitionId</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">GetObjectIdByAttachedObject</span><span class="p">(</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">            </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">ObjectTypeDomainNameDefinition</span><span class="p">,</span>
<span class="w">            </span><span class="nx">v0</span><span class="p">.</span><span class="nx">ObjectTypeWordpressDefinition</span><span class="p">,</span>
<span class="w">            </span><span class="o">*</span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to get attached domain name definition: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// contruct gateway definition object</span>
<span class="w">        </span><span class="nx">gatewayDefinition</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">GatewayDefinition</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Definition</span><span class="p">:</span><span class="w"> </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">Definition</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="nx">util</span><span class="p">.</span><span class="nx">Ptr</span><span class="p">(</span><span class="s">&quot;web-service-gateway&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nx">HttpPorts</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">GatewayHttpPort</span><span class="p">{</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">Port</span><span class="p">:</span><span class="w">          </span><span class="nx">util</span><span class="p">.</span><span class="nx">Ptr</span><span class="p">(</span><span class="mi">80</span><span class="p">),</span>
<span class="w">                    </span><span class="nx">Path</span><span class="p">:</span><span class="w">          </span><span class="nx">util</span><span class="p">.</span><span class="nx">Ptr</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">),</span>
<span class="w">                    </span><span class="nx">HTTPSRedirect</span><span class="p">:</span><span class="w"> </span><span class="nx">util</span><span class="p">.</span><span class="nx">Ptr</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span>
<span class="w">                </span><span class="p">},</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">Port</span><span class="p">:</span><span class="w">       </span><span class="nx">util</span><span class="p">.</span><span class="nx">Ptr</span><span class="p">(</span><span class="mi">443</span><span class="p">),</span>
<span class="w">                    </span><span class="nx">Path</span><span class="p">:</span><span class="w">       </span><span class="nx">util</span><span class="p">.</span><span class="nx">Ptr</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">),</span>
<span class="w">                    </span><span class="nx">TLSEnabled</span><span class="p">:</span><span class="w"> </span><span class="nx">util</span><span class="p">.</span><span class="nx">Ptr</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nx">DomainNameDefinitionID</span><span class="p">:</span><span class="w"> </span><span class="nx">domainNameDefinitionId</span><span class="p">,</span>
<span class="w">            </span><span class="nx">SubDomain</span><span class="p">:</span><span class="w">              </span><span class="nx">wordpressInstance</span><span class="p">.</span><span class="nx">SubDomain</span><span class="p">,</span>
<span class="w">            </span><span class="nx">ServiceName</span><span class="p">:</span><span class="w">            </span><span class="nx">util</span><span class="p">.</span><span class="nx">Ptr</span><span class="p">(</span><span class="nx">getWordpressServiceName</span><span class="p">(</span><span class="o">*</span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">Name</span><span class="p">)),</span>
<span class="w">            </span><span class="nx">WorkloadDefinitionID</span><span class="p">:</span><span class="w">   </span><span class="nx">workloadDefinitionId</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// create gateway definition</span>
<span class="w">        </span><span class="nx">createdGatewayDefinition</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">CreateGatewayDefinition</span><span class="p">(</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">            </span><span class="o">&amp;</span><span class="nx">gatewayDefinition</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to create gateway definition: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// construct gateway instance</span>
<span class="w">        </span><span class="nx">gatewayInstance</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">GatewayInstance</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Instance</span><span class="p">:</span><span class="w"> </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">Instance</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="nx">util</span><span class="p">.</span><span class="nx">Ptr</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-gateway&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">wordpressInstance</span><span class="p">.</span><span class="nx">Name</span><span class="p">)),</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nx">KubernetesRuntimeInstanceID</span><span class="p">:</span><span class="w"> </span><span class="nx">kubernetesRuntimeInstanceId</span><span class="p">,</span>
<span class="w">            </span><span class="nx">GatewayDefinitionID</span><span class="p">:</span><span class="w">         </span><span class="nx">createdGatewayDefinition</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">            </span><span class="nx">WorkloadInstanceID</span><span class="p">:</span><span class="w">          </span><span class="nx">createdWorkloadInstance</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// created gateway instance</span>
<span class="w">        </span><span class="nx">createdGatewayInstance</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">CreateGatewayInstance</span><span class="p">(</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">            </span><span class="o">&amp;</span><span class="nx">gatewayInstance</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to create gateway instance: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// create attachment between gateway instance and wordpress instance</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">EnsureAttachedObjectReferenceExists</span><span class="p">(</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">            </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">ObjectTypeGatewayInstance</span><span class="p">,</span>
<span class="w">            </span><span class="nx">createdGatewayInstance</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">            </span><span class="nx">v0</span><span class="p">.</span><span class="nx">ObjectTypeWordpressInstance</span><span class="p">,</span>
<span class="w">            </span><span class="nx">wordpressInstance</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">        </span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to create attachment between wordpress instance and gateway instance: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// construct domain name instance</span>
<span class="w">        </span><span class="nx">domainNameInstance</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">DomainNameInstance</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Instance</span><span class="p">:</span><span class="w"> </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">Instance</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="nx">util</span><span class="p">.</span><span class="nx">Ptr</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-domain-name&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">wordpressInstance</span><span class="p">.</span><span class="nx">Name</span><span class="p">)),</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nx">DomainNameDefinitionID</span><span class="p">:</span><span class="w">      </span><span class="nx">domainNameDefinitionId</span><span class="p">,</span>
<span class="w">            </span><span class="nx">WorkloadInstanceID</span><span class="p">:</span><span class="w">          </span><span class="nx">createdWorkloadInstance</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">            </span><span class="nx">KubernetesRuntimeInstanceID</span><span class="p">:</span><span class="w"> </span><span class="nx">kubernetesRuntimeInstanceId</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// create domain name instance</span>
<span class="w">        </span><span class="nx">createdDomainNameInstance</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">CreateDomainNameInstance</span><span class="p">(</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">            </span><span class="o">&amp;</span><span class="nx">domainNameInstance</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to create domain name instance: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// create attachment between domain name instance and wordpress instance</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">EnsureAttachedObjectReferenceExists</span><span class="p">(</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">            </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">ObjectTypeDomainNameInstance</span><span class="p">,</span>
<span class="w">            </span><span class="nx">createdDomainNameInstance</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">            </span><span class="nx">v0</span><span class="p">.</span><span class="nx">ObjectTypeWordpressInstance</span><span class="p">,</span>
<span class="w">            </span><span class="nx">wordpressInstance</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">        </span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to create attachment between wordpress instance and domain name instance: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Now, update the <code>v0WordpressInstanceDeleted</code> function with the code below.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// v0WordpressInstanceDeleted performs reconciliation when a v0 WordpressInstance</span>
<span class="c1">// has been deleted.</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">v0WordpressInstanceDeleted</span><span class="p">(</span>
<span class="w">    </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">controller</span><span class="p">.</span><span class="nx">Reconciler</span><span class="p">,</span>
<span class="w">    </span><span class="nx">wordpressInstance</span><span class="w"> </span><span class="o">*</span><span class="nx">v0</span><span class="p">.</span><span class="nx">WordpressInstance</span><span class="p">,</span>
<span class="w">    </span><span class="nx">log</span><span class="w"> </span><span class="o">*</span><span class="nx">logr</span><span class="p">.</span><span class="nx">Logger</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// get attached workload instance</span>
<span class="w">    </span><span class="nx">workloadInstanceId</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">GetObjectIdByAttachedObject</span><span class="p">(</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">        </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">ObjectTypeWorkloadInstance</span><span class="p">,</span>
<span class="w">        </span><span class="nx">v0</span><span class="p">.</span><span class="nx">ObjectTypeWordpressInstance</span><span class="p">,</span>
<span class="w">        </span><span class="o">*</span><span class="nx">wordpressInstance</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to find attached workload instance: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// delete workload instance</span>
<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">DeleteWorkloadInstance</span><span class="p">(</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">        </span><span class="o">*</span><span class="nx">workloadInstanceId</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to delete workload instance: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// remove workload instance attachment</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">EnsureAttachedObjectReferenceRemoved</span><span class="p">(</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">        </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">ObjectTypeWorkloadInstance</span><span class="p">,</span>
<span class="w">        </span><span class="nx">workloadInstanceId</span><span class="p">,</span>
<span class="w">        </span><span class="nx">v0</span><span class="p">.</span><span class="nx">ObjectTypeWordpressInstance</span><span class="p">,</span>
<span class="w">        </span><span class="nx">wordpressInstance</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">    </span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to remove attachment to deleted workload instance: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// delete relational database instance if it exists</span>
<span class="w">    </span><span class="nx">awsRdsInstanceIds</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">GetObjectIdsByAttachedObject</span><span class="p">(</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">        </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">ObjectTypeAwsRelationalDatabaseInstance</span><span class="p">,</span>
<span class="w">        </span><span class="nx">v0</span><span class="p">.</span><span class="nx">ObjectTypeWordpressInstance</span><span class="p">,</span>
<span class="w">        </span><span class="o">*</span><span class="nx">wordpressInstance</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to get attached relational database IDs: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">rdsInstanceId</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">awsRdsInstanceIds</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">DeleteAwsRelationalDatabaseInstance</span><span class="p">(</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">            </span><span class="o">*</span><span class="nx">rdsInstanceId</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to delete AWS RDS instance with id %d: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">rdsInstanceId</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">EnsureAttachedObjectReferenceRemoved</span><span class="p">(</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIClient</span><span class="p">,</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">APIServer</span><span class="p">,</span>
<span class="w">            </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">ObjectTypeAwsRelationalDatabaseInstance</span><span class="p">,</span>
<span class="w">            </span><span class="nx">rdsInstanceId</span><span class="p">,</span>
<span class="w">            </span><span class="nx">v0</span><span class="p">.</span><span class="nx">ObjectTypeWordpressInstance</span><span class="p">,</span>
<span class="w">            </span><span class="nx">wordpressInstance</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">        </span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to remove attachment to deleted AWS relational database instance: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Ensure the following imports are included in this file.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>

<span class="w">    </span><span class="nx">logr</span><span class="w"> </span><span class="s">&quot;github.com/go-logr/logr&quot;</span>
<span class="w">    </span><span class="nx">tpapi</span><span class="w"> </span><span class="s">&quot;github.com/threeport/threeport/pkg/api/v0&quot;</span>
<span class="w">    </span><span class="nx">tpclient</span><span class="w"> </span><span class="s">&quot;github.com/threeport/threeport/pkg/client/v0&quot;</span>
<span class="w">    </span><span class="nx">controller</span><span class="w"> </span><span class="s">&quot;github.com/threeport/threeport/pkg/controller/v0&quot;</span>
<span class="w">    </span><span class="nx">util</span><span class="w"> </span><span class="s">&quot;github.com/threeport/threeport/pkg/util/v0&quot;</span>

<span class="w">    </span><span class="nx">v0</span><span class="w"> </span><span class="s">&quot;wordpress-threeport-module/pkg/api/v0&quot;</span>
<span class="w">    </span><span class="nx">client</span><span class="w"> </span><span class="s">&quot;wordpress-threeport-module/pkg/client/v0&quot;</span>
<span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="add-internalwordpresswordpress_manifestgo">Add <code>internal/wordpress/wordpress_manifest.go</code><a class="headerlink" href="#add-internalwordpresswordpress_manifestgo" title="Permanent link">&para;</a></h3>
<p>The updates we've made so far reference some functions that don't exist yet.
These functions define the Kubernetes configurations for the WordPress workloads
and set the variables needed for different install options.</p>
<p>Add a new file <code>internal/wordpress/wordpress_manifest.go</code> with the following
contents.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">   1</span>
<span class="normal">   2</span>
<span class="normal">   3</span>
<span class="normal">   4</span>
<span class="normal">   5</span>
<span class="normal">   6</span>
<span class="normal">   7</span>
<span class="normal">   8</span>
<span class="normal">   9</span>
<span class="normal">  10</span>
<span class="normal">  11</span>
<span class="normal">  12</span>
<span class="normal">  13</span>
<span class="normal">  14</span>
<span class="normal">  15</span>
<span class="normal">  16</span>
<span class="normal">  17</span>
<span class="normal">  18</span>
<span class="normal">  19</span>
<span class="normal">  20</span>
<span class="normal">  21</span>
<span class="normal">  22</span>
<span class="normal">  23</span>
<span class="normal">  24</span>
<span class="normal">  25</span>
<span class="normal">  26</span>
<span class="normal">  27</span>
<span class="normal">  28</span>
<span class="normal">  29</span>
<span class="normal">  30</span>
<span class="normal">  31</span>
<span class="normal">  32</span>
<span class="normal">  33</span>
<span class="normal">  34</span>
<span class="normal">  35</span>
<span class="normal">  36</span>
<span class="normal">  37</span>
<span class="normal">  38</span>
<span class="normal">  39</span>
<span class="normal">  40</span>
<span class="normal">  41</span>
<span class="normal">  42</span>
<span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">wordpress</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;errors&quot;</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>

<span class="w">    </span><span class="nx">tpapi</span><span class="w"> </span><span class="s">&quot;github.com/threeport/threeport/pkg/api/v0&quot;</span>
<span class="w">    </span><span class="nx">kube</span><span class="w"> </span><span class="s">&quot;github.com/threeport/threeport/pkg/kube/v0&quot;</span>
<span class="w">    </span><span class="nx">util</span><span class="w"> </span><span class="s">&quot;github.com/threeport/threeport/pkg/util/v0&quot;</span>
<span class="w">    </span><span class="s">&quot;gorm.io/datatypes&quot;</span>
<span class="w">    </span><span class="s">&quot;k8s.io/apimachinery/pkg/apis/meta/v1/unstructured&quot;</span>
<span class="p">)</span>

<span class="c1">// wordpressYaml returns a YAML manifest for the wordpress workload.</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">wordpressYaml</span><span class="p">(</span>
<span class="w">    </span><span class="nx">definitionName</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span>
<span class="w">    </span><span class="nx">wordpressReplicas</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span>
<span class="w">    </span><span class="nx">environment</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span>
<span class="w">    </span><span class="nx">managedDatabase</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span>
<span class="w">    </span><span class="nx">dbStorageGb</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span>
<span class="w">    </span><span class="nx">dbConnectionSecret</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">yamlDoc</span><span class="w"> </span><span class="kt">string</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">managedDatabase</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">unmanagedDbYamlDoc</span><span class="w"> </span><span class="kt">string</span>

<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">serviceAccountMariadb</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">unstructured</span><span class="p">.</span><span class="nx">Unstructured</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Object</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="s">&quot;apiVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;v1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;kind&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;ServiceAccount&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">      </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-mariadb&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">),</span>
<span class="w">                    </span><span class="s">&quot;namespace&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;labels&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/name&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;mariadb&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/instance&quot;</span><span class="p">:</span><span class="w">   </span><span class="nx">definitionName</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/managed-by&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wordrpess-threepport-module&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;environment&quot;</span><span class="p">:</span><span class="w">                  </span><span class="nx">environment</span><span class="p">,</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="s">&quot;automountServiceAccountToken&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">unmanagedDbYamlDoc</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">kube</span><span class="p">.</span><span class="nx">AppendObjectToYamlDoc</span><span class="p">(</span><span class="nx">serviceAccountMariadb</span><span class="p">,</span><span class="w"> </span><span class="nx">unmanagedDbYamlDoc</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">yamlDoc</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to append object to YAML manifest: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">secretMariadb</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">unstructured</span><span class="p">.</span><span class="nx">Unstructured</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Object</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="s">&quot;apiVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;v1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;kind&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;Secret&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">      </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-mariadb&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">),</span>
<span class="w">                    </span><span class="s">&quot;namespace&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;labels&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/name&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;mariadb&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/instance&quot;</span><span class="p">:</span><span class="w">   </span><span class="nx">definitionName</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/managed-by&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wordrpess-threepport-module&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;environment&quot;</span><span class="p">:</span><span class="w">                  </span><span class="nx">environment</span><span class="p">,</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Opaque&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;mariadb-root-password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WHZOWUhMZ3RFUw==&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;mariadb-password&quot;</span><span class="p">:</span><span class="w">      </span><span class="s">&quot;VHlycG1KVDVPTg==&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">unmanagedDbYamlDoc</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">kube</span><span class="p">.</span><span class="nx">AppendObjectToYamlDoc</span><span class="p">(</span><span class="nx">secretMariadb</span><span class="p">,</span><span class="w"> </span><span class="nx">unmanagedDbYamlDoc</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">yamlDoc</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to append object to YAML manifest: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">configMapMariadb</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">unstructured</span><span class="p">.</span><span class="nx">Unstructured</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Object</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="s">&quot;apiVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;v1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;kind&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;ConfigMap&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">      </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-mariadb&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">),</span>
<span class="w">                    </span><span class="s">&quot;namespace&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;labels&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/name&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;mariadb&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/instance&quot;</span><span class="p">:</span><span class="w">   </span><span class="nx">definitionName</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/managed-by&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wordrpess-threepport-module&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/component&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;primary&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;environment&quot;</span><span class="p">:</span><span class="w">                  </span><span class="nx">environment</span><span class="p">,</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="s">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;my.cnf&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">`[mysqld]</span>
<span class="s">skip-name-resolve</span>
<span class="s">explicit_defaults_for_timestamp</span>
<span class="s">basedir=/opt/bitnami/mariadb</span>
<span class="s">plugin_dir=/opt/bitnami/mariadb/plugin</span>
<span class="s">port=3306</span>
<span class="s">socket=/opt/bitnami/mariadb/tmp/mysql.sock</span>
<span class="s">tmpdir=/opt/bitnami/mariadb/tmp</span>
<span class="s">max_allowed_packet=16M</span>
<span class="s">bind-address=*</span>
<span class="s">pid-file=/opt/bitnami/mariadb/tmp/mysqld.pid</span>
<span class="s">log-error=/opt/bitnami/mariadb/logs/mysqld.log</span>
<span class="s">character-set-server=UTF8</span>
<span class="s">collation-server=utf8_general_ci</span>
<span class="s">slow_query_log=0</span>
<span class="s">slow_query_log_file=/opt/bitnami/mariadb/logs/mysqld.log</span>
<span class="s">long_query_time=10.0</span>

<span class="s">[client]</span>
<span class="s">port=3306</span>
<span class="s">socket=/opt/bitnami/mariadb/tmp/mysql.sock</span>
<span class="s">default-character-set=UTF8</span>
<span class="s">plugin_dir=/opt/bitnami/mariadb/plugin</span>

<span class="s">[manager]</span>
<span class="s">port=3306</span>
<span class="s">socket=/opt/bitnami/mariadb/tmp/mysql.sock</span>
<span class="s">pid-file=/opt/bitnami/mariadb/tmp/mysqld.pid`</span><span class="p">,</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">unmanagedDbYamlDoc</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">kube</span><span class="p">.</span><span class="nx">AppendObjectToYamlDoc</span><span class="p">(</span><span class="nx">configMapMariadb</span><span class="p">,</span><span class="w"> </span><span class="nx">unmanagedDbYamlDoc</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">yamlDoc</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to append object to YAML manifest: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">serviceMariadb</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">unstructured</span><span class="p">.</span><span class="nx">Unstructured</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Object</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="s">&quot;apiVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;v1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;kind&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;Service&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">      </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-mariadb&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">),</span>
<span class="w">                    </span><span class="s">&quot;namespace&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;labels&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/name&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;mariadb&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/instance&quot;</span><span class="p">:</span><span class="w">   </span><span class="nx">definitionName</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/managed-by&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wordrpess-threepport-module&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/component&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;primary&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;environment&quot;</span><span class="p">:</span><span class="w">                  </span><span class="nx">environment</span><span class="p">,</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="s">&quot;annotations&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="s">&quot;spec&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w">            </span><span class="s">&quot;ClusterIP&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;sessionAffinity&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;None&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;ports&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;mysql&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="s">&quot;port&quot;</span><span class="p">:</span><span class="w">       </span><span class="mi">3306</span><span class="p">,</span>
<span class="w">                            </span><span class="s">&quot;protocol&quot;</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;TCP&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="s">&quot;targetPort&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mysql&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="s">&quot;nodePort&quot;</span><span class="p">:</span><span class="w">   </span><span class="kc">nil</span><span class="p">,</span>
<span class="w">                        </span><span class="p">},</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="s">&quot;selector&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/name&quot;</span><span class="p">:</span><span class="w">      </span><span class="s">&quot;mariadb&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/instance&quot;</span><span class="p">:</span><span class="w">  </span><span class="nx">definitionName</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/component&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;primary&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">unmanagedDbYamlDoc</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">kube</span><span class="p">.</span><span class="nx">AppendObjectToYamlDoc</span><span class="p">(</span><span class="nx">serviceMariadb</span><span class="p">,</span><span class="w"> </span><span class="nx">unmanagedDbYamlDoc</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">yamlDoc</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to append object to YAML manifest: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">statefulSetMariadb</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">unstructured</span><span class="p">.</span><span class="nx">Unstructured</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Object</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="s">&quot;apiVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;apps/v1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;kind&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;StatefulSet&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">      </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-mariadb&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">),</span>
<span class="w">                    </span><span class="s">&quot;namespace&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;labels&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/name&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;mariadb&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/instance&quot;</span><span class="p">:</span><span class="w">   </span><span class="nx">definitionName</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/managed-by&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wordrpess-threepport-module&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/component&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;primary&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;environment&quot;</span><span class="p">:</span><span class="w">                  </span><span class="nx">environment</span><span class="p">,</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="s">&quot;spec&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;replicas&quot;</span><span class="p">:</span><span class="w">             </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;revisionHistoryLimit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;selector&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;matchLabels&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                            </span><span class="s">&quot;app.kubernetes.io/name&quot;</span><span class="p">:</span><span class="w">      </span><span class="s">&quot;mariadb&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="s">&quot;app.kubernetes.io/instance&quot;</span><span class="p">:</span><span class="w">  </span><span class="nx">definitionName</span><span class="p">,</span>
<span class="w">                            </span><span class="s">&quot;app.kubernetes.io/component&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;primary&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="p">},</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="s">&quot;serviceName&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-mariadb&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">),</span>
<span class="w">                    </span><span class="s">&quot;updateStrategy&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;RollingUpdate&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="s">&quot;template&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                            </span><span class="s">&quot;annotations&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                </span><span class="s">&quot;checksum/configuration&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;abe9c954f29a801817e9c9bae83f5353a24b42f21603fd18da496edd12991d82&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                            </span><span class="s">&quot;labels&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                </span><span class="s">&quot;app.kubernetes.io/name&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;mariadb&quot;</span><span class="p">,</span>
<span class="w">                                </span><span class="s">&quot;app.kubernetes.io/instance&quot;</span><span class="p">:</span><span class="w">   </span><span class="nx">definitionName</span><span class="p">,</span>
<span class="w">                                </span><span class="s">&quot;app.kubernetes.io/managed-by&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wordrpess-threepport-module&quot;</span><span class="p">,</span>
<span class="w">                                </span><span class="s">&quot;app.kubernetes.io/component&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;primary&quot;</span><span class="p">,</span>
<span class="w">                                </span><span class="s">&quot;environment&quot;</span><span class="p">:</span><span class="w">                  </span><span class="nx">environment</span><span class="p">,</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                        </span><span class="p">},</span>
<span class="w">                        </span><span class="s">&quot;spec&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                            </span><span class="s">&quot;serviceAccountName&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-mariadb&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">),</span>
<span class="w">                            </span><span class="s">&quot;affinity&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                </span><span class="s">&quot;podAffinity&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span>
<span class="w">                                </span><span class="s">&quot;podAntiAffinity&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                    </span><span class="s">&quot;preferredDuringSchedulingIgnoredDuringExecution&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;podAffinityTerm&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                </span><span class="s">&quot;labelSelector&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                    </span><span class="s">&quot;matchLabels&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                        </span><span class="s">&quot;app.kubernetes.io/name&quot;</span><span class="p">:</span><span class="w">      </span><span class="s">&quot;mariadb&quot;</span><span class="p">,</span>
<span class="w">                                                        </span><span class="s">&quot;app.kubernetes.io/instance&quot;</span><span class="p">:</span><span class="w">  </span><span class="nx">definitionName</span><span class="p">,</span>
<span class="w">                                                        </span><span class="s">&quot;app.kubernetes.io/component&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;primary&quot;</span><span class="p">,</span>
<span class="w">                                                    </span><span class="p">},</span>
<span class="w">                                                </span><span class="p">},</span>
<span class="w">                                                </span><span class="s">&quot;topologyKey&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;kubernetes.io/hostname&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="p">},</span>
<span class="w">                                            </span><span class="s">&quot;weight&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">                                </span><span class="s">&quot;nodeAffinity&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                            </span><span class="s">&quot;securityContext&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                </span><span class="s">&quot;fsGroup&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1001</span><span class="p">,</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                            </span><span class="s">&quot;containers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">            </span><span class="s">&quot;mariadb&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="s">&quot;image&quot;</span><span class="p">:</span><span class="w">           </span><span class="s">&quot;docker.io/bitnami/mariadb:10.11.3-debian-11-r0&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="s">&quot;imagePullPolicy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;IfNotPresent&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="s">&quot;securityContext&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="s">&quot;allowPrivilegeEscalation&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;privileged&quot;</span><span class="p">:</span><span class="w">               </span><span class="kc">false</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;runAsNonRoot&quot;</span><span class="p">:</span><span class="w">             </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;runAsUser&quot;</span><span class="p">:</span><span class="w">                </span><span class="mi">1001</span><span class="p">,</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                    </span><span class="s">&quot;env&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;BITNAMI_DEBUG&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MARIADB_ROOT_PASSWORD&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;valueFrom&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                </span><span class="s">&quot;secretKeyRef&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-mariadb&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">),</span>
<span class="w">                                                    </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;mariadb-root-password&quot;</span><span class="p">,</span>
<span class="w">                                                </span><span class="p">},</span>
<span class="w">                                            </span><span class="p">},</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;MARIADB_USER&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bn_wordpress&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MARIADB_PASSWORD&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;valueFrom&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                </span><span class="s">&quot;secretKeyRef&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-mariadb&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">),</span>
<span class="w">                                                    </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;mariadb-password&quot;</span><span class="p">,</span>
<span class="w">                                                </span><span class="p">},</span>
<span class="w">                                            </span><span class="p">},</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;MARIADB_DATABASE&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bitnami_wordpress&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                    </span><span class="s">&quot;ports&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">          </span><span class="s">&quot;mysql&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;containerPort&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3306</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                    </span><span class="s">&quot;livenessProbe&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="s">&quot;failureThreshold&quot;</span><span class="p">:</span><span class="w">    </span><span class="mi">3</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;initialDelaySeconds&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">120</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;periodSeconds&quot;</span><span class="p">:</span><span class="w">       </span><span class="mi">10</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;successThreshold&quot;</span><span class="p">:</span><span class="w">    </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;timeoutSeconds&quot;</span><span class="p">:</span><span class="w">      </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;exec&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                </span><span class="s">&quot;/bin/bash&quot;</span><span class="p">,</span>
<span class="w">                                                </span><span class="s">&quot;-ec&quot;</span><span class="p">,</span>
<span class="w">                                                </span><span class="s">`password_aux=&quot;${MARIADB_ROOT_PASSWORD:-}&quot;</span>
<span class="s">if [[ -f &quot;${MARIADB_ROOT_PASSWORD_FILE:-}&quot; ]]; then</span>
<span class="s">    password_aux=$(cat &quot;$MARIADB_ROOT_PASSWORD_FILE&quot;)</span>
<span class="s">fi</span>
<span class="s">mysqladmin status -uroot -p&quot;${password_aux}&quot;</span>
<span class="s">`</span><span class="p">,</span>
<span class="w">                                            </span><span class="p">},</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                    </span><span class="s">&quot;readinessProbe&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="s">&quot;failureThreshold&quot;</span><span class="p">:</span><span class="w">    </span><span class="mi">3</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;initialDelaySeconds&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;periodSeconds&quot;</span><span class="p">:</span><span class="w">       </span><span class="mi">10</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;successThreshold&quot;</span><span class="p">:</span><span class="w">    </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;timeoutSeconds&quot;</span><span class="p">:</span><span class="w">      </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;exec&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                </span><span class="s">&quot;/bin/bash&quot;</span><span class="p">,</span>
<span class="w">                                                </span><span class="s">&quot;-ec&quot;</span><span class="p">,</span>
<span class="w">                                                </span><span class="s">`password_aux=&quot;${MARIADB_ROOT_PASSWORD:-}&quot;</span>
<span class="s">if [[ -f &quot;${MARIADB_ROOT_PASSWORD_FILE:-}&quot; ]]; then</span>
<span class="s">    password_aux=$(cat &quot;$MARIADB_ROOT_PASSWORD_FILE&quot;)</span>
<span class="s">fi</span>
<span class="s">mysqladmin status -uroot -p&quot;${password_aux}&quot;</span>
<span class="s">`</span><span class="p">,</span>
<span class="w">                                            </span><span class="p">},</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                    </span><span class="s">&quot;resources&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="s">&quot;limits&quot;</span><span class="p">:</span><span class="w">   </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{},</span>
<span class="w">                                        </span><span class="s">&quot;requests&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{},</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                    </span><span class="s">&quot;volumeMounts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">      </span><span class="s">&quot;data&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;mountPath&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/bitnami/mariadb&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">      </span><span class="s">&quot;config&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;mountPath&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/opt/bitnami/mariadb/conf/my.cnf&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;subPath&quot;</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;my.cnf&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                            </span><span class="s">&quot;volumes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;config&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="s">&quot;configMap&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-mariadb&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">),</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                        </span><span class="p">},</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="s">&quot;volumeClaimTemplates&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                            </span><span class="s">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;data&quot;</span><span class="p">,</span>
<span class="w">                                </span><span class="s">&quot;labels&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                    </span><span class="s">&quot;app.kubernetes.io/name&quot;</span><span class="p">:</span><span class="w">      </span><span class="s">&quot;mariadb&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="s">&quot;app.kubernetes.io/instance&quot;</span><span class="p">:</span><span class="w">  </span><span class="nx">definitionName</span><span class="p">,</span>
<span class="w">                                    </span><span class="s">&quot;app.kubernetes.io/component&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;primary&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="s">&quot;environment&quot;</span><span class="p">:</span><span class="w">                 </span><span class="nx">environment</span><span class="p">,</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                            </span><span class="s">&quot;spec&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                </span><span class="s">&quot;accessModes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                    </span><span class="s">&quot;ReadWriteOnce&quot;</span><span class="p">,</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">                                </span><span class="s">&quot;resources&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                    </span><span class="s">&quot;requests&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="s">&quot;storage&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%dGi&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">dbStorageGb</span><span class="p">),</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                        </span><span class="p">},</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">unmanagedDbYamlDoc</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">kube</span><span class="p">.</span><span class="nx">AppendObjectToYamlDoc</span><span class="p">(</span><span class="nx">statefulSetMariadb</span><span class="p">,</span><span class="w"> </span><span class="nx">unmanagedDbYamlDoc</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">yamlDoc</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to append object to YAML manifest: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">deploymentWordpress</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">unstructured</span><span class="p">.</span><span class="nx">Unstructured</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Object</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="s">&quot;apiVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;apps/v1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;kind&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;Deployment&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">      </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-wordpress&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">),</span>
<span class="w">                    </span><span class="s">&quot;namespace&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;labels&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/name&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;wordpress&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/instance&quot;</span><span class="p">:</span><span class="w">   </span><span class="nx">definitionName</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/managed-by&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wordrpess-threepport-module&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;environment&quot;</span><span class="p">:</span><span class="w">                  </span><span class="nx">environment</span><span class="p">,</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="s">&quot;spec&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;selector&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;matchLabels&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                            </span><span class="s">&quot;app.kubernetes.io/name&quot;</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;wordpress&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="s">&quot;app.kubernetes.io/instance&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">,</span>
<span class="w">                        </span><span class="p">},</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="s">&quot;strategy&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;RollingUpdate&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="s">&quot;replicas&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">wordpressReplicas</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;template&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                            </span><span class="s">&quot;labels&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                </span><span class="s">&quot;app.kubernetes.io/name&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;wordpress&quot;</span><span class="p">,</span>
<span class="w">                                </span><span class="s">&quot;app.kubernetes.io/instance&quot;</span><span class="p">:</span><span class="w">   </span><span class="nx">definitionName</span><span class="p">,</span>
<span class="w">                                </span><span class="s">&quot;app.kubernetes.io/managed-by&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wordrpess-threepport-module&quot;</span><span class="p">,</span>
<span class="w">                                </span><span class="s">&quot;environment&quot;</span><span class="p">:</span><span class="w">                  </span><span class="nx">environment</span><span class="p">,</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                        </span><span class="p">},</span>
<span class="w">                        </span><span class="s">&quot;spec&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                            </span><span class="c1">// yamllint disable rule:indentation</span>
<span class="w">                            </span><span class="s">&quot;hostAliases&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                    </span><span class="s">&quot;hostnames&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="s">&quot;status.localhost&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                    </span><span class="s">&quot;ip&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">,</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                            </span><span class="c1">// yamllint enable rule:indentation</span>
<span class="w">                            </span><span class="s">&quot;affinity&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                </span><span class="s">&quot;podAffinity&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span>
<span class="w">                                </span><span class="s">&quot;podAntiAffinity&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                    </span><span class="s">&quot;preferredDuringSchedulingIgnoredDuringExecution&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;podAffinityTerm&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                </span><span class="s">&quot;labelSelector&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                    </span><span class="s">&quot;matchLabels&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                        </span><span class="s">&quot;app.kubernetes.io/name&quot;</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;wordpress&quot;</span><span class="p">,</span>
<span class="w">                                                        </span><span class="s">&quot;app.kubernetes.io/instance&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">,</span>
<span class="w">                                                    </span><span class="p">},</span>
<span class="w">                                                </span><span class="p">},</span>
<span class="w">                                                </span><span class="s">&quot;topologyKey&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;kubernetes.io/hostname&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="p">},</span>
<span class="w">                                            </span><span class="s">&quot;weight&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">                                </span><span class="s">&quot;nodeAffinity&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                            </span><span class="s">&quot;securityContext&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                </span><span class="s">&quot;fsGroup&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1001</span><span class="p">,</span>
<span class="w">                                </span><span class="s">&quot;seccompProfile&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                    </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;RuntimeDefault&quot;</span><span class="p">,</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                            </span><span class="s">&quot;serviceAccountName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="s">&quot;containers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">            </span><span class="s">&quot;wordpress&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="s">&quot;image&quot;</span><span class="p">:</span><span class="w">           </span><span class="s">&quot;docker.io/bitnami/wordpress:6.2.0-debian-11-r22&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="s">&quot;imagePullPolicy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;IfNotPresent&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="s">&quot;securityContext&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="s">&quot;allowPrivilegeEscalation&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;capabilities&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;drop&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                </span><span class="s">&quot;ALL&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="p">},</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="s">&quot;runAsNonRoot&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;runAsUser&quot;</span><span class="p">:</span><span class="w">    </span><span class="mi">1001</span><span class="p">,</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                    </span><span class="s">&quot;env&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;BITNAMI_DEBUG&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;ALLOW_EMPTY_PASSWORD&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;MARIADB_HOST&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-mariadb&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">),</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;MARIADB_PORT_NUMBER&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3306&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_DATABASE_NAME&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bitnami_wordpress&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_DATABASE_USER&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bn_wordpress&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WORDPRESS_DATABASE_PASSWORD&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;valueFrom&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                </span><span class="s">&quot;secretKeyRef&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-mariadb&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">),</span>
<span class="w">                                                    </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;mariadb-password&quot;</span><span class="p">,</span>
<span class="w">                                                </span><span class="p">},</span>
<span class="w">                                            </span><span class="p">},</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_USERNAME&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WORDPRESS_PASSWORD&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;valueFrom&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                </span><span class="s">&quot;secretKeyRef&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-wordpress&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">),</span>
<span class="w">                                                    </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;wordpress-password&quot;</span><span class="p">,</span>
<span class="w">                                                </span><span class="p">},</span>
<span class="w">                                            </span><span class="p">},</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_EMAIL&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user@example.com&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_FIRST_NAME&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;FirstName&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_LAST_NAME&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;LastName&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_HTACCESS_OVERRIDE_NONE&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;no&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_ENABLE_HTACCESS_PERSISTENCE&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;no&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_BLOG_NAME&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;User&#39;s Blog!&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_SKIP_BOOTSTRAP&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;no&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_TABLE_PREFIX&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wp_&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_SCHEME&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_EXTRA_WP_CONFIG_CONTENT&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_PLUGINS&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;none&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;APACHE_HTTP_PORT_NUMBER&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8080&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;APACHE_HTTPS_PORT_NUMBER&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8443&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                    </span><span class="s">&quot;envFrom&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span>
<span class="w">                                    </span><span class="s">&quot;ports&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">          </span><span class="s">&quot;http&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;containerPort&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8080</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">          </span><span class="s">&quot;https&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;containerPort&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8443</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                    </span><span class="s">&quot;livenessProbe&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="s">&quot;failureThreshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;httpGet&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;httpHeaders&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{},</span>
<span class="w">                                            </span><span class="s">&quot;path&quot;</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;/wp-admin/install.php&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;port&quot;</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;http&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;scheme&quot;</span><span class="p">:</span><span class="w">      </span><span class="s">&quot;HTTP&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="s">&quot;initialDelaySeconds&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">120</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;periodSeconds&quot;</span><span class="p">:</span><span class="w">       </span><span class="mi">10</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;successThreshold&quot;</span><span class="p">:</span><span class="w">    </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;timeoutSeconds&quot;</span><span class="p">:</span><span class="w">      </span><span class="mi">5</span><span class="p">,</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                    </span><span class="s">&quot;readinessProbe&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="s">&quot;failureThreshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;httpGet&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;httpHeaders&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{},</span>
<span class="w">                                            </span><span class="s">&quot;path&quot;</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;/wp-login.php&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;port&quot;</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;http&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;scheme&quot;</span><span class="p">:</span><span class="w">      </span><span class="s">&quot;HTTP&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="s">&quot;initialDelaySeconds&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;periodSeconds&quot;</span><span class="p">:</span><span class="w">       </span><span class="mi">10</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;successThreshold&quot;</span><span class="p">:</span><span class="w">    </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;timeoutSeconds&quot;</span><span class="p">:</span><span class="w">      </span><span class="mi">5</span><span class="p">,</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                    </span><span class="s">&quot;resources&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="s">&quot;limits&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{},</span>
<span class="w">                                        </span><span class="s">&quot;requests&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;cpu&quot;</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;300m&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;memory&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;512Mi&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                    </span><span class="s">&quot;volumeMounts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;mountPath&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/bitnami/wordpress&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">      </span><span class="s">&quot;wordpress-data&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;subPath&quot;</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;wordpress&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                            </span><span class="s">&quot;volumes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wordpress-data&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="s">&quot;persistentVolumeClaim&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="s">&quot;claimName&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-wordpress&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">),</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                        </span><span class="p">},</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">unmanagedDbYamlDoc</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">kube</span><span class="p">.</span><span class="nx">AppendObjectToYamlDoc</span><span class="p">(</span><span class="nx">deploymentWordpress</span><span class="p">,</span><span class="w"> </span><span class="nx">unmanagedDbYamlDoc</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">yamlDoc</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to append object to YAML manifest: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">yamlDoc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">unmanagedDbYamlDoc</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">managedDbYamlDoc</span><span class="w"> </span><span class="kt">string</span>

<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">deploymentWordpress</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">unstructured</span><span class="p">.</span><span class="nx">Unstructured</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Object</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="s">&quot;apiVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;apps/v1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;kind&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;Deployment&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">      </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-wordpress&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">),</span>
<span class="w">                    </span><span class="s">&quot;namespace&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;labels&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/name&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;wordpress&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/instance&quot;</span><span class="p">:</span><span class="w">   </span><span class="nx">definitionName</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;app.kubernetes.io/managed-by&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wordrpess-threepport-module&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;environment&quot;</span><span class="p">:</span><span class="w">                  </span><span class="nx">environment</span><span class="p">,</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="s">&quot;spec&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;selector&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;matchLabels&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                            </span><span class="s">&quot;app.kubernetes.io/name&quot;</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;wordpress&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="s">&quot;app.kubernetes.io/instance&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">,</span>
<span class="w">                        </span><span class="p">},</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="s">&quot;strategy&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;RollingUpdate&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="s">&quot;replicas&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">wordpressReplicas</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;template&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                            </span><span class="s">&quot;labels&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                </span><span class="s">&quot;app.kubernetes.io/name&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;wordpress&quot;</span><span class="p">,</span>
<span class="w">                                </span><span class="s">&quot;app.kubernetes.io/instance&quot;</span><span class="p">:</span><span class="w">   </span><span class="nx">definitionName</span><span class="p">,</span>
<span class="w">                                </span><span class="s">&quot;app.kubernetes.io/managed-by&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wordrpess-threepport-module&quot;</span><span class="p">,</span>
<span class="w">                                </span><span class="s">&quot;environment&quot;</span><span class="p">:</span><span class="w">                  </span><span class="nx">environment</span><span class="p">,</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                        </span><span class="p">},</span>
<span class="w">                        </span><span class="s">&quot;spec&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                            </span><span class="c1">// yamllint disable rule:indentation</span>
<span class="w">                            </span><span class="s">&quot;hostAliases&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                    </span><span class="s">&quot;hostnames&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="s">&quot;status.localhost&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                    </span><span class="s">&quot;ip&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">,</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                            </span><span class="c1">// yamllint enable rule:indentation</span>
<span class="w">                            </span><span class="s">&quot;affinity&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                </span><span class="s">&quot;podAffinity&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span>
<span class="w">                                </span><span class="s">&quot;podAntiAffinity&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                    </span><span class="s">&quot;preferredDuringSchedulingIgnoredDuringExecution&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;podAffinityTerm&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                </span><span class="s">&quot;labelSelector&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                    </span><span class="s">&quot;matchLabels&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                        </span><span class="s">&quot;app.kubernetes.io/name&quot;</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;wordpress&quot;</span><span class="p">,</span>
<span class="w">                                                        </span><span class="s">&quot;app.kubernetes.io/instance&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">,</span>
<span class="w">                                                    </span><span class="p">},</span>
<span class="w">                                                </span><span class="p">},</span>
<span class="w">                                                </span><span class="s">&quot;topologyKey&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;kubernetes.io/hostname&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="p">},</span>
<span class="w">                                            </span><span class="s">&quot;weight&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">                                </span><span class="s">&quot;nodeAffinity&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                            </span><span class="s">&quot;securityContext&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                </span><span class="s">&quot;fsGroup&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1001</span><span class="p">,</span>
<span class="w">                                </span><span class="s">&quot;seccompProfile&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                    </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;RuntimeDefault&quot;</span><span class="p">,</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                            </span><span class="s">&quot;serviceAccountName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="s">&quot;containers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">            </span><span class="s">&quot;wordpress&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="s">&quot;image&quot;</span><span class="p">:</span><span class="w">           </span><span class="s">&quot;docker.io/bitnami/wordpress:6.2.0-debian-11-r22&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="s">&quot;imagePullPolicy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;IfNotPresent&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="s">&quot;securityContext&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="s">&quot;allowPrivilegeEscalation&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;capabilities&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;drop&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                </span><span class="s">&quot;ALL&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="p">},</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="s">&quot;runAsNonRoot&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;runAsUser&quot;</span><span class="p">:</span><span class="w">    </span><span class="mi">1001</span><span class="p">,</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                    </span><span class="s">&quot;env&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;BITNAMI_DEBUG&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;ALLOW_EMPTY_PASSWORD&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MARIADB_HOST&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;valueFrom&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                </span><span class="s">&quot;secretKeyRef&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">dbConnectionSecret</span><span class="p">,</span>
<span class="w">                                                    </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;db-endpoint&quot;</span><span class="p">,</span>
<span class="w">                                                </span><span class="p">},</span>
<span class="w">                                            </span><span class="p">},</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MARIADB_PORT_NUMBER&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;valueFrom&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                </span><span class="s">&quot;secretKeyRef&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">dbConnectionSecret</span><span class="p">,</span>
<span class="w">                                                    </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;db-port&quot;</span><span class="p">,</span>
<span class="w">                                                </span><span class="p">},</span>
<span class="w">                                            </span><span class="p">},</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WORDPRESS_DATABASE_NAME&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;valueFrom&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                </span><span class="s">&quot;secretKeyRef&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">dbConnectionSecret</span><span class="p">,</span>
<span class="w">                                                    </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;db-name&quot;</span><span class="p">,</span>
<span class="w">                                                </span><span class="p">},</span>
<span class="w">                                            </span><span class="p">},</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WORDPRESS_DATABASE_USER&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;valueFrom&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                </span><span class="s">&quot;secretKeyRef&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">dbConnectionSecret</span><span class="p">,</span>
<span class="w">                                                    </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;db-user&quot;</span><span class="p">,</span>
<span class="w">                                                </span><span class="p">},</span>
<span class="w">                                            </span><span class="p">},</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WORDPRESS_DATABASE_PASSWORD&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;valueFrom&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                </span><span class="s">&quot;secretKeyRef&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">dbConnectionSecret</span><span class="p">,</span>
<span class="w">                                                    </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;db-password&quot;</span><span class="p">,</span>
<span class="w">                                                </span><span class="p">},</span>
<span class="w">                                            </span><span class="p">},</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_USERNAME&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WORDPRESS_PASSWORD&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;valueFrom&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                </span><span class="s">&quot;secretKeyRef&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-wordpress&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">),</span>
<span class="w">                                                    </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;wordpress-password&quot;</span><span class="p">,</span>
<span class="w">                                                </span><span class="p">},</span>
<span class="w">                                            </span><span class="p">},</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_EMAIL&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user@example.com&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_FIRST_NAME&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;FirstName&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_LAST_NAME&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;LastName&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_HTACCESS_OVERRIDE_NONE&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;no&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_ENABLE_HTACCESS_PERSISTENCE&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;no&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_BLOG_NAME&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;User&#39;s Blog!&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_SKIP_BOOTSTRAP&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;no&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_TABLE_PREFIX&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wp_&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_SCHEME&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_EXTRA_WP_CONFIG_CONTENT&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;WORDPRESS_PLUGINS&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;none&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;APACHE_HTTP_PORT_NUMBER&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8080&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;APACHE_HTTPS_PORT_NUMBER&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8443&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                    </span><span class="s">&quot;envFrom&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span>
<span class="w">                                    </span><span class="s">&quot;ports&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">          </span><span class="s">&quot;http&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;containerPort&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8080</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">          </span><span class="s">&quot;https&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;containerPort&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8443</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                    </span><span class="s">&quot;livenessProbe&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="s">&quot;failureThreshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;httpGet&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;httpHeaders&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{},</span>
<span class="w">                                            </span><span class="s">&quot;path&quot;</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;/wp-admin/install.php&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;port&quot;</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;http&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;scheme&quot;</span><span class="p">:</span><span class="w">      </span><span class="s">&quot;HTTP&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="s">&quot;initialDelaySeconds&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">120</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;periodSeconds&quot;</span><span class="p">:</span><span class="w">       </span><span class="mi">10</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;successThreshold&quot;</span><span class="p">:</span><span class="w">    </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;timeoutSeconds&quot;</span><span class="p">:</span><span class="w">      </span><span class="mi">5</span><span class="p">,</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                    </span><span class="s">&quot;readinessProbe&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="s">&quot;failureThreshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;httpGet&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;httpHeaders&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{},</span>
<span class="w">                                            </span><span class="s">&quot;path&quot;</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;/wp-login.php&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;port&quot;</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;http&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;scheme&quot;</span><span class="p">:</span><span class="w">      </span><span class="s">&quot;HTTP&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                        </span><span class="s">&quot;initialDelaySeconds&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;periodSeconds&quot;</span><span class="p">:</span><span class="w">       </span><span class="mi">10</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;successThreshold&quot;</span><span class="p">:</span><span class="w">    </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                                        </span><span class="s">&quot;timeoutSeconds&quot;</span><span class="p">:</span><span class="w">      </span><span class="mi">5</span><span class="p">,</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                    </span><span class="s">&quot;resources&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="s">&quot;limits&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{},</span>
<span class="w">                                        </span><span class="s">&quot;requests&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;cpu&quot;</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;300m&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;memory&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;512Mi&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                    </span><span class="s">&quot;volumeMounts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                            </span><span class="s">&quot;mountPath&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/bitnami/wordpress&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">      </span><span class="s">&quot;wordpress-data&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="s">&quot;subPath&quot;</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;wordpress&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="p">},</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                            </span><span class="s">&quot;volumes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wordpress-data&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="s">&quot;persistentVolumeClaim&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                                        </span><span class="s">&quot;claimName&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-wordpress&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">),</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                        </span><span class="p">},</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">managedDbYamlDoc</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">kube</span><span class="p">.</span><span class="nx">AppendObjectToYamlDoc</span><span class="p">(</span><span class="nx">deploymentWordpress</span><span class="p">,</span><span class="w"> </span><span class="nx">managedDbYamlDoc</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">yamlDoc</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to append object to YAML manifest: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">yamlDoc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">managedDbYamlDoc</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">secretWordpress</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">unstructured</span><span class="p">.</span><span class="nx">Unstructured</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Object</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">            </span><span class="s">&quot;apiVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;v1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;kind&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;Secret&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">      </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-wordpress&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">),</span>
<span class="w">                </span><span class="s">&quot;namespace&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;labels&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;app.kubernetes.io/name&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;wordpress&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;app.kubernetes.io/instance&quot;</span><span class="p">:</span><span class="w">   </span><span class="nx">definitionName</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;app.kubernetes.io/managed-by&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wordrpess-threepport-module&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;environment&quot;</span><span class="p">:</span><span class="w">                  </span><span class="nx">environment</span><span class="p">,</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Opaque&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="s">&quot;wordpress-password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;VkR5MUJhSno5Uw==&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">yamlDoc</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">kube</span><span class="p">.</span><span class="nx">AppendObjectToYamlDoc</span><span class="p">(</span><span class="nx">secretWordpress</span><span class="p">,</span><span class="w"> </span><span class="nx">yamlDoc</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">yamlDoc</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to append object to YAML manifest: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">serviceWordpress</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">unstructured</span><span class="p">.</span><span class="nx">Unstructured</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Object</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">            </span><span class="s">&quot;apiVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;v1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;kind&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;Service&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">      </span><span class="nx">getWordpressServiceName</span><span class="p">(</span><span class="nx">definitionName</span><span class="p">),</span>
<span class="w">                </span><span class="s">&quot;namespace&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;labels&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;app.kubernetes.io/name&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;wordpress&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;app.kubernetes.io/instance&quot;</span><span class="p">:</span><span class="w">   </span><span class="nx">definitionName</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;app.kubernetes.io/managed-by&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wordrpess-threepport-module&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;environment&quot;</span><span class="p">:</span><span class="w">                  </span><span class="nx">environment</span><span class="p">,</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s">&quot;spec&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w">            </span><span class="s">&quot;ClusterIP&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;sessionAffinity&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;None&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;ports&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;http&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;port&quot;</span><span class="p">:</span><span class="w">       </span><span class="mi">80</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;protocol&quot;</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;TCP&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;targetPort&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;https&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;port&quot;</span><span class="p">:</span><span class="w">       </span><span class="mi">443</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;protocol&quot;</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;TCP&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;targetPort&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="s">&quot;selector&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;app.kubernetes.io/name&quot;</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;wordpress&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;app.kubernetes.io/instance&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">,</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">yamlDoc</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">kube</span><span class="p">.</span><span class="nx">AppendObjectToYamlDoc</span><span class="p">(</span><span class="nx">serviceWordpress</span><span class="p">,</span><span class="w"> </span><span class="nx">yamlDoc</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">yamlDoc</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to append object to YAML manifest: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">yamlDoc</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// getWordpressServiceName returns the WordPress deployment&#39;s service name.</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">getWordpressServiceName</span><span class="p">(</span><span class="nx">definitionName</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-wordpress&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// getPvcManifest returns the JSON for the persistent volume claim with the</span>
<span class="c1">// storage class name set for the infra provider.</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">getPvcManifest</span><span class="p">(</span>
<span class="w">    </span><span class="nx">infraProvider</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span>
<span class="w">    </span><span class="nx">definitionName</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span>
<span class="w">    </span><span class="nx">environment</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">datatypes</span><span class="p">.</span><span class="nx">JSON</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">storageClassName</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">infraProvider</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">KubernetesRuntimeInfraProviderKind</span><span class="p">:</span>
<span class="w">        </span><span class="nx">storageClassName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;standard&quot;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">tpapi</span><span class="p">.</span><span class="nx">KubernetesRuntimeInfraProviderEKS</span><span class="p">:</span>
<span class="w">        </span><span class="nx">storageClassName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;gp2&quot;</span>
<span class="w">    </span><span class="k">default</span><span class="p">:</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;unrecognized infra provider&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">persistentVolumeClaimWordpress</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">unstructured</span><span class="p">.</span><span class="nx">Unstructured</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Object</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">            </span><span class="s">&quot;kind&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;PersistentVolumeClaim&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;apiVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;v1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">      </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-wordpress&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">definitionName</span><span class="p">),</span>
<span class="w">                </span><span class="s">&quot;namespace&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;labels&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;app.kubernetes.io/name&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;wordpress&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;app.kubernetes.io/instance&quot;</span><span class="p">:</span><span class="w">   </span><span class="nx">definitionName</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;app.kubernetes.io/managed-by&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wordrpess-threepport-module&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;environment&quot;</span><span class="p">:</span><span class="w">                  </span><span class="nx">environment</span><span class="p">,</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s">&quot;spec&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="s">&quot;storageClassName&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">storageClassName</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;accessModes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;ReadWriteOnce&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="s">&quot;resources&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;requests&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;storage&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10Gi&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">jsonData</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">util</span><span class="p">.</span><span class="nx">UnstructuredToDatatypesJson</span><span class="p">(</span><span class="nx">persistentVolumeClaimWordpress</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to generate JSON for PVC: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">jsonData</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>At this point the create and delete functionality for the WordPress objects has
been implemented.  For now, we will skip the update functionality for now.  That
can be added later.</p>
<h2 id="add-config-abstractions">Add Config Abstractions<a class="headerlink" href="#add-config-abstractions" title="Permanent link">&para;</a></h2>
<h3 id="updates-to-pkgconfigv0wordpressgo">Updates to <code>pkg/config/v0/wordpress.go</code><a class="headerlink" href="#updates-to-pkgconfigv0wordpressgo" title="Permanent link">&para;</a></h3>
<p>The file <code>pkg/config/v0/wordpress.go</code> contains scaffolding for config
abstractions that allow a single user command to make multiple API calls on the
user's behalf.  This is an important way to reduce toil on the user of the
system and provide useful user abstractions.</p>
<p>Let's add the source code to provide these config abstractions.</p>
<p>First, we need to update three types.  These types determine the schema for
config interfaces that will be used to manage WordPress objects.</p>
<p>Find the types below in that file and update them to match the code below.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// WordpressValues contains the attributes needed to manage a wordpress</span>
<span class="c1">// definition and wordpress instance with a single operation.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">WordpressValues</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">                      </span><span class="o">*</span><span class="kt">string</span><span class="w">                                   </span><span class="s">`yaml:&quot;Name&quot;`</span>
<span class="w">    </span><span class="nx">Environment</span><span class="w">               </span><span class="o">*</span><span class="kt">string</span><span class="w">                                   </span><span class="s">`yaml:&quot;Environment&quot;`</span>
<span class="w">    </span><span class="nx">Replicas</span><span class="w">                  </span><span class="o">*</span><span class="kt">int</span><span class="w">                                      </span><span class="s">`yaml:&quot;Replicas&quot;`</span>
<span class="w">    </span><span class="nx">ManagedDatabase</span><span class="w">           </span><span class="o">*</span><span class="kt">bool</span><span class="w">                                     </span><span class="s">`yaml:&quot;ManagedDatabase&quot;`</span>
<span class="w">    </span><span class="nx">DomainName</span><span class="w">                </span><span class="o">*</span><span class="nx">tpconfig</span><span class="p">.</span><span class="nx">DomainNameValues</span><span class="w">                </span><span class="s">`yaml:&quot;DomainName&quot;`</span>
<span class="w">    </span><span class="nx">SubDomain</span><span class="w">                 </span><span class="o">*</span><span class="kt">string</span><span class="w">                                   </span><span class="s">`yaml:&quot;SubDomain&quot;`</span>
<span class="w">    </span><span class="nx">KubernetesRuntimeInstance</span><span class="w"> </span><span class="o">*</span><span class="nx">tpconfig</span><span class="p">.</span><span class="nx">KubernetesRuntimeInstanceValues</span><span class="w"> </span><span class="s">`yaml:&quot;KubernetesRuntimeInstance&quot;`</span>
<span class="w">    </span><span class="nx">AwsAccountName</span><span class="w">            </span><span class="o">*</span><span class="kt">string</span><span class="w">                                   </span><span class="s">`yaml:&quot;AwsAccountName&quot;`</span>
<span class="p">}</span>

<span class="o">...</span>

<span class="c1">// WordpressDefinitionValues contains the attributes for the wordpress definition</span>
<span class="c1">// config abstraction.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">WordpressDefinitionValues</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">            </span><span class="o">*</span><span class="kt">string</span><span class="w">                    </span><span class="s">`yaml:&quot;Name&quot;`</span>
<span class="w">    </span><span class="nx">Environment</span><span class="w">     </span><span class="o">*</span><span class="kt">string</span><span class="w">                    </span><span class="s">`yaml:&quot;Environment&quot;`</span>
<span class="w">    </span><span class="nx">Replicas</span><span class="w">        </span><span class="o">*</span><span class="kt">int</span><span class="w">                       </span><span class="s">`yaml:&quot;Replicas&quot;`</span>
<span class="w">    </span><span class="nx">ManagedDatabase</span><span class="w"> </span><span class="o">*</span><span class="kt">bool</span><span class="w">                      </span><span class="s">`yaml:&quot;ManagedDatabase&quot;`</span>
<span class="w">    </span><span class="nx">DomainName</span><span class="w">      </span><span class="o">*</span><span class="nx">tpconfig</span><span class="p">.</span><span class="nx">DomainNameValues</span><span class="w"> </span><span class="s">`yaml:&quot;DomainName&quot;`</span>
<span class="w">    </span><span class="nx">AwsAccountName</span><span class="w">  </span><span class="o">*</span><span class="kt">string</span><span class="w">                    </span><span class="s">`yaml:&quot;AwsAccount&quot;`</span>
<span class="p">}</span>

<span class="o">...</span>

<span class="c1">// WordpressInstanceValues contains the attributes for the wordpress instance</span>
<span class="c1">// config abstraction.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">WordpressInstanceValues</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">                      </span><span class="o">*</span><span class="kt">string</span><span class="w">                                   </span><span class="s">`yaml:&quot;Name&quot;`</span>
<span class="w">    </span><span class="nx">SubDomain</span><span class="w">                 </span><span class="o">*</span><span class="kt">string</span><span class="w">                                   </span><span class="s">`yaml:&quot;SubDomain&quot;`</span>
<span class="w">    </span><span class="nx">WordpressDefinition</span><span class="w">       </span><span class="nx">WordpressDefinitionValues</span><span class="w">                 </span><span class="s">`yaml:&quot;WordpressDefinition&quot;`</span>
<span class="w">    </span><span class="nx">KubernetesRuntimeInstance</span><span class="w"> </span><span class="o">*</span><span class="nx">tpconfig</span><span class="p">.</span><span class="nx">KubernetesRuntimeInstanceValues</span><span class="w"> </span><span class="s">`yaml:&quot;KubernetesRuntimeInstance&quot;`</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Next, let's update the methods on the <code>WordpressValues</code> object to match the code
shown here.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// Create creates a wordpress definition and instance in the Threeport API.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="o">*</span><span class="nx">WordpressValues</span><span class="p">)</span><span class="w"> </span><span class="nx">Create</span><span class="p">(</span>
<span class="w">    </span><span class="nx">apiClient</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">,</span>
<span class="w">    </span><span class="nx">apiEndpoint</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">api_v0</span><span class="p">.</span><span class="nx">WordpressDefinition</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">api_v0</span><span class="p">.</span><span class="nx">WordpressInstance</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// get operations</span>
<span class="w">    </span><span class="nx">operations</span><span class="p">,</span><span class="w"> </span><span class="nx">createdWordpressDefinition</span><span class="p">,</span><span class="w"> </span><span class="nx">createdWordpressInstance</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">GetOperations</span><span class="p">(</span>
<span class="w">        </span><span class="nx">apiClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">apiEndpoint</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="c1">// execute create operations</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">operations</span><span class="p">.</span><span class="nx">Create</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;failed to execute create operations for wordpress defined instance with name %s: %w&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="o">*</span><span class="nx">w</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">            </span><span class="nx">err</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">createdWordpressDefinition</span><span class="p">,</span><span class="w"> </span><span class="nx">createdWordpressInstance</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// Delete deletes a wordpress definition and instance from the Threeport API.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="o">*</span><span class="nx">WordpressValues</span><span class="p">)</span><span class="w"> </span><span class="nx">Delete</span><span class="p">(</span>
<span class="w">    </span><span class="nx">apiClient</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">,</span>
<span class="w">    </span><span class="nx">apiEndpoint</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">api_v0</span><span class="p">.</span><span class="nx">WordpressDefinition</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">api_v0</span><span class="p">.</span><span class="nx">WordpressInstance</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// get operations</span>
<span class="w">    </span><span class="nx">operations</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">GetOperations</span><span class="p">(</span>
<span class="w">        </span><span class="nx">apiClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">apiEndpoint</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="c1">// execute delete operations</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">operations</span><span class="p">.</span><span class="nx">Delete</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;failed to execute delete operations for wordpress defined instance with name %s: %w&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="o">*</span><span class="nx">w</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">            </span><span class="nx">err</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// GetOperations returns a slice of operations used to create or delete a</span>
<span class="c1">// wordpress defined instance.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="o">*</span><span class="nx">WordpressValues</span><span class="p">)</span><span class="w"> </span><span class="nx">GetOperations</span><span class="p">(</span>
<span class="w">    </span><span class="nx">apiClient</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">,</span>
<span class="w">    </span><span class="nx">apiEndpoint</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">util</span><span class="p">.</span><span class="nx">Operations</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">api_v0</span><span class="p">.</span><span class="nx">WordpressDefinition</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">api_v0</span><span class="p">.</span><span class="nx">WordpressInstance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">createdWordpressDefinition</span><span class="w"> </span><span class="nx">api_v0</span><span class="p">.</span><span class="nx">WordpressDefinition</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">createdWordpressInstance</span><span class="w"> </span><span class="nx">api_v0</span><span class="p">.</span><span class="nx">WordpressInstance</span>

<span class="w">    </span><span class="nx">operations</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">util</span><span class="p">.</span><span class="nx">Operations</span><span class="p">{}</span>

<span class="w">    </span><span class="c1">// add wordpress definition operation</span>
<span class="w">    </span><span class="nx">wordpressDefinitionValues</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">WordpressDefinitionValues</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Name</span><span class="p">:</span><span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Environment</span><span class="p">:</span><span class="w">     </span><span class="nx">w</span><span class="p">.</span><span class="nx">Environment</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Replicas</span><span class="p">:</span><span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">Replicas</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ManagedDatabase</span><span class="p">:</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">ManagedDatabase</span><span class="p">,</span>
<span class="w">        </span><span class="nx">DomainName</span><span class="p">:</span><span class="w">      </span><span class="nx">w</span><span class="p">.</span><span class="nx">DomainName</span><span class="p">,</span>
<span class="w">        </span><span class="nx">AwsAccountName</span><span class="p">:</span><span class="w">  </span><span class="nx">w</span><span class="p">.</span><span class="nx">AwsAccountName</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">operations</span><span class="p">.</span><span class="nx">AppendOperation</span><span class="p">(</span><span class="nx">util</span><span class="p">.</span><span class="nx">Operation</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Create</span><span class="p">:</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">wordpressDefinition</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">wordpressDefinitionValues</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="nx">apiClient</span><span class="p">,</span><span class="w"> </span><span class="nx">apiEndpoint</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to create wordpress definition with name %s: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">w</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">createdWordpressDefinition</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">*</span><span class="nx">wordpressDefinition</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">Delete</span><span class="p">:</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">wordpressDefinitionValues</span><span class="p">.</span><span class="nx">Delete</span><span class="p">(</span><span class="nx">apiClient</span><span class="p">,</span><span class="w"> </span><span class="nx">apiEndpoint</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to delete wordpress definition with name %s: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">w</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wordpress definition&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="c1">// add wordpress instance operation</span>
<span class="w">    </span><span class="nx">wordpressInstanceValues</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">WordpressInstanceValues</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Name</span><span class="p">:</span><span class="w">      </span><span class="nx">w</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">        </span><span class="nx">SubDomain</span><span class="p">:</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">SubDomain</span><span class="p">,</span>
<span class="w">        </span><span class="nx">WordpressDefinition</span><span class="p">:</span><span class="w"> </span><span class="nx">WordpressDefinitionValues</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">KubernetesRuntimeInstance</span><span class="p">:</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">KubernetesRuntimeInstance</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">operations</span><span class="p">.</span><span class="nx">AppendOperation</span><span class="p">(</span><span class="nx">util</span><span class="p">.</span><span class="nx">Operation</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Create</span><span class="p">:</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">wordpressInstance</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">wordpressInstanceValues</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="nx">apiClient</span><span class="p">,</span><span class="w"> </span><span class="nx">apiEndpoint</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to create wordpress instance with name %s: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">w</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">createdWordpressInstance</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">*</span><span class="nx">wordpressInstance</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">Delete</span><span class="p">:</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">wordpressInstanceValues</span><span class="p">.</span><span class="nx">Delete</span><span class="p">(</span><span class="nx">apiClient</span><span class="p">,</span><span class="w"> </span><span class="nx">apiEndpoint</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to delete wordpress instance with name %s: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">w</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wordpress instance&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">operations</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">createdWordpressDefinition</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">createdWordpressInstance</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Now, update the <code>Create</code> and <code>Delete</code> methods on the <code>WordpressDefinitionValues</code>
object as shown below.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// Create creates a wordpress definition in the Threeport API.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="o">*</span><span class="nx">WordpressDefinitionValues</span><span class="p">)</span><span class="w"> </span><span class="nx">Create</span><span class="p">(</span>
<span class="w">    </span><span class="nx">apiClient</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">,</span>
<span class="w">    </span><span class="nx">apiEndpoint</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">api_v0</span><span class="p">.</span><span class="nx">WordpressDefinition</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// validate config</span>
<span class="w">    </span><span class="c1">// environment</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Environment</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">validEnvs</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;dev&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;prod&quot;</span><span class="p">}</span>
<span class="w">        </span><span class="nx">envValid</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">env</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">validEnvs</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">*</span><span class="nx">w</span><span class="p">.</span><span class="nx">Environment</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">env</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">envValid</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">                </span><span class="k">break</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">envValid</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;invalid Environment - must be one of %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">validEnvs</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// domain name</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">DomainName</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">DomainName</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;must provide a name for the domain name definition to use&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// construct wordpress definition object</span>
<span class="w">    </span><span class="nx">wordpressDefinition</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">api_v0</span><span class="p">.</span><span class="nx">WordpressDefinition</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Definition</span><span class="p">:</span><span class="w"> </span><span class="nx">tpapi_v0</span><span class="p">.</span><span class="nx">Definition</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Environment</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">Environment</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Environment</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Replicas</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">Replicas</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Replicas</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">ManagedDatabase</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">ManagedDatabase</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">ManagedDatabase</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// create wordpress definition</span>
<span class="w">    </span><span class="nx">createdWordpressDefinition</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">client_v0</span><span class="p">.</span><span class="nx">CreateWordpressDefinition</span><span class="p">(</span>
<span class="w">        </span><span class="nx">apiClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">apiEndpoint</span><span class="p">,</span>
<span class="w">        </span><span class="o">&amp;</span><span class="nx">wordpressDefinition</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to create wordpress definition in threeport API: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// make domain name definition attachment if defined</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">DomainName</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// look up domain name by name</span>
<span class="w">        </span><span class="nx">domainNameDefinition</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">GetDomainNameDefinitionByName</span><span class="p">(</span>
<span class="w">            </span><span class="nx">apiClient</span><span class="p">,</span>
<span class="w">            </span><span class="nx">apiEndpoint</span><span class="p">,</span>
<span class="w">            </span><span class="o">*</span><span class="nx">w</span><span class="p">.</span><span class="nx">DomainName</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;domain name definition %s not found: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">w</span><span class="p">.</span><span class="nx">DomainName</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// set attachment of wordpress definition to domain name definition</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">EnsureAttachedObjectReferenceExists</span><span class="p">(</span>
<span class="w">            </span><span class="nx">apiClient</span><span class="p">,</span>
<span class="w">            </span><span class="nx">apiEndpoint</span><span class="p">,</span>
<span class="w">            </span><span class="nx">tpapi_v0</span><span class="p">.</span><span class="nx">ObjectTypeDomainNameDefinition</span><span class="p">,</span>
<span class="w">            </span><span class="nx">domainNameDefinition</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">            </span><span class="nx">api_v0</span><span class="p">.</span><span class="nx">ObjectTypeWordpressDefinition</span><span class="p">,</span>
<span class="w">            </span><span class="nx">createdWordpressDefinition</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">        </span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to attach wordpress definition to domain name definition: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// make AWS account attachment if needed</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">ManagedDatabase</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">*</span><span class="nx">w</span><span class="p">.</span><span class="nx">ManagedDatabase</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">awsAccountId</span><span class="w"> </span><span class="kt">uint</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">AwsAccountName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// look for default account</span>
<span class="w">            </span><span class="nx">queryString</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;default=true&quot;</span>
<span class="w">            </span><span class="nx">awsAccounts</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">GetAwsAccountsByQueryString</span><span class="p">(</span>
<span class="w">                </span><span class="nx">apiClient</span><span class="p">,</span>
<span class="w">                </span><span class="nx">apiEndpoint</span><span class="p">,</span>
<span class="w">                </span><span class="nx">queryString</span><span class="p">,</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to get default AWS account: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="o">*</span><span class="nx">awsAccounts</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;no AWS account name provided and no default account found&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">awsAccountId</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="nx">awsAccounts</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">ID</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// look up AWS account by name</span>
<span class="w">            </span><span class="nx">awsAccount</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">GetAwsAccountByName</span><span class="p">(</span>
<span class="w">                </span><span class="nx">apiClient</span><span class="p">,</span>
<span class="w">                </span><span class="nx">apiEndpoint</span><span class="p">,</span>
<span class="w">                </span><span class="o">*</span><span class="nx">w</span><span class="p">.</span><span class="nx">AwsAccountName</span><span class="p">,</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to get AWS account by name %s: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">w</span><span class="p">.</span><span class="nx">AwsAccountName</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">awsAccountId</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">*</span><span class="nx">awsAccount</span><span class="p">.</span><span class="nx">ID</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// set attachment of wordpress definition to AWS account</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">EnsureAttachedObjectReferenceExists</span><span class="p">(</span>
<span class="w">            </span><span class="nx">apiClient</span><span class="p">,</span>
<span class="w">            </span><span class="nx">apiEndpoint</span><span class="p">,</span>
<span class="w">            </span><span class="nx">tpapi_v0</span><span class="p">.</span><span class="nx">ObjectTypeAwsAccount</span><span class="p">,</span>
<span class="w">            </span><span class="o">&amp;</span><span class="nx">awsAccountId</span><span class="p">,</span>
<span class="w">            </span><span class="nx">api_v0</span><span class="p">.</span><span class="nx">ObjectTypeWordpressDefinition</span><span class="p">,</span>
<span class="w">            </span><span class="nx">createdWordpressDefinition</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">        </span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to attach wordpress definition to AWS account: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">createdWordpressDefinition</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// Delete deletes a wordpress definition from the Threeport API.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="o">*</span><span class="nx">WordpressDefinitionValues</span><span class="p">)</span><span class="w"> </span><span class="nx">Delete</span><span class="p">(</span>
<span class="w">    </span><span class="nx">apiClient</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">,</span>
<span class="w">    </span><span class="nx">apiEndpoint</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">api_v0</span><span class="p">.</span><span class="nx">WordpressDefinition</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// get wordpress definition by name</span>
<span class="w">    </span><span class="nx">wordpressDefinition</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">client_v0</span><span class="p">.</span><span class="nx">GetWordpressDefinitionByName</span><span class="p">(</span>
<span class="w">        </span><span class="nx">apiClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">apiEndpoint</span><span class="p">,</span>
<span class="w">        </span><span class="o">*</span><span class="nx">w</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to find wordpress definition with name %s: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">w</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// delete wordpress definition</span>
<span class="w">    </span><span class="nx">deletedWordpressDefinition</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">client_v0</span><span class="p">.</span><span class="nx">DeleteWordpressDefinition</span><span class="p">(</span>
<span class="w">        </span><span class="nx">apiClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">apiEndpoint</span><span class="p">,</span>
<span class="w">        </span><span class="o">*</span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to delete wordpress definition from Threeport API: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">deletedWordpressDefinition</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Finally, update the <code>Create</code> and <code>Delete</code> methods on the <code>WordpressInstanceValues</code>
object as shown below.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// Create creates a wordpress instance in the Threeport API.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="o">*</span><span class="nx">WordpressInstanceValues</span><span class="p">)</span><span class="w"> </span><span class="nx">Create</span><span class="p">(</span>
<span class="w">    </span><span class="nx">apiClient</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">,</span>
<span class="w">    </span><span class="nx">apiEndpoint</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">api_v0</span><span class="p">.</span><span class="nx">WordpressInstance</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// validate config</span>
<span class="w">    </span><span class="c1">// TODO</span>

<span class="w">    </span><span class="c1">// get kubernetes runtime instance API object</span>
<span class="w">    </span><span class="nx">kubernetesRuntimeInstance</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpconfig</span><span class="p">.</span><span class="nx">SetKubernetesRuntimeInstanceForConfig</span><span class="p">(</span>
<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">KubernetesRuntimeInstance</span><span class="p">,</span>
<span class="w">        </span><span class="nx">apiClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">apiEndpoint</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to set kubernetes runtime instance: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// get wordpress definition by name</span>
<span class="w">    </span><span class="nx">wordpressDefinition</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">client_v0</span><span class="p">.</span><span class="nx">GetWordpressDefinitionByName</span><span class="p">(</span>
<span class="w">        </span><span class="nx">apiClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">apiEndpoint</span><span class="p">,</span>
<span class="w">        </span><span class="o">*</span><span class="nx">w</span><span class="p">.</span><span class="nx">WordpressDefinition</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;failed to get wordpress definition by name %s: %w&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WordpressDefinition</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">            </span><span class="nx">err</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// construct wordpress instance object</span>
<span class="w">    </span><span class="nx">wordpressInstance</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">api_v0</span><span class="p">.</span><span class="nx">WordpressInstance</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Instance</span><span class="p">:</span><span class="w"> </span><span class="nx">tpapi_v0</span><span class="p">.</span><span class="nx">Instance</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">WordpressDefinitionID</span><span class="p">:</span><span class="w"> </span><span class="nx">wordpressDefinition</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">SubDomain</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">wordpressInstance</span><span class="p">.</span><span class="nx">SubDomain</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">SubDomain</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// create wordpress instance</span>
<span class="w">    </span><span class="nx">createdWordpressInstance</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">client_v0</span><span class="p">.</span><span class="nx">CreateWordpressInstance</span><span class="p">(</span>
<span class="w">        </span><span class="nx">apiClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">apiEndpoint</span><span class="p">,</span>
<span class="w">        </span><span class="o">&amp;</span><span class="nx">wordpressInstance</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to create wordpress instance in threeport API: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// create attached object reference to kubernetes runtime instance</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">EnsureAttachedObjectReferenceExists</span><span class="p">(</span>
<span class="w">        </span><span class="nx">apiClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">apiEndpoint</span><span class="p">,</span>
<span class="w">        </span><span class="nx">tpapi_v0</span><span class="p">.</span><span class="nx">ObjectTypeKubernetesRuntimeInstance</span><span class="p">,</span>
<span class="w">        </span><span class="nx">kubernetesRuntimeInstance</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">        </span><span class="nx">api_v0</span><span class="p">.</span><span class="nx">ObjectTypeWordpressInstance</span><span class="p">,</span>
<span class="w">        </span><span class="nx">createdWordpressInstance</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">    </span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to attach wordpress instance to kubernetes runtime instance: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">createdWordpressInstance</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// Delete deletes a wordpress instance from the Threeport API.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="o">*</span><span class="nx">WordpressInstanceValues</span><span class="p">)</span><span class="w"> </span><span class="nx">Delete</span><span class="p">(</span>
<span class="w">    </span><span class="nx">apiClient</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">,</span>
<span class="w">    </span><span class="nx">apiEndpoint</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">api_v0</span><span class="p">.</span><span class="nx">WordpressInstance</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// get wordpress instance by name</span>
<span class="w">    </span><span class="nx">wordpressInstance</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">client_v0</span><span class="p">.</span><span class="nx">GetWordpressInstanceByName</span><span class="p">(</span>
<span class="w">        </span><span class="nx">apiClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">apiEndpoint</span><span class="p">,</span>
<span class="w">        </span><span class="o">*</span><span class="nx">w</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to find wordpress instance with name %s: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">w</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// delete wordpress instance</span>
<span class="w">    </span><span class="nx">deletedWordpressInstance</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">client_v0</span><span class="p">.</span><span class="nx">DeleteWordpressInstance</span><span class="p">(</span>
<span class="w">        </span><span class="nx">apiClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">apiEndpoint</span><span class="p">,</span>
<span class="w">        </span><span class="o">*</span><span class="nx">wordpressInstance</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to delete wordpress instance from Threeport API: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// wait for workload instance to be deleted</span>
<span class="w">    </span><span class="nx">util</span><span class="p">.</span><span class="nx">Retry</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">client_v0</span><span class="p">.</span><span class="nx">GetWordpressInstanceByName</span><span class="p">(</span><span class="nx">apiClient</span><span class="p">,</span><span class="w"> </span><span class="nx">apiEndpoint</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">w</span><span class="p">.</span><span class="nx">Name</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;workload instance not deleted&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="c1">// get kubernetes runtime instance API object</span>
<span class="w">    </span><span class="nx">kubernetesRuntimeInstance</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpconfig</span><span class="p">.</span><span class="nx">SetKubernetesRuntimeInstanceForConfig</span><span class="p">(</span>
<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">KubernetesRuntimeInstance</span><span class="p">,</span>
<span class="w">        </span><span class="nx">apiClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">apiEndpoint</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to set kubernetes runtime instance: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// remove attached object reference to kubernetes runtime instance</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tpclient</span><span class="p">.</span><span class="nx">EnsureAttachedObjectReferenceRemoved</span><span class="p">(</span>
<span class="w">        </span><span class="nx">apiClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">apiEndpoint</span><span class="p">,</span>
<span class="w">        </span><span class="nx">tpapi_v0</span><span class="p">.</span><span class="nx">ObjectTypeKubernetesRuntimeInstance</span><span class="p">,</span>
<span class="w">        </span><span class="nx">kubernetesRuntimeInstance</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">        </span><span class="nx">api_v0</span><span class="p">.</span><span class="nx">ObjectTypeWordpressInstance</span><span class="p">,</span>
<span class="w">        </span><span class="nx">deletedWordpressInstance</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">    </span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to remove wordpress instance attachment to kubernetes runtime instance: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">deletedWordpressInstance</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Ensure the imports for this <code>pkg/config/v0/wordpress.go</code> file match the
following.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;errors&quot;</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>

<span class="w">    </span><span class="nx">tpapi_v0</span><span class="w"> </span><span class="s">&quot;github.com/threeport/threeport/pkg/api/v0&quot;</span>
<span class="w">    </span><span class="nx">tpclient</span><span class="w"> </span><span class="s">&quot;github.com/threeport/threeport/pkg/client/v0&quot;</span>
<span class="w">    </span><span class="nx">tpconfig</span><span class="w"> </span><span class="s">&quot;github.com/threeport/threeport/pkg/config/v0&quot;</span>
<span class="w">    </span><span class="nx">util</span><span class="w"> </span><span class="s">&quot;github.com/threeport/threeport/pkg/util/v0&quot;</span>

<span class="w">    </span><span class="nx">api_v0</span><span class="w"> </span><span class="s">&quot;wordpress-threeport-module/pkg/api/v0&quot;</span>
<span class="w">    </span><span class="nx">client_v0</span><span class="w"> </span><span class="s">&quot;wordpress-threeport-module/pkg/client/v0&quot;</span>
<span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>That's it!  We've added 1 file and modified 3 others.  We're ready to build and
deploy the module to Threeport.</p>
<h2 id="build">Build<a class="headerlink" href="#build" title="Permanent link">&para;</a></h2>
<p>First, we need to satisfy the project's package dependencies.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>go<span class="w"> </span>mod<span class="w"> </span>tidy
</code></pre></div></td></tr></table></div>
<p>The Threeport SDK provides <a href="https://magefile.org/">mage</a> targets with convenient
development utilities.  To see all available mage targets, simple run <code>mage</code>.</p>
<p>Next, let's build the <code>tptctl</code> plugin for the WordPress module.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>mage<span class="w"> </span>build:plugin
</code></pre></div></td></tr></table></div>
<p>To install a tptctl plugin, simply copy the plugin binary to the tptctl plugin
directory - by default <code>~/.threeport/plugins</code>.  See <code>tptctl help</code> for more info
on installing tptctl plugins.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>cp<span class="w"> </span>bin/wordpress<span class="w"> </span>~/.threeport/plugins/
</code></pre></div></td></tr></table></div>
<p>Check the plugin was successfully installed.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>tptctl<span class="w"> </span>wordpress<span class="w"> </span>-h
</code></pre></div></td></tr></table></div>
<blockquote>
<p>Note:  If you're using a Mac, you may encounter security restrictions that
prevent your workstation from running the plugin.  If, when you run it, you
see output similar to this:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w">    </span><span class="m">40259</span><span class="w"> </span>killed<span class="w">     </span>tptctl<span class="w"> </span>wordpress<span class="w"> </span>-h
</code></pre></div></td></tr></table></div>
Then run the following command.
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>codesign<span class="w"> </span>-f<span class="w"> </span>-s<span class="w"> </span>-<span class="w"> </span>bin/wordpress
</code></pre></div></td></tr></table></div>
Then repeat the two steps below to install and test the plugin.</p>
</blockquote>
<p>You should see the help output for the wordpress plugin similar to that shown below.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code>Manage<span class="w"> </span>the<span class="w"> </span>Wordpress<span class="w"> </span>Threeport<span class="w"> </span>module

Usage:
<span class="w">  </span>wordpress<span class="w"> </span><span class="o">[</span>command<span class="o">]</span>

Available<span class="w"> </span>Commands:
<span class="w">  </span>completion<span class="w">  </span>Generate<span class="w"> </span>the<span class="w"> </span>autocompletion<span class="w"> </span>script<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>specified<span class="w"> </span>shell
<span class="w">  </span>create<span class="w">      </span>Create<span class="w"> </span>a<span class="w"> </span>Threeport<span class="w"> </span>Wordpress<span class="w"> </span>object
<span class="w">  </span>delete<span class="w">      </span>Delete<span class="w"> </span>a<span class="w"> </span>Threeport<span class="w"> </span>Wordpress<span class="w"> </span>object
<span class="w">  </span>describe<span class="w">    </span>Describe<span class="w"> </span>a<span class="w"> </span>Threeport<span class="w"> </span>Wordpress<span class="w"> </span>object
<span class="w">  </span>get<span class="w">         </span>Get<span class="w"> </span>a<span class="w"> </span>Threeport<span class="w"> </span>Wordpress<span class="w"> </span>object
<span class="w">  </span><span class="nb">help</span><span class="w">        </span>Help<span class="w"> </span>about<span class="w"> </span>any<span class="w"> </span><span class="nb">command</span>
<span class="w">  </span>install<span class="w">     </span>Install<span class="w"> </span>the<span class="w"> </span>Wordpress<span class="w"> </span>module<span class="w"> </span>to<span class="w"> </span>an<span class="w"> </span>existing<span class="w"> </span>Threeport<span class="w"> </span>control<span class="w"> </span>plane

Flags:
<span class="w">  </span>-h,<span class="w"> </span>--help<span class="w">                      </span><span class="nb">help</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>wordpress
<span class="w">      </span>--provider-config<span class="w"> </span>string<span class="w">    </span>Path<span class="w"> </span>to<span class="w"> </span>infra<span class="w"> </span>provider<span class="w"> </span>config<span class="w"> </span>directory<span class="w"> </span><span class="o">(</span>default<span class="w"> </span>is<span class="w"> </span><span class="nv">$HOME</span>/.threeport/<span class="o">)</span>.
<span class="w">      </span>--threeport-config<span class="w"> </span>string<span class="w">   </span>Path<span class="w"> </span>to<span class="w"> </span>config<span class="w"> </span>file<span class="w"> </span><span class="o">(</span>default<span class="w"> </span>is<span class="w"> </span><span class="nv">$HOME</span>/.threeport/config.yaml<span class="o">)</span>.<span class="w"> </span>Can<span class="w"> </span>also<span class="w"> </span>be<span class="w"> </span><span class="nb">set</span><span class="w"> </span>with<span class="w"> </span>environment<span class="w"> </span>variable<span class="w"> </span>THREEPORT_CONFIG
<span class="w">  </span>-t,<span class="w"> </span>--toggle<span class="w">                    </span>Help<span class="w"> </span>message<span class="w"> </span><span class="k">for</span><span class="w"> </span>toggle

Additional<span class="w"> </span><span class="nb">help</span><span class="w"> </span>topics:
<span class="w">  </span>wordpress<span class="w"> </span>update<span class="w">     </span>Update<span class="w"> </span>a<span class="w"> </span>Threeport<span class="w"> </span>Wordpress<span class="w"> </span>object

Use<span class="w"> </span><span class="s2">&quot;wordpress [command] --help&quot;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>more<span class="w"> </span>information<span class="w"> </span>about<span class="w"> </span>a<span class="w"> </span>command.
</code></pre></div></td></tr></table></div>
<p>Next, we need to build the binaries and container images for each containerized
component that will be installed into a Threeport control plane.  After the
images are built, they will be pushed to a container registry to make them
available for installation.</p>
<blockquote>
<p>Note: In this and other following sections, you will have the option to
test the WordPress module in a "Local Dev Environment" on your
workstation, or in a "Remote Environment" running in AWS.</p>
<p>The remote environment option will provide a more realistic use case and will
allow you to test using AWS RDS as the persistent data store for WordPress,
but requires an AWS account, will cost money and take a little longer.  This
tutorial will also require a Route53 hosted zone you can use for DNS.  The
local dev environment will be faster to spin up and down and cost nothing on
your cloud bill.  Choose the appropriate tab in each section for the method
you choose.</p>
</blockquote>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Local Dev Environment</label><label for="__tabbed_1_2">Remote Environment</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>If you're going to test this locally, first spin up a local container registry
so we don't have to wait for images to pushed to - and pulled from - a remote
registry.  This mage target will create run a local docker container to serve as
the container registry.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>mage<span class="w"> </span>dev:localRegistryUp
</code></pre></div></td></tr></table></div>
<p>Now we can build and push the container images to the local registry.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>mage<span class="w"> </span>build:allImagesDev
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<p>If using a remote AWS environment, build for the release architecture (amd64).
This step will build the binaries and container images, then push them to your
registry (as defined in the <code>sdk-config.yaml</code> file).  This may take a few
minutes as three container images will be pushed to your remote container
registry.  You will need to be logged in to your container registry from your
command line.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>mage<span class="w"> </span>build:allImagesRelease
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<h2 id="threeport-control-plane">Threeport Control Plane<a class="headerlink" href="#threeport-control-plane" title="Permanent link">&para;</a></h2>
<p>If you don't aleady have one, install a Threeport control plane for testing.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Local Dev Environment</label><label for="__tabbed_2_2">Remote Environment</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>To install Threeport that will pull images from a local registry, use the
following command.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code>tptctl<span class="w"> </span>up<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--provider<span class="w"> </span>kind<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--auth-enabled<span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--local-registry
</code></pre></div></td></tr></table></div>
<p>For more info on installing Threeport locally, see the
<a href="../../install/install-threeport-local">documentation to Install Threeport
Locally</a>.</p>
</div>
<div class="tabbed-block">
<p>To install Threeport in AWS, use the following command.  Substitute your
region of choice as needed.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code>tptctl<span class="w"> </span>up<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--provider<span class="w"> </span>eks<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--aws-region<span class="w"> </span>us-east-2
</code></pre></div></td></tr></table></div>
<p>For more info on installing Threeport remotely, see the
<a href="../../install/install-threeport-aws">documentation to Install Threeport on AWS</a>.</p>
</div>
</div>
</div>
<h2 id="install-wordpress-module">Install WordPress Module<a class="headerlink" href="#install-wordpress-module" title="Permanent link">&para;</a></h2>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Local Dev Environment</label><label for="__tabbed_3_2">Remote Environment</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>To install the WordPress module using the image pushed to the local dev
registry, use the following command.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>tptctl<span class="w"> </span>wordpress<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>localhost:5001
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<p>If installing remotely, run the install as shown here to pull images from
your default image repo (as declared in your <code>sdk-config.yaml</code> file).</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>tptctl wordpress install
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<h2 id="use-the-wordpress-module">Use the WordPress Module<a class="headerlink" href="#use-the-wordpress-module" title="Permanent link">&para;</a></h2>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">Local Dev Environment</label><label for="__tabbed_4_2">Remote Environment</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>For a local install of WordPress use the following config.  The <code>Environment</code>
and <code>ManagedDatabase</code> fields are shown with their default values and aren't
required.  They are only included for the sake of explicitness for this
tutorial.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># wordpress-local.yaml</span>
<span class="nt">Wordpress</span><span class="p">:</span>
<span class="w">  </span><span class="nt">Name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<span class="w">  </span><span class="nt">Environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
<span class="w">  </span><span class="nt">ManagedDatabase</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div></td></tr></table></div>
<p>Install WordPress.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>tptctl<span class="w"> </span>wordpress<span class="w"> </span>create<span class="w"> </span>wordpress<span class="w"> </span>-c<span class="w"> </span>wordpress-local.yaml
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<p>In order to use a Route53 hosted zone to manage DNS for your WordPress app,
you will need to register that with Threeport.  Create a domain name
definition config like this.  Replace the values for the <code>Domain</code> and
<code>AdminEmail</code> fields to work for your setup.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># domain-name.yaml</span>
<span class="nt">DomainNameDefinition</span><span class="p">:</span>
<span class="w">  </span><span class="nt">Name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-domain</span>
<span class="w">  </span><span class="nt">Domain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example.com</span>
<span class="w">  </span><span class="nt">Zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Public</span>
<span class="w">  </span><span class="nt">AdminEmail</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin@example.com</span>
</code></pre></div></td></tr></table></div>
<p>Now you can register this hosted zone with Threeport.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>tptctl<span class="w"> </span>create<span class="w"> </span>domain-name-definition<span class="w"> </span>-c<span class="w"> </span>domain-name.yaml
</code></pre></div></td></tr></table></div>
<p>For a remote install, we can use AWS RDS for the database as well as Route53 for
DNS.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># wordpress-remote.yaml</span>
<span class="nt">Wordpress</span><span class="p">:</span>
<span class="w">  </span><span class="nt">Name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">remote</span>
<span class="w">  </span><span class="nt">Environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
<span class="w">  </span><span class="nt">ManagedDatabase</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">DomainName</span><span class="p">:</span>
<span class="w">    </span><span class="nt">Name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-domain</span>
<span class="w">  </span><span class="nt">SubDomain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">blog</span>
<span class="w">  </span><span class="nt">KubernetesRuntimeInstance</span><span class="p">:</span>
<span class="w">    </span><span class="nt">Name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">threeport-test</span>
</code></pre></div></td></tr></table></div>
<p>Install WordPress.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>tptctl<span class="w"> </span>wordpress<span class="w"> </span>create<span class="w"> </span>wordpress<span class="w"> </span>-c<span class="w"> </span>wordpress-remote.yaml
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<h2 id="verification">Verification<a class="headerlink" href="#verification" title="Permanent link">&para;</a></h2>
<p>After a few minutes, the wordpress instance should be running.  You can view the
app in your browser by following the following steps.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">Local Dev Environment</label><label for="__tabbed_5_2">Remote Environment</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<blockquote>
<p>Note: You will need to have
<a href="https://kubernetes.io/docs/tasks/tools/#kubectl">kubectl</a> installed on your
machine to perform these steps.</p>
</blockquote>
<p>Get the Threeport-managed namespace that was created for the WordPress app.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nv">WORDPRESS_NAMESPACE</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>ns<span class="w"> </span>-A<span class="w"> </span>-l<span class="w"> </span>app.kubernetes.io/name<span class="o">=</span><span class="nb">local</span><span class="w"> </span>-o<span class="o">=</span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.items[0].metadata.name}&#39;</span><span class="k">)</span>
</code></pre></div></td></tr></table></div>
<p>Start a port forward to the WordPress service.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>kubectl<span class="w"> </span>port-forward<span class="w"> </span>-n<span class="w"> </span><span class="nv">$WORDPRESS_NAMESPACE</span><span class="w"> </span>svc/local-wordpress<span class="w"> </span><span class="m">8080</span>:80
</code></pre></div></td></tr></table></div>
<p>Now visit <a href="http://localhost:8080">http://localhost:8080</a> in your browser.</p>
<p>When finished, hit Ctrl+C in the terminal where the port forward is running to
cancel it.</p>
</div>
<div class="tabbed-block">
<p>To verify the app is up and running, just type <code>blog.[your domain]</code> (using
the domain you configured in <code>domain-name.yaml</code>) into a browser.  By
default, <a href="https://letsencrypt.org/">Let's Encrypt</a> is used as the TLS cert
provider.  Also, by default, the staging environment is used.  This means
the certificate will be valid but not publicly trusted.  So your browser
will give you a warning.  You can tell your browser to proceed anyway, and
you should get the default homepage served to you.</p>
</div>
</div>
</div>
<h2 id="clean-up">Clean Up<a class="headerlink" href="#clean-up" title="Permanent link">&para;</a></h2>
<p>Follow the instructions to remove the WordPress app and Threeport for either the
Local or Remote environment.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">Local Dev Environment</label><label for="__tabbed_6_2">Remote Environment</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Remove the WordPress app by deleting it with tptctl.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>tptctl<span class="w"> </span>wordpress<span class="w"> </span>delete<span class="w"> </span>wordpress<span class="w"> </span>-c<span class="w"> </span>wordpress-local.yaml
</code></pre></div></td></tr></table></div>
<p>Remove the local Threeport control plane.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>tptctl<span class="w"> </span>down<span class="w"> </span>-n<span class="w"> </span><span class="nb">test</span>
</code></pre></div></td></tr></table></div>
<p>Remove the local container registry.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>mage<span class="w"> </span>dev:localRegistryDown
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<p>Remove the WordPress app by deleting it with tptctl.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>tptctl<span class="w"> </span>wordpress<span class="w"> </span>delete<span class="w"> </span>wordpress<span class="w"> </span>-c<span class="w"> </span>wordpress-remote.yaml
</code></pre></div></td></tr></table></div>
<p>After deleting the WordPress app, wait a few minutes before proceeding.  We
need to give the system enough time to clean up your Route53 hosted zone
before removing the support services in the next step.  If you like, you can check
your Route53 hosted zone in the AWS portal before proceeding.  Otherwise,
just wait 5 minutes to be safe.</p>
<p>Next, we need to Remove the support service workloads that were deployed.  By default,
Threeport will not remove a Kubernetes runtime with workloads deployed.  We
can view them with this command.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>tptctl<span class="w"> </span>get<span class="w"> </span>workloads
</code></pre></div></td></tr></table></div>
<p>Delete the support service workloads.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>tptctl<span class="w"> </span>delete<span class="w"> </span>workload-instance<span class="w"> </span>-n<span class="w"> </span>gloo-edge-threeport-test
tptctl<span class="w"> </span>delete<span class="w"> </span>workload-instance<span class="w"> </span>-n<span class="w"> </span>external-dns-threeport-test
</code></pre></div></td></tr></table></div>
<p>Wait another 5 minutes before proceeding to ensure the AWS load balancer
connected to your ingress layer is removed before deleting the control plane
altogether in the next step.</p>
<p>Remove the local Threeport control plane.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>tptctl<span class="w"> </span>down<span class="w"> </span>-n<span class="w"> </span><span class="nb">test</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>In this tutorial we walked through each and every step to build a sample
module to the Threeport control plane.  You can apply the same process to
create any module to Threeport that you like.  Use cases are not limited to
particular workload support.  Other use cases can include:</p>
<ul>
<li>Support for alternative infrastructure providers.</li>
<li>Support for managed services on infrastructure providers.  This is not limited
  to cloud providers.  It could include services like DataDog, Splunk, MongoDB,
  or literally any other software service that has an API.</li>
<li>Support for alternative runtime environments besides Kubernetes, e.g. VMs or
  function-as-a-service offerings.</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022-2024 Threeport.io
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/threeport/threeport" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
    
  </body>
</html>